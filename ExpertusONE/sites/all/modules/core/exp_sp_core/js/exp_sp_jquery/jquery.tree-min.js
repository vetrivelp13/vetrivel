(function(b){b.tree={datastores:{},plugins:{},defaults:{data:{async:false,type:"html",opts:{method:"GET",url:false}},selected:false,opened:[],languages:[],ui:{dots:true,animation:0,scroll_spd:4,theme_path:false,theme_name:"default",selected_parent_close:"select_parent",selected_delete:"select_previous"},types:{"default":{clickable:true,renameable:true,deletable:true,creatable:true,draggable:true,max_children:-1,max_depth:-1,valid_children:"all",icon:{image:false,position:false}}},rules:{multiple:false,multitree:"none",type_attr:"rel",createat:"bottom",drag_copy:"ctrl",drag_button:"left",use_max_children:true,use_max_depth:true,max_children:-1,max_depth:-1,valid_children:"all"},lang:{new_node:"New profile",loading:"Loading ..."},callback:{beforechange:function(c,d){return true;},beforeopen:function(c,d){return true;},beforeclose:function(c,d){return true;},beforemove:function(c,e,f,d){return true;},beforecreate:function(c,e,f,d){return true;},beforerename:function(c,e,d){return true;},beforedelete:function(c,d){return true;
},beforedata:function(c,d){return{id:b(c).attr("id")||0};},ondata:function(c,d){return c;},onparse:function(d,c){return d;},onhover:function(c,d){},onselect:function(c,d){},ondeselect:function(c,d){},onchange:function(c,d){},onrename:function(c,d,e){},onmove:function(c,e,g,d,f){},oncopy:function(c,e,g,d,f){},oncreate:function(c,e,g,d,f){},ondelete:function(c,d,e){},onopen:function(c,d){},onopen_all:function(c){},onclose_all:function(c){},onclose:function(c,d){},error:function(d,c){},ondblclk:function(c,d){d.toggle_branch.call(d,c);d.select_branch.call(d,c);},onrgtclk:function(c,d,e){},onload:function(c){},oninit:function(c){},onfocus:function(c){},ondestroy:function(c){},onsearch:function(c,d){c.addClass("search");},ondrop:function(c,e,f,d){},check:function(d,c,f,e){return f;},check_move:function(c,e,f,d){return true;}},plugins:{}},create:function(){return new a();},focused:function(){return a.inst[a.focused];},reference:function(c){var d=b(c);if(!d.size()){d=b("#"+c);}if(!d.size()){return null;
}d=(d.is(".tree"))?d.attr("id"):d.parents(".tree:eq(0)").attr("id");return a.inst[d]||null;},rollback:function(f){for(var e in f){if(!f.hasOwnProperty(e)){continue;}var d=a.inst[e];var c=!d.locked;if(c){d.lock(true);}d.inp=false;d.container.html(f[e].html).find(".dragged").removeClass("dragged").end().find(".hover").removeClass("hover");if(f[e].selected){d.selected=b("#"+f[e].selected);d.selected_arr=[];d.container.find("a.clicked").each(function(){d.selected_arr.push(d.get_node(this));});}if(c){d.lock(false);}delete c;delete d;}},drop_mode:function(c){c=b.extend(c,{show:false,type:"default",str:"Foreign node"});a.drag_drop.foreign=true;a.drag_drop.isdown=true;a.drag_drop.moving=true;a.drag_drop.appended=false;a.drag_drop.f_type=c.type;a.drag_drop.f_data=c;if(!c.show){a.drag_drop.drag_help=false;a.drag_drop.drag_node=false;}else{a.drag_drop.drag_help=b("<div id='jstree-dragged' class='tree tree-default'><ul><li class='last dragged foreign'><a href='#'><ins>&nbsp;</ins>"+c.str+"</a></li></ul></div>");
a.drag_drop.drag_node=a.drag_drop.drag_help.find("li:eq(0)");}if(b.tree.drag_start!==false){b.tree.drag_start.call(null,false);}},drag_start:false,drag:false,drag_end:false};b.fn.tree=function(c){return this.each(function(){var d=b.extend({},c);if(a.inst&&a.inst[b(this).attr("id")]){a.inst[b(this).attr("id")].destroy();}if(d!==false){new a().init(this,d);}});};function a(){return{cntr:++a.cntr,settings:b.extend({},b.tree.defaults),init:function(h,e){var k=this;this.container=b(h);if(this.container.size==0){return false;}a.inst[this.cntr]=this;if(!this.container.attr("id")){this.container.attr("id","jstree_"+this.cntr);}a.inst[this.container.attr("id")]=a.inst[this.cntr];a.focused=this.cntr;this.settings=b.extend(true,{},this.settings,e);if(this.settings.languages&&this.settings.languages.length){this.current_lang=this.settings.languages[0];var d=false;var j="#"+this.container.attr("id");for(var g=0;g<this.settings.languages.length;g++){d=a.add_css(j+" ."+this.settings.languages[g]);if(d!==false){d.style.display=(this.settings.languages[g]==this.current_lang)?"":"none";
}}}else{this.current_lang=false;}this.container.addClass("tree");if(this.settings.ui.theme_name!==false){if(this.settings.ui.theme_path===false){b("script").each(function(){k.settings.ui.theme_path=themepath+"/tree/"+k.settings.ui.theme_name+"/style.css";return false;});}if(this.settings.ui.theme_path!=""&&b.inArray(this.settings.ui.theme_path,a.themes)==-1){a.add_sheet({url:this.settings.ui.theme_path});a.themes.push(this.settings.ui.theme_path);}this.container.addClass("tree-"+this.settings.ui.theme_name);}var c="";for(var f in this.settings.types){if(!this.settings.types.hasOwnProperty(f)){continue;}if(!this.settings.types[f].icon){continue;}if(this.settings.types[f].icon.image||this.settings.types[f].icon.position){if(f=="default"){c+="#"+this.container.attr("id")+" li > a ins { ";}else{c+="#"+this.container.attr("id")+" li[rel="+f+"] > a ins { ";}if(this.settings.types[f].icon.image){c+=" background-image:url("+this.settings.types[f].icon.image+"); ";}if(this.settings.types[f].icon.position){c+=" background-position:"+this.settings.types[f].icon.position+"; ";
}c+="} ";}}if(c!=""){a.add_sheet({str:c});}if(this.settings.rules.multiple){this.selected_arr=[];}this.offset=false;this.hovered=false;this.locked=false;if(a.drag_drop.marker===false){a.drag_drop.marker=b("<div>").attr({id:"jstree-marker"}).hide().appendTo("body");}this.callback("oninit",[this]);this.refresh();this.attach_events();this.focus();},refresh:function(d){if(this.locked){return this.error("LOCKED");}var f=this;if(d&&!this.settings.data.async){d=false;}this.is_partial_refresh=d?true:false;this.opened=Array();if(this.settings.opened!=false){b.each(this.settings.opened,function(g,h){if(this.replace(/^#/,"").length>0){f.opened.push("#"+this.replace(/^#/,""));}});this.settings.opened=false;}else{this.container.find("li.open").each(function(g){if(this.id){f.opened.push("#"+this.id);}});}if(this.selected){this.settings.selected=Array();if(d){b(d).find("li:has(a.clicked)").each(function(){if(this.id){f.settings.selected.push("#"+this.id);}});}else{if(this.selected_arr){b.each(this.selected_arr,function(){if(this.attr("id")){f.settings.selected.push("#"+this.attr("id"));
}});}else{if(this.selected.attr("id")){this.settings.selected.push("#"+this.selected.attr("id"));}}}}else{if(this.settings.selected!==false){var c=Array();if((typeof this.settings.selected).toLowerCase()=="object"){b.each(this.settings.selected,function(){if(this.replace(/^#/,"").length>0){c.push("#"+this.replace(/^#/,""));}});}else{if(this.settings.selected.replace(/^#/,"").length>0){c.push("#"+this.settings.selected.replace(/^#/,""));}}this.settings.selected=c;}}if(d&&this.settings.data.async){this.opened=Array();d=this.get_node(d);d.find("li.open").each(function(g){f.opened.push("#"+this.id);});if(d.hasClass("open")){d.removeClass("open").addClass("closed");}if(d.hasClass("leaf")){d.removeClass("leaf");}d.children("ul:eq(0)").html("");return this.open_branch(d,true,function(){f.reselect.apply(f);});}var f=this;var e=new b.tree.datastores[this.settings.data.type]();if(this.container.children("ul").size()==0){this.container.html("<ul class='ltr' style='direction:ltr;'><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(this.settings.lang.loading||"Loading ...")+"</a></li></ul>");
}e.load(this.callback("beforedata",[false,this]),this,this.settings.data.opts,function(g){g=f.callback("ondata",[g,f]);e.parse(g,f,f.settings.data.opts,function(h){h=f.callback("onparse",[h,f]);f.container.empty().append(b("<ul class='ltr'>").html(h));f.container.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");f.container.find("li").not(".open").not(".closed").addClass("leaf");f.reselect();});});},reselect:function(e){var g=this;if(!e){this.cl_count=0;}else{this.cl_count--;}if(this.opened&&this.opened.length){var f=false;for(var c=0;this.opened&&c<this.opened.length;c++){if(this.settings.data.async){var d=this.get_node(this.opened[c]);if(d.size()&&d.hasClass("closed")>0){f=true;var d=this.opened[c].toString().replace("/","\\/");delete this.opened[c];this.open_branch(d,true,function(){g.reselect.apply(g,[true]);});this.cl_count++;}}else{this.open_branch(this.opened[c],true);}}if(this.settings.data.async&&f){return;}if(this.cl_count>0){return;
}delete this.opened;}if(this.cl_count>0){return;}this.container.css("direction","ltr").children("ul:eq(0)").addClass("ltr");if(this.settings.ui.dots==false){this.container.children("ul:eq(0)").addClass("no_dots");}if(this.scrtop){this.container.scrollTop(g.scrtop);delete this.scrtop;}if(this.settings.selected!==false){b.each(this.settings.selected,function(h){if(g.is_partial_refresh){g.select_branch(b(g.settings.selected[h].toString().replace("/","\\/"),g.container),(g.settings.rules.multiple!==false));}else{g.select_branch(b(g.settings.selected[h].toString().replace("/","\\/"),g.container),(g.settings.rules.multiple!==false&&h>0));}});this.settings.selected=false;}this.callback("onload",[g]);},get:function(e,d,c){if(!d){d=this.settings.data.type;}if(!c){c=this.settings.data.opts;}return new b.tree.datastores[d]().get(e,this,c);},attach_events:function(){var c=this;this.container.bind("mousedown.jstree",function(d){if(a.drag_drop.isdown){a.drag_drop.move_type=false;d.preventDefault();d.stopPropagation();
d.stopImmediatePropagation();return false;}}).bind("mouseup.jstree",function(d){setTimeout(function(){c.focus.apply(c);},5);}).bind("click.jstree",function(d){return true;});b("#"+this.container.attr("id")+" li").live("click",function(d){if(d.target.tagName!="LI"){return true;}c.off_height();if(d.pageY-b(d.target).offset().top>c.li_height){return true;}c.toggle_branch.apply(c,[d.target]);d.stopPropagation();return false;});b("#"+this.container.attr("id")+" li a").live("click.jstree",function(d){if(d.which&&d.which==3){return true;}if(c.locked){d.preventDefault();d.target.blur();return c.error("LOCKED");}c.select_branch.apply(c,[d.target,d.ctrlKey||c.settings.rules.multiple=="on"]);if(c.inp){c.inp.blur();}d.preventDefault();d.target.blur();return false;}).live("dblclick.jstree",function(d){if(c.locked){d.preventDefault();d.stopPropagation();d.target.blur();return c.error("LOCKED");}c.callback("ondblclk",[c.get_node(d.target).get(0),c]);d.preventDefault();d.stopPropagation();d.target.blur();
}).live("contextmenu.jstree",function(d){if(c.locked){d.target.blur();return c.error("LOCKED");}return c.callback("onrgtclk",[c.get_node(d.target).get(0),c,d]);}).live("mouseover.jstree",function(d){if(c.locked){d.preventDefault();d.stopPropagation();return c.error("LOCKED");}if(c.hovered!==false&&(d.target.tagName=="A"||d.target.tagName=="INS")){c.hovered.children("a").removeClass("hover");c.hovered=false;}c.callback("onhover",[c.get_node(d.target).get(0),c]);}).live("mousedown.jstree",function(g){if(c.settings.rules.drag_button=="left"&&g.which&&g.which!=1){return true;}if(c.settings.rules.drag_button=="right"&&g.which&&g.which!=3){return true;}c.focus.apply(c);if(c.locked){return c.error("LOCKED");}var h=c.get_node(g.target);if(c.settings.rules.multiple!=false&&c.selected_arr.length>1&&h.children("a:eq(0)").hasClass("clicked")){var d=0;for(var f in c.selected_arr){if(!c.selected_arr.hasOwnProperty(f)){continue;}if(c.check("draggable",c.selected_arr[f])){c.selected_arr[f].addClass("dragged");
a.drag_drop.origin_tree=c;d++;}}if(d>0){if(c.check("draggable",h)){a.drag_drop.drag_node=h;}else{a.drag_drop.drag_node=c.container.find("li.dragged:eq(0)");}a.drag_drop.isdown=true;a.drag_drop.drag_help=b("<div id='jstree-dragged' class='tree "+(c.settings.ui.theme_name!=""?" tree-"+c.settings.ui.theme_name:"")+"' />").append("<ul class='"+c.container.children("ul:eq(0)").get(0).className+"' />");var e=a.drag_drop.drag_node.clone();if(c.settings.languages.length>0){e.find("a").not("."+c.current_lang).hide();}a.drag_drop.drag_help.children("ul:eq(0)").append(e);a.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last").children("a").html("<ins>&nbsp;</ins>Multiple selection").end().children("ul").remove();a.drag_drop.dragged=c.container.find("li.dragged");}}else{if(c.check("draggable",h)){a.drag_drop.drag_node=h;a.drag_drop.drag_help=b("<div id='jstree-dragged' class='tree "+(c.settings.ui.theme_name!=""?" tree-"+c.settings.ui.theme_name:"")+"' />").append("<ul class='"+c.container.children("ul:eq(0)").get(0).className+"' />");
var e=h.clone();if(c.settings.languages.length>0){e.find("a").not("."+c.current_lang).hide();}a.drag_drop.drag_help.children("ul:eq(0)").append(e);a.drag_drop.drag_help.find("li:eq(0)").removeClass("last").addClass("last");a.drag_drop.isdown=true;a.drag_drop.foreign=false;a.drag_drop.origin_tree=c;h.addClass("dragged");a.drag_drop.dragged=c.container.find("li.dragged");}}a.drag_drop.init_x=g.pageX;a.drag_drop.init_y=g.pageY;h.blur();g.preventDefault();g.stopPropagation();return false;});},focus:function(){if(this.locked){return false;}if(a.focused!=this.cntr){a.focused=this.cntr;this.callback("onfocus",[this]);}},off_height:function(){if(this.offset===false){this.container.css({position:"relative"});this.offset=this.container.offset();var c=0;c=parseInt(b.curCSS(this.container.get(0),"paddingTop",true),10);if(c){this.offset.top+=c;}c=parseInt(b.curCSS(this.container.get(0),"borderTopWidth",true),10);if(c){this.offset.top+=c;}this.container.css({position:""});}if(!this.li_height){var c=this.container.find("ul li.closed, ul li.leaf").eq(0);
this.li_height=c.height();if(c.children("ul:eq(0)").size()){this.li_height-=c.children("ul:eq(0)").height();}if(!this.li_height){this.li_height=18;}}},scroll_check:function(d,k){var j=this;var f=j.container;var h=j.container.offset();var e=f.scrollTop();var c=f.scrollLeft();var g=(f.get(0).scrollWidth>f.width())?40:20;if(k-h.top<20){f.scrollTop(Math.max((e-j.settings.ui.scroll_spd),0));}if(f.height()-(k-h.top)<g){f.scrollTop(e+j.settings.ui.scroll_spd);}if(d-h.left<20){f.scrollLeft(Math.max((c-j.settings.ui.scroll_spd),0));}if(f.width()-(d-h.left)<40){f.scrollLeft(c+j.settings.ui.scroll_spd);}if(f.scrollLeft()!=c||f.scrollTop()!=e){a.drag_drop.move_type=false;a.drag_drop.ref_node=false;a.drag_drop.marker.hide();}a.drag_drop.scroll_time=setTimeout(function(){j.scroll_check(d,k);},50);},scroll_into_view:function(g){g=g?this.get_node(g):this.selected;if(!g){return false;}var d=g.offset().top;var c=this.container.offset().top;var e=c+this.container.height();var f=(this.container.get(0).scrollWidth>this.container.width())?40:20;
if(d+5<c){this.container.scrollTop(this.container.scrollTop()-(c-d+5));}if(d+f>e){this.container.scrollTop(this.container.scrollTop()+(d+f-e));}},get_node:function(c){return b(c).closest("li");},get_type:function(d){d=!d?this.selected:this.get_node(d);if(!d){return;}var c=d.attr(this.settings.rules.type_attr);return c||"default";},set_type:function(d,c){c=!c?this.selected:this.get_node(c);if(!c||!d){return;}c.attr(this.settings.rules.type_attr,d);},get_text:function(c,e){c=this.get_node(c);if(!c||c.size()==0){return"";}if(this.settings.languages&&this.settings.languages.length){e=e?e:this.current_lang;c=c.children("a."+e);}else{c=c.children("a:visible");}var d="";c.contents().each(function(){if(this.nodeType==3){d=this.data;return false;}});return d;},check:function(f,e){if(this.locked){return false;}var c=false;if(e===-1){if(typeof this.settings.rules[f]!="undefined"){c=this.settings.rules[f];}}else{e=!e?this.selected:this.get_node(e);if(!e){return;}var d=this.get_type(e);if(typeof this.settings.types[d]!="undefined"&&typeof this.settings.types[d][f]!="undefined"){c=this.settings.types[d][f];
}else{if(typeof this.settings.types["default"]!="undefined"&&typeof this.settings.types["default"][f]!="undefined"){c=this.settings.types["default"][f];}}}if(typeof c=="function"){c=c.call(null,e,this);}c=this.callback("check",[f,e,c,this]);return c;},check_move:function(u,k,l){if(this.locked){return false;}if(b(k).closest("li.dragged").size()){return false;}var q=u.parents(".tree:eq(0)").get(0);var n=k.parents(".tree:eq(0)").get(0);if(q&&q!=n){var f=b.tree.reference(n.id).settings.rules.multitree;if(f=="none"||(b.isArray(f)&&b.inArray(q.id,f)==-1)){return false;}}var e=(l!="inside")?this.parent(k):this.get_node(k);u=this.get_node(u);if(e==false){return false;}var c={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",e):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",e):-1,valid_children:this.check("valid_children",e)};var j=(typeof u=="string")?u:this.get_type(u);if(typeof c.valid_children!="undefined"&&(c.valid_children=="none"||(typeof c.valid_children=="object"&&b.inArray(j,b.makeArray(c.valid_children))==-1))){return false;
}if(this.settings.rules.use_max_children){if(typeof c.max_children!="undefined"&&c.max_children!=-1){if(c.max_children==0){return false;}var h=1;if(a.drag_drop.moving==true&&a.drag_drop.foreign==false){h=a.drag_drop.dragged.size();h=h-e.find("> ul > li.dragged").size();}if(c.max_children<e.find("> ul > li").size()+h){return false;}}}if(this.settings.rules.use_max_depth){if(typeof c.max_depth!="undefined"&&c.max_depth===0){return this.error("MOVE: MAX-DEPTH REACHED");}var o=(c.max_depth>0)?c.max_depth:false;var g=0;var s=e;while(s!==-1){s=this.parent(s);g++;var f=this.check("max_depth",s);if(f>=0){o=(o===false)?(f-g):Math.min(o,f-g);}if(o!==false&&o<=0){return this.error("MOVE: MAX-DEPTH REACHED");}}if(o!==false&&o<=0){return this.error("MOVE: MAX-DEPTH REACHED");}if(o!==false){var d=1;if(typeof u!="string"){var s=u;while(s.size()>0){if(o-d<0){return this.error("MOVE: MAX-DEPTH REACHED");}s=s.children("ul").children("li");d++;}}}}if(this.callback("check_move",[u,k,l,this])==false){return false;
}return true;},hover_branch:function(c){if(this.locked){return this.error("LOCKED");}var d=this;var c=d.get_node(c);if(!c.size()){return this.error("HOVER: NOT A VALID NODE");}if(!d.check("clickable",c)){return this.error("SELECT: NODE NOT SELECTABLE");}if(this.hovered){this.hovered.children("A").removeClass("hover");}this.hovered=c;this.hovered.children("a").addClass("hover");this.scroll_into_view(this.hovered);},select_branch:function(e,c){if(this.locked){return this.error("LOCKED");}if(!e&&this.hovered!==false){e=this.hovered;}var f=this;e=f.get_node(e);if(!e.size()){return this.error("SELECT: NOT A VALID NODE");}e.children("a").removeClass("hover");if(!f.check("clickable",e)){return this.error("SELECT: NODE NOT SELECTABLE");}if(f.callback("beforechange",[e.get(0),f])===false){return this.error("SELECT: STOPPED BY USER");}if(this.settings.rules.multiple!=false&&c&&e.children("a.clicked").size()>0){return this.deselect_branch(e);}if(this.settings.rules.multiple!=false&&c){this.selected_arr.push(e);
}if(this.settings.rules.multiple!=false&&!c){for(var d in this.selected_arr){if(!this.selected_arr.hasOwnProperty(d)){continue;}this.selected_arr[d].children("A").removeClass("clicked");this.callback("ondeselect",[this.selected_arr[d].get(0),f]);}this.selected_arr=[];this.selected_arr.push(e);if(this.selected&&this.selected.children("A").hasClass("clicked")){this.selected.children("A").removeClass("clicked");this.callback("ondeselect",[this.selected.get(0),f]);}}if(!this.settings.rules.multiple){if(this.selected){this.selected.children("A").removeClass("clicked");this.callback("ondeselect",[this.selected.get(0),f]);}}this.selected=e;if(this.hovered!==false){this.hovered.children("A").removeClass("hover");this.hovered=e;}this.selected.children("a").addClass("clicked").end().parents("li.closed").each(function(){f.open_branch(this,true);});this.scroll_into_view(this.selected);this.callback("onselect",[this.selected.get(0),f]);this.callback("onchange",[this.selected.get(0),f]);},deselect_branch:function(c){if(this.locked){return this.error("LOCKED");
}var d=this;var c=this.get_node(c);if(c.children("a.clicked").size()==0){return this.error("DESELECT: NODE NOT SELECTED");}c.children("a").removeClass("clicked");this.callback("ondeselect",[c.get(0),d]);if(this.settings.rules.multiple!=false&&this.selected_arr.length>1){this.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){d.selected_arr.push(b(this));});if(c.get(0)==this.selected.get(0)){this.selected=this.selected_arr[0];}}else{if(this.settings.rules.multiple!=false){this.selected_arr=[];}this.selected=false;}this.callback("onchange",[c.get(0),d]);},toggle_branch:function(c){if(this.locked){return this.error("LOCKED");}var c=this.get_node(c);if(c.hasClass("closed")){return this.open_branch(c);}if(c.hasClass("open")){return this.close_branch(c);}},open_branch:function(d,c,g){var f=this;if(this.locked){return this.error("LOCKED");}var d=this.get_node(d);if(!d.size()){return this.error("OPEN: NO SUCH NODE");}if(d.hasClass("leaf")){return this.error("OPEN: OPENING LEAF NODE");
}if(this.settings.data.async&&d.find("li").size()==0){if(this.callback("beforeopen",[d.get(0),this])===false){return this.error("OPEN: STOPPED BY USER");}d.children("ul:eq(0)").remove().end().append("<ul><li class='last'><a class='loading' href='#'><ins>&nbsp;</ins>"+(f.settings.lang.loading||"Loading ...")+"</a></li></ul>");d.removeClass("closed").addClass("open");var e=new b.tree.datastores[this.settings.data.type]();e.load(this.callback("beforedata",[d,this]),this,this.settings.data.opts,function(h){h=f.callback("ondata",[h,f]);if(!h||h.length==0){d.removeClass("closed").removeClass("open").addClass("leaf").children("ul").remove();if(g){g.call();}return;}e.parse(h,f,f.settings.data.opts,function(j){j=f.callback("onparse",[j,f]);d.children("ul:eq(0)").replaceWith(b("<ul>").html(j));d.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");d.find("li").not(".open").not(".closed").addClass("leaf");f.open_branch.apply(f,[d]);if(g){g.call();}});});return true;
}else{if(!this.settings.data.async){if(this.callback("beforeopen",[d.get(0),this])===false){return this.error("OPEN: STOPPED BY USER");}}if(parseInt(this.settings.ui.animation)>0&&!c){d.children("ul:eq(0)").css("display","none");d.removeClass("closed").addClass("open");d.children("ul:eq(0)").slideDown(parseInt(this.settings.ui.animation),function(){b(this).css("display","");if(g){g.call();}});}else{d.removeClass("closed").addClass("open");if(g){g.call();}}this.callback("onopen",[d.get(0),this]);return true;}},close_branch:function(d,c){if(this.locked){return this.error("LOCKED");}var e=this;var d=this.get_node(d);if(!d.size()){return this.error("CLOSE: NO SUCH NODE");}if(e.callback("beforeclose",[d.get(0),e])===false){return this.error("CLOSE: STOPPED BY USER");}if(parseInt(this.settings.ui.animation)>0&&!c&&d.children("ul:eq(0)").size()==1){d.children("ul:eq(0)").slideUp(parseInt(this.settings.ui.animation),function(){if(d.hasClass("open")){d.removeClass("open").addClass("closed");}b(this).css("display","");
});}else{if(d.hasClass("open")){d.removeClass("open").addClass("closed");}}if(this.selected&&this.settings.ui.selected_parent_close!==false&&d.children("ul:eq(0)").find("a.clicked").size()>0){d.find("li:has(a.clicked)").each(function(){e.deselect_branch(this);});if(this.settings.ui.selected_parent_close=="select_parent"&&d.children("a.clicked").size()==0){this.select_branch(d,(this.settings.rules.multiple!=false&&this.selected_arr.length>0));}}this.callback("onclose",[d.get(0),this]);},open_all:function(d,f){if(this.locked){return this.error("LOCKED");}var e=this;d=d?this.get_node(d):this.container;var c=d.find("li.closed").size();if(!f){this.cl_count=0;}else{this.cl_count--;}if(c>0){this.cl_count+=c;d.find("li.closed").each(function(){var g=this;e.open_branch.apply(e,[this,true,function(){e.open_all.apply(e,[g,true]);}]);});}else{if(this.cl_count==0){this.callback("onopen_all",[this]);}}},close_all:function(c){if(this.locked){return this.error("LOCKED");}var d=this;c=c?this.get_node(c):this.container;
c.find("li.open").each(function(){d.close_branch(this,true);});this.callback("onclose_all",[this]);},set_lang:function(d){if(!b.isArray(this.settings.languages)||this.settings.languages.length==0){return false;}if(this.locked){return this.error("LOCKED");}if(!b.inArray(d,this.settings.languages)&&typeof this.settings.languages[d]!="undefined"){d=this.settings.languages[d];}if(typeof d=="undefined"){return false;}if(d==this.current_lang){return true;}var c=false;var e="#"+this.container.attr("id");c=a.get_css(e+" ."+this.current_lang);if(c!==false){c.style.display="none";}c=a.get_css(e+" ."+d);if(c!==false){c.style.display="";}this.current_lang=d;return true;},get_lang:function(){if(!b.isArray(this.settings.languages)||this.settings.languages.length==0){return false;}return this.current_lang;},create:function(h,d,x){if(this.locked){return this.error("LOCKED");}var p=false;if(d==-1){p=true;d=this.container;}else{d=d?this.get_node(d):this.selected;}if(!p&&(!d||!d.size())){return this.error("CREATE: NO NODE SELECTED");
}var e=x;var v=d;if(x=="before"){x=d.parent().children().index(d);d=d.parents("li:eq(0)");}if(x=="after"){x=d.parent().children().index(d)+1;d=d.parents("li:eq(0)");}if(!p&&d.size()==0){p=true;d=this.container;}if(!p){if(!this.check("creatable",d)){return this.error("CREATE: CANNOT CREATE IN NODE");}if(d.hasClass("closed")){if(this.settings.data.async&&d.children("ul").size()==0){var q=this;return this.open_branch(d,true,function(){q.create.apply(q,[h,d,x]);});}else{this.open_branch(d,true);}}}var c=false;if(!h){h={};}else{h=b.extend(true,{},h);}if(!h.attributes){h.attributes={};}if(!h.attributes[this.settings.rules.type_attr]){h.attributes[this.settings.rules.type_attr]=this.get_type(v)||"default";}if(this.settings.languages.length){if(!h.data){h.data={};c=true;}for(var s=0;s<this.settings.languages.length;s++){if(!h.data[this.settings.languages[s]]){h.data[this.settings.languages[s]]=((typeof this.settings.lang.new_node).toLowerCase()!="string"&&this.settings.lang.new_node[s])?this.settings.lang.new_node[s]:this.settings.lang.new_node;
}}}else{if(!h.data){h.data=this.settings.lang.new_node;c=true;}}h=this.callback("ondata",[h,this]);var n=b.tree.datastores.json().parse(h,this);n=this.callback("onparse",[n,this]);var g=b(n);if(g.children("ul").size()){if(!g.is(".open")){g.addClass("closed");}}else{g.addClass("leaf");}g.find("li:last-child").addClass("last").end().find("li:has(ul)").not(".open").addClass("closed");g.find("li").not(".open").not(".closed").addClass("leaf");var l={max_depth:this.settings.rules.use_max_depth?this.check("max_depth",(p?-1:d)):-1,max_children:this.settings.rules.use_max_children?this.check("max_children",(p?-1:d)):-1,valid_children:this.check("valid_children",(p?-1:d))};var f=this.get_type(g);if(typeof l.valid_children!="undefined"&&(l.valid_children=="none"||(b.isArray(l.valid_children)&&b.inArray(f,l.valid_children)==-1))){return this.error("CREATE: NODE NOT A VALID CHILD");}if(this.settings.rules.use_max_children){if(typeof l.max_children!="undefined"&&l.max_children!=-1&&l.max_children>=this.children(d).size()){return this.error("CREATE: MAX_CHILDREN REACHED");
}}if(this.settings.rules.use_max_depth){if(typeof l.max_depth!="undefined"&&l.max_depth===0){return this.error("CREATE: MAX-DEPTH REACHED");}var k=(l.max_depth>0)?l.max_depth:false;var s=0;var j=d;while(j!==-1&&!p){j=this.parent(j);s++;var o=this.check("max_depth",j);if(o>=0){k=(k===false)?(o-s):Math.min(k,o-s);}if(k!==false&&k<=0){return this.error("CREATE: MAX-DEPTH REACHED");}}if(k!==false&&k<=0){return this.error("CREATE: MAX-DEPTH REACHED");}if(k!==false){var u=1;var j=g;while(j.size()>0){if(k-u<0){return this.error("CREATE: MAX-DEPTH REACHED");}j=j.children("ul").children("li");u++;}}}if((typeof x).toLowerCase()=="undefined"||x=="inside"){x=(this.settings.rules.createat=="top")?0:d.children("ul:eq(0)").children("li").size();}if(d.children("ul").size()==0||(p==true&&d.children("ul").children("li").size()==0)){if(!p){var w=this.moved(g,d.children("a:eq(0)"),"inside",true);}else{var w=this.moved(g,this.container.children("ul:eq(0)"),"inside",true);}}else{if(e=="before"&&d.children("ul:eq(0)").children("li:nth-child("+(x+1)+")").size()){var w=this.moved(g,d.children("ul:eq(0)").children("li:nth-child("+(x+1)+")").children("a:eq(0)"),"before",true);
}else{if(e=="after"&&d.children("ul:eq(0)").children("li:nth-child("+(x)+")").size()){var w=this.moved(g,d.children("ul:eq(0)").children("li:nth-child("+(x)+")").children("a:eq(0)"),"after",true);}else{if(d.children("ul:eq(0)").children("li:nth-child("+(x+1)+")").size()){var w=this.moved(g,d.children("ul:eq(0)").children("li:nth-child("+(x+1)+")").children("a:eq(0)"),"before",true);}else{var w=this.moved(g,d.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",true);}}}}if(w===false){return this.error("CREATE: ABORTED");}if(c){this.select_branch(g.children("a:eq(0)"));this.rename();}return g;},rename:function(h,e){if(this.locked){return this.error("LOCKED");}h=h?this.get_node(h):this.selected;var j=this;if(!h||!h.size()){return this.error("RENAME: NO NODE SELECTED");}if(!this.check("renameable",h)){return this.error("RENAME: NODE NOT RENAMABLE");}if(!this.callback("beforerename",[h.get(0),j.current_lang,j])){return this.error("RENAME: STOPPED BY USER");}h.parents("li.closed").each(function(){j.open_branch(this);
});if(this.current_lang){h=h.find("a."+this.current_lang);}else{h=h.find("a:first");}var g={};g[this.container.attr("id")]=this.get_rollback();var f=h.children("ins").clone();if((typeof e).toLowerCase()=="string"){h.text(e).prepend(f);j.callback("onrename",[j.get_node(h).get(0),j,g]);}else{var c="";h.contents().each(function(){if(this.nodeType==3){c=this.data;return false;}});j.inp=b("<input type='text' autocomplete='off' />");j.inp.val(c.replace(/&amp;/g,"&").replace(/&gt;/g,">").replace(/&lt;/g,"<")).bind("mousedown",function(k){k.stopPropagation();}).bind("mouseup",function(k){k.stopPropagation();}).bind("click",function(k){k.stopPropagation();}).bind("keyup",function(l){var k=l.keyCode||l.which;if(k==27){this.value=c;this.blur();return;}if(k==13){this.blur();return;}});j.inp.blur(function(k){if(this.value==""){this.value=c;}h.text(this.value).prepend(f);h.get(0).style.display="";h.prevAll("span").remove();j.inp=false;j.callback("onrename",[j.get_node(h).get(0),j,g]);});var d=b("<span />").addClass(h.attr("class")).append(f).append(j.inp);
h.get(0).style.display="none";h.parent().prepend(d);j.inp.get(0).focus();j.inp.get(0).select();}},remove:function(g){if(this.locked){return this.error("LOCKED");}var h=this;var f={};f[this.container.attr("id")]=this.get_rollback();if(g&&(!this.selected||this.get_node(g).get(0)!=this.selected.get(0))){g=this.get_node(g);if(g.size()){if(!this.check("deletable",g)){return this.error("DELETE: NODE NOT DELETABLE");}if(!this.callback("beforedelete",[g.get(0),h])){return this.error("DELETE: STOPPED BY USER");}$parent=g.parent();if(g.find("a.clicked").size()){var e=false;h.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){if(!e&&this==h.selected.get(0)){e=true;}if(b(this).parents().index(g)!=-1){return true;}h.selected_arr.push(b(this));});if(e){this.selected=this.selected_arr[0]||false;}}g=g.remove();$parent.children("li:last").addClass("last");if($parent.children("li").size()==0){$li=$parent.parents("li:eq(0)");$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();
}this.callback("ondelete",[g.get(0),this,f]);}}else{if(this.selected){if(!this.check("deletable",this.selected)){return this.error("DELETE: NODE NOT DELETABLE");}if(!this.callback("beforedelete",[this.selected.get(0),h])){return this.error("DELETE: STOPPED BY USER");}$parent=this.selected.parent();var g=this.selected;if(this.settings.rules.multiple==false||this.selected_arr.length==1){var d=true;var c=this.settings.ui.selected_delete=="select_previous"?this.prev(this.selected):false;}g=g.remove();$parent.children("li:last").addClass("last");if($parent.children("li").size()==0){$li=$parent.parents("li:eq(0)");$li.removeClass("open").removeClass("closed").addClass("leaf").children("ul").remove();}if(!d&&this.settings.rules.multiple!=false){var h=this;this.selected_arr=[];this.container.find("a.clicked").filter(":first-child").parent().each(function(){h.selected_arr.push(b(this));});if(this.selected_arr.length>0){this.selected=this.selected_arr[0];this.remove();}}if(d&&c){this.select_branch(c);
}this.callback("ondelete",[g.get(0),this,f]);}else{return this.error("DELETE: NO NODE SELECTED");}}},next:function(d,c){d=this.get_node(d);if(!d.size()){return false;}if(c){return(d.nextAll("li").size()>0)?d.nextAll("li:eq(0)"):false;}if(d.hasClass("open")){return d.find("li:eq(0)");}else{if(d.nextAll("li").size()>0){return d.nextAll("li:eq(0)");}else{return d.parents("li").next("li").eq(0);}}},prev:function(d,c){d=this.get_node(d);if(!d.size()){return false;}if(c){return(d.prevAll("li").size()>0)?d.prevAll("li:eq(0)"):false;}if(d.prev("li").size()){var d=d.prev("li").eq(0);while(d.hasClass("open")){d=d.children("ul:eq(0)").children("li:last");}return d;}else{return d.parents("li:eq(0)").size()?d.parents("li:eq(0)"):false;}},parent:function(c){c=this.get_node(c);if(!c.size()){return false;}return c.parents("li:eq(0)").size()?c.parents("li:eq(0)"):-1;},children:function(c){if(c===-1){return this.container.children("ul:eq(0)").children("li");}c=this.get_node(c);if(!c.size()){return false;
}return c.children("ul:eq(0)").children("li");},toggle_dots:function(){if(this.settings.ui.dots){this.settings.ui.dots=false;this.container.children("ul:eq(0)").addClass("no_dots");}else{this.settings.ui.dots=true;this.container.children("ul:eq(0)").removeClass("no_dots");}},callback:function(c,d){var g=false;var f=null;for(var e in this.settings.plugins){if(typeof b.tree.plugins[e]!="object"){continue;}g=b.tree.plugins[e];if(g.callbacks&&typeof g.callbacks[c]=="function"){f=g.callbacks[c].apply(this,d);}if(typeof f!=="undefined"&&f!==null){if(c=="ondata"||c=="onparse"){d[0]=f;}else{return f;}}}g=this.settings.callback[c];if(typeof g=="function"){return g.apply(null,d);}},get_rollback:function(){var c={};c.html=this.container.html();c.selected=this.selected?this.selected.attr("id"):false;return c;},moved:function(q,l,r,c,s,d){var q=b(q);var f=b(q).parents("ul:eq(0)");var g=b(l);if(g.is("ins")){g=g.parent();}if(!d){var d={};d[this.container.attr("id")]=this.get_rollback();if(!c){var k=q.size()>1?q.eq(0).parents(".tree:eq(0)"):q.parents(".tree:eq(0)");
if(k.get(0)!=this.container.get(0)){k=a.inst[k.attr("id")];d[k.container.attr("id")]=k.get_rollback();}delete k;}}if(r=="inside"&&this.settings.data.async){var m=this;if(this.get_node(g).hasClass("closed")){return this.open_branch(this.get_node(g),true,function(){m.moved.apply(m,[q,l,r,c,s,d]);});}if(this.get_node(g).find("> ul > li > a.loading").size()==1){setTimeout(function(){m.moved.apply(m,[q,l,r,c,s]);},200);return;}}if(q.size()>1){var m=this;var k=this.moved(q.eq(0),l,r,false,s,d);q.each(function(j){if(j==0){return;}if(k){k=m.moved(this,k.children("a:eq(0)"),"after",false,s,d);}});return q;}if(s){_what=q.clone();_what.each(function(j){this.id=this.id+"_copy";b(this).find("li").each(function(){this.id=this.id+"_copy";});b(this).removeClass("dragged").find("a.clicked").removeClass("clicked").end().find("li.dragged").removeClass("dragged");});}else{_what=q;}if(c){if(!this.callback("beforecreate",[this.get_node(q).get(0),this.get_node(l).get(0),r,this])){return false;}}else{if(!this.callback("beforemove",[this.get_node(q).get(0),this.get_node(l).get(0),r,this])){return false;
}}if(!c){var k=q.parents(".tree:eq(0)");if(k.get(0)!=this.container.get(0)){k=a.inst[k.attr("id")];if(k.settings.languages.length){var o=[];if(this.settings.languages.length==0){o.push("."+k.current_lang);}else{for(var h in this.settings.languages){if(!this.settings.languages.hasOwnProperty(h)){continue;}for(var e in k.settings.languages){if(!k.settings.languages.hasOwnProperty(e)){continue;}if(this.settings.languages[h]==k.settings.languages[e]){o.push("."+this.settings.languages[h]);}}}}if(o.length==0){return this.error("MOVE: NO COMMON LANGUAGES");}_what.find("a").not(o.join(",")).remove();}_what.find("a.clicked").removeClass("clicked");}}q=_what;switch(r){case"before":g.parents("ul:eq(0)").children("li.last").removeClass("last");g.parent().before(q.removeClass("last"));g.parents("ul:eq(0)").children("li:last").addClass("last");break;case"after":g.parents("ul:eq(0)").children("li.last").removeClass("last");g.parent().after(q.removeClass("last"));g.parents("ul:eq(0)").children("li:last").addClass("last");
break;case"inside":if(g.parent().children("ul:first").size()){if(this.settings.rules.createat=="top"){g.parent().children("ul:first").prepend(q.removeClass("last")).children("li:last").addClass("last");var n=g.parent().children("ul:first").children("li:first");if(n.size()){r="before";l=n;}}else{var n=g.parent().children("ul:first").children(".last");if(n.size()){r="after";l=n;}g.parent().children("ul:first").children(".last").removeClass("last").end().append(q.removeClass("last")).children("li:last").addClass("last");}}else{q.addClass("last");g.parent().removeClass("leaf").append("<ul/>");if(!g.parent().hasClass("open")){g.parent().addClass("closed");}g.parent().children("ul:first").prepend(q);}if(g.parent().hasClass("closed")){this.open_branch(g);}break;default:break;}if(f.find("li").size()==0){var p=f.parent();p.removeClass("open").removeClass("closed").addClass("leaf");if(!p.is(".tree")){p.children("ul").remove();}p.parents("ul:eq(0)").children("li.last").removeClass("last").end().children("li:last").addClass("last");
}else{f.children("li.last").removeClass("last");f.children("li:last").addClass("last");}if(s){this.callback("oncopy",[this.get_node(q).get(0),this.get_node(l).get(0),r,this,d]);}else{if(c){this.callback("oncreate",[this.get_node(q).get(0),(g.is("ul")?-1:this.get_node(l).get(0)),r,this,d]);}else{this.callback("onmove",[this.get_node(q).get(0),this.get_node(l).get(0),r,this,d]);}}return q;},error:function(c){this.callback("error",[c,this]);return false;},lock:function(c){this.locked=c;if(this.locked){this.container.children("ul:eq(0)").addClass("locked");}else{this.container.children("ul:eq(0)").removeClass("locked");}},cut:function(c){if(this.locked){return this.error("LOCKED");}c=c?this.get_node(c):this.container.find("a.clicked").filter(":first-child").parent();if(!c||!c.size()){return this.error("CUT: NO NODE SELECTED");}a.cut_copy.copy_nodes=false;a.cut_copy.cut_nodes=c;},copy:function(c){if(this.locked){return this.error("LOCKED");}c=c?this.get_node(c):this.container.find("a.clicked").filter(":first-child").parent();
if(!c||!c.size()){return this.error("COPY: NO NODE SELECTED");}a.cut_copy.copy_nodes=c;a.cut_copy.cut_nodes=false;},paste:function(g,c){if(this.locked){return this.error("LOCKED");}var e=false;if(g==-1){e=true;g=this.container;}else{g=g?this.get_node(g):this.selected;}if(!e&&(!g||!g.size())){return this.error("PASTE: NO NODE SELECTED");}if(!a.cut_copy.copy_nodes&&!a.cut_copy.cut_nodes){return this.error("PASTE: NOTHING TO DO");}var j=this;var h=c;if(c=="before"){c=g.parent().children().index(g);g=g.parents("li:eq(0)");}else{if(c=="after"){c=g.parent().children().index(g)+1;g=g.parents("li:eq(0)");}else{if((typeof c).toLowerCase()=="undefined"||c=="inside"){c=(this.settings.rules.createat=="top")?0:g.children("ul:eq(0)").children("li").size();}}}if(!e&&g.size()==0){e=true;g=this.container;}if(a.cut_copy.copy_nodes&&a.cut_copy.copy_nodes.size()){var f=true;if(!e&&!this.check_move(a.cut_copy.copy_nodes,g.children("a:eq(0)"),"inside")){return false;}if(g.children("ul").size()==0||(e==true&&g.children("ul").children("li").size()==0)){if(!e){var d=this.moved(a.cut_copy.copy_nodes,g.children("a:eq(0)"),"inside",false,true);
}else{var d=this.moved(a.cut_copy.copy_nodes,this.container.children("ul:eq(0)"),"inside",false,true);}}else{if(h=="before"&&g.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()){var d=this.moved(a.cut_copy.copy_nodes,g.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before",false,true);}else{if(h=="after"&&g.children("ul:eq(0)").children("li:nth-child("+(c)+")").size()){var d=this.moved(a.cut_copy.copy_nodes,g.children("ul:eq(0)").children("li:nth-child("+(c)+")").children("a:eq(0)"),"after",false,true);}else{if(g.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()){var d=this.moved(a.cut_copy.copy_nodes,g.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before",false,true);}else{var d=this.moved(a.cut_copy.copy_nodes,g.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after",false,true);}}}}a.cut_copy.copy_nodes=false;}if(a.cut_copy.cut_nodes&&a.cut_copy.cut_nodes.size()){var f=true;g.parents().andSelf().each(function(){if(a.cut_copy.cut_nodes.index(this)!=-1){f=false;
return false;}});if(!f){return this.error("Invalid paste");}if(!e&&!this.check_move(a.cut_copy.cut_nodes,g.children("a:eq(0)"),"inside")){return false;}if(g.children("ul").size()==0||(e==true&&g.children("ul").children("li").size()==0)){if(!e){var d=this.moved(a.cut_copy.cut_nodes,g.children("a:eq(0)"),"inside");}else{var d=this.moved(a.cut_copy.cut_nodes,this.container.children("ul:eq(0)"),"inside");}}else{if(h=="before"&&g.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()){var d=this.moved(a.cut_copy.cut_nodes,g.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before");}else{if(h=="after"&&g.children("ul:eq(0)").children("li:nth-child("+(c)+")").size()){var d=this.moved(a.cut_copy.cut_nodes,g.children("ul:eq(0)").children("li:nth-child("+(c)+")").children("a:eq(0)"),"after");}else{if(g.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").size()){var d=this.moved(a.cut_copy.cut_nodes,g.children("ul:eq(0)").children("li:nth-child("+(c+1)+")").children("a:eq(0)"),"before");
}else{var d=this.moved(a.cut_copy.cut_nodes,g.children("ul:eq(0)").children("li:last").children("a:eq(0)"),"after");}}}}a.cut_copy.cut_nodes=false;}},search:function(k,c){var h=this;if(!k||(this.srch&&k!=this.srch)){this.srch="";this.srch_opn=false;this.container.find("a.search").removeClass("search");}this.srch=k;if(!k){return;}if(!c){c="contains";}if(this.settings.data.async){if(!this.srch_opn){var l=b.extend({search:k},this.callback("beforedata",[false,this]));b.ajax({type:this.settings.data.opts.method,url:this.settings.data.opts.url,data:l,dataType:"text",success:function(j){h.srch_opn=b.unique(j.split(","));h.search.apply(h,[k,c]);}});}else{if(this.srch_opn.length){if(this.srch_opn&&this.srch_opn.length){var e=false;for(var f=0;f<this.srch_opn.length;f++){if(this.get_node("#"+this.srch_opn[f]).size()>0){e=true;var g="#"+this.srch_opn[f];delete this.srch_opn[f];this.open_branch(g,true,function(){h.search.apply(h,[k,c]);});}}if(!e){this.srch_opn=[];h.search.apply(h,[k,c]);}}}else{this.srch_opn=false;
var d="a";if(this.settings.languages.length){d+="."+this.current_lang;}this.callback("onsearch",[this.container.find(d+":"+c+"('"+k+"')"),this]);}}}else{var d="a";if(this.settings.languages.length){d+="."+this.current_lang;}var m=this.container.find(d+":"+c+"('"+k+"')");m.parents("li.closed").each(function(){h.open_branch(this,true);});this.callback("onsearch",[m,this]);}},add_sheet:a.add_sheet,destroy:function(){this.callback("ondestroy",[this]);this.container.unbind(".jstree");b("#"+this.container.attr("id")).die("click.jstree").die("dblclick.jstree").die("mouseover.jstree").die("mouseout.jstree").die("mousedown.jstree");this.container.removeClass("tree ui-widget ui-widget-content tree-default tree-"+this.settings.ui.theme_name).children("ul").removeClass("no_dots ltr locked").find("li").removeClass("leaf").removeClass("open").removeClass("closed").removeClass("last").children("a").removeClass("clicked hover search");if(this.cntr==a.focused){for(var c in a.inst){if(c!=this.cntr&&c!=this.container.attr("id")){a.inst[c].focus();
break;}}}a.inst[this.cntr]=false;a.inst[this.container.attr("id")]=false;delete a.inst[this.cntr];delete a.inst[this.container.attr("id")];a.cntr--;}};}a.cntr=0;a.inst={};a.themes=[];a.drag_drop={isdown:false,drag_node:false,drag_help:false,dragged:false,init_x:false,init_y:false,moving:false,origin_tree:false,marker:false,move_type:false,ref_node:false,appended:false,foreign:false,droppable:[],open_time:false,scroll_time:false};a.mouseup=function(e){var d=a.drag_drop;if(d.open_time){clearTimeout(d.open_time);}if(d.scroll_time){clearTimeout(d.scroll_time);}if(d.moving&&b.tree.drag_end!==false){b.tree.drag_end.call(null,e,d);}if(d.foreign===false&&d.drag_node&&d.drag_node.size()){d.drag_help.remove();if(d.move_type){var c=a.inst[d.ref_node.parents(".tree:eq(0)").attr("id")];if(c){c.moved(d.dragged,d.ref_node,d.move_type,false,(d.origin_tree.settings.rules.drag_copy=="on"||(d.origin_tree.settings.rules.drag_copy=="ctrl"&&e.ctrlKey)));}}d.move_type=false;d.ref_node=false;}if(d.foreign!==false){if(d.drag_help){d.drag_help.remove();
}if(d.move_type){var c=a.inst[d.ref_node.parents(".tree:eq(0)").attr("id")];if(c){c.callback("ondrop",[d.f_data,c.get_node(d.ref_node).get(0),d.move_type,c]);}}d.foreign=false;d.move_type=false;d.ref_node=false;}if(a.drag_drop.marker){a.drag_drop.marker.hide();}if(d.dragged&&d.dragged.size()){d.dragged.removeClass("dragged");}d.dragged=false;d.drag_help=false;d.drag_node=false;d.f_type=false;d.f_data=false;d.init_x=false;d.init_y=false;d.moving=false;d.appended=false;d.origin_tree=false;if(d.isdown){d.isdown=false;e.preventDefault();e.stopPropagation();return false;}};a.mousemove=function(c){var g=a.drag_drop;var m=false;if(g.isdown){if(!g.moving&&Math.abs(g.init_x-c.pageX)<5&&Math.abs(g.init_y-c.pageY)<5){c.preventDefault();c.stopPropagation();return false;}else{if(!g.moving){a.drag_drop.moving=true;m=true;}}if(g.open_time){clearTimeout(g.open_time);}if(g.drag_help!==false){if(!g.appended){if(g.foreign!==false){g.origin_tree=b.tree.focused();}b("body").append(g.drag_help);g.w=g.drag_help.width();
g.appended=true;}g.drag_help.css({left:(c.pageX+5),top:(c.pageY+15)});}if(m&&b.tree.drag_start!==false){b.tree.drag_start.call(null,c,g);}if(b.tree.drag!==false){b.tree.drag.call(null,c,g);}if(c.target.tagName=="DIV"&&c.target.id=="jstree-marker"){return false;}var k=b(c.target);if(k.is("ins")){k=k.parent();}var e=k.is(".tree")?k:k.parents(".tree:eq(0)");if(e.size()==0||!a.inst[e.attr("id")]){if(g.scroll_time){clearTimeout(g.scroll_time);}if(g.drag_help!==false){g.drag_help.find("li:eq(0) ins").addClass("forbidden");}g.move_type=false;g.ref_node=false;a.drag_drop.marker.hide();return false;}var l=a.inst[e.attr("id")];l.off_height();if(g.scroll_time){clearTimeout(g.scroll_time);}g.scroll_time=setTimeout(function(){l.scroll_check(c.pageX,c.pageY);},50);var o=false;var p=e.scrollTop();if(c.target.tagName=="A"||c.target.tagName=="INS"){if(k.is("#jstree-dragged")){return false;}if(l.get_node(c.target).hasClass("closed")){g.open_time=setTimeout(function(){l.open_branch(k);},500);}var f=k.offset();
var d={x:(f.left-1),y:(c.pageY-f.top)};var h=[];if(d.y<l.li_height/3+1){h=["before","inside","after"];}else{if(d.y>l.li_height*2/3-1){h=["after","inside","before"];}else{if(d.y<l.li_height/2){h=["inside","before","after"];}else{h=["inside","after","before"];}}}var j=false;var n=(g.foreign==false)?g.origin_tree.container.find("li.dragged"):g.f_type;b.each(h,function(q,r){if(l.check_move(n,k,r)){o=r;j=true;return false;}});if(j){switch(o){case"before":d.y=f.top-2;a.drag_drop.marker.attr("class","marker");break;case"after":d.y=f.top-2+l.li_height;a.drag_drop.marker.attr("class","marker");break;case"inside":d.x-=2;d.y=f.top-2+l.li_height/2;a.drag_drop.marker.attr("class","marker_plus");break;}g.move_type=o;g.ref_node=b(c.target);if(g.drag_help!==false){g.drag_help.find(".forbidden").removeClass("forbidden");}a.drag_drop.marker.css({left:d.x,top:d.y}).show();}}if((k.is(".tree")||k.is("ul"))&&k.find("li:eq(0)").size()==0){var f=k.offset();g.move_type="inside";g.ref_node=e.children("ul:eq(0)");
if(g.drag_help!==false){g.drag_help.find(".forbidden").removeClass("forbidden");}a.drag_drop.marker.attr("class","marker_plus");a.drag_drop.marker.css({left:(f.left+10),top:f.top+15}).show();}else{if((c.target.tagName!="A"&&c.target.tagName!="INS")||!j){if(g.drag_help!==false){g.drag_help.find("li:eq(0) ins").addClass("forbidden");}g.move_type=false;g.ref_node=false;a.drag_drop.marker.hide();}}c.preventDefault();c.stopPropagation();return false;}return true;};b(function(){b(document).bind("mousemove.jstree",a.mousemove);b(document).bind("mouseup.jstree",a.mouseup);});a.cut_copy={copy_nodes:false,cut_nodes:false};a.css=false;a.get_css=function(f,d){f=f.toLowerCase();var e=a.css.cssRules||a.css.rules;var c=0;do{if(e.length&&c>e.length+5){return false;}if(e[c].selectorText&&e[c].selectorText.toLowerCase()==f){if(d==true){if(a.css.removeRule){document.styleSheets[i].removeRule(c);}if(a.css.deleteRule){document.styleSheets[i].deleteRule(c);}return true;}else{return e[c];}}}while(e[++c]);return false;
};a.add_css=function(c){if(a.get_css(c)){return false;}(a.css.insertRule)?a.css.insertRule(c+" { }",0):a.css.addRule(c,null,0);return a.get_css(c);};a.remove_css=function(c){return a.get_css(c,true);};a.add_sheet=function(d){if(d.str){var c=document.createElement("style");c.type="text/css";if(c.styleSheet){c.styleSheet.cssText=d.str;}else{c.appendChild(document.createTextNode(d.str));}document.getElementsByTagName("head")[0].appendChild(c);return c.sheet;}if(d.url){if(document.createStyleSheet){try{document.createStyleSheet(d.url);}catch(g){}}else{var f=document.createElement("link");f.rel="stylesheet";f.type="text/css";f.media="all";f.href=d.url;document.getElementsByTagName("head")[0].appendChild(f);return f.styleSheet;}}};b(function(){var d=navigator.userAgent.toLowerCase();var c=(d.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[0,"0"])[1];var e='/* TREE LAYOUT */ .tree ul { margin:0 0 0 5px; padding:0 0 0 0; list-style-type:none; } .tree li { display:block; min-height:18px; line-height:18px; padding:0 0 0 15px; margin:0 0 0 0; /* Background fix */ clear:both; } .tree li ul { display:none; } .tree li a, .tree li span { display:inline-block;line-height:16px;height:16px;color:black;white-space:nowrap;text-decoration:none;padding:1px 4px 1px 4px;margin:0; } .tree li a:focus { outline: none; } .tree li a input, .tree li span input { margin:0;padding:0 0;display:inline-block;height:12px ;border:1px solid white;background:white;font-size:10px;font-family:Verdana; } .tree li a input:not([class="xxx"]), .tree li span input:not([class="xxx"]) { padding:1px 0; } /* FOR DOTS */ .tree .ltr li.last { float:left; } .tree > ul li.last { overflow:visible; } /* OPEN OR CLOSE */ .tree li.open ul { display:block; } .tree li.closed ul { display:none ; } /* FOR DRAGGING */ #jstree-dragged { position:absolute; top:-10px; left:-10px; margin:0; padding:0; } #jstree-dragged ul ul ul { display:none; } #jstree-marker { padding:0; margin:0; line-height:5px; font-size:1px; overflow:hidden; height:5px; position:absolute; left:-45px; top:-30px; z-index:1000; background-color:transparent; background-repeat:no-repeat; display:none; } #jstree-marker.marker { width:45px; background-position:-32px top; } #jstree-marker.marker_plus { width:5px; background-position:right top; } /* BACKGROUND DOTS */ .tree li li { overflow:hidden; } .tree > .ltr > li { display:table; } /* ICONS */ .tree ul ins { display:inline-block; text-decoration:none; width:12px; height:12px; } .tree .ltr ins { margin:0 4px 0 0px; } ';
if(/msie/.test(d)&&!/opera/.test(d)){if(parseInt(c)==6){e+='.tree li { height:18px; zoom:1; } .tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); } .marker { width:45px; background-position:-32px top; } .marker_plus { width:5px; background-position:right top; }';}if(parseInt(c)==7){e+='.tree li li { overflow:visible; } .tree .ltr li.last { margin-top: expression( (this.previousSibling && /open/.test(this.previousSibling.className) ) ? "-2px" : "0"); }';}}if(/opera/.test(d)){e+='.tree > ul > li.last:after { content:"."; display: block; height:1px; clear:both; visibility:hidden; }';}if(/mozilla/.test(d)&&!/(compatible|webkit)/.test(d)&&c.indexOf("1.8")==0){e+=".tree .ltr li a { display:inline; float:left; } .tree li ul { clear:both; }";}a.css=a.add_sheet({str:e});});})(jQuery);(function(a){a.extend(a.tree.datastores,{html:function(){return{get:function(d,b,c){return d&&a(d).size()?a("<div>").append(b.get_node(d).clone()).html():b.container.children("ul:eq(0)").html();
},parse:function(d,b,c,e){if(e){e.call(null,d);}return d;},load:function(d,b,c,e){if(c.url){a.ajax({type:c.method,url:c.url,data:d,dataType:"html",success:function(f,g){e.call(null,f);},error:function(g,h,f){e.call(null,false);b.error(f+" "+h);}});}else{e.call(null,c["static"]||b.container.children("ul:eq(0)").html());}}};},json:function(){return{get:function(e,m,b){var h=this;if(!e||a(e).size()==0){e=m.container.children("ul").children("li");}else{e=a(e);}if(!b){b={};}if(!b.outer_attrib){b.outer_attrib=["id","rel","class"];}if(!b.inner_attrib){b.inner_attrib=[];}if(e.size()>1){var g=[];e.each(function(){g.push(h.get(this,m,b));});return g;}if(e.size()==0){return[];}var l={attributes:{},data:{}};if(e.hasClass("open")){l.data.state="open";}if(e.hasClass("closed")){l.data.state="closed";}for(var f in b.outer_attrib){if(!b.outer_attrib.hasOwnProperty(f)){continue;}var c=(b.outer_attrib[f]=="class")?e.attr(b.outer_attrib[f]).replace(/(^| )last( |$)/ig," ").replace(/(^| )(leaf|closed|open)( |$)/ig," "):e.attr(b.outer_attrib[f]);
if(typeof c!="undefined"&&c.toString().replace(" ","").length>0){l.attributes[b.outer_attrib[f]]=c;}delete c;}if(m.settings.languages.length){for(var f in m.settings.languages){if(!m.settings.languages.hasOwnProperty(f)){continue;}var k=e.children("a."+m.settings.languages[f]);if(b.force||b.inner_attrib.length||k.children("ins").get(0).style.backgroundImage.toString().length||k.children("ins").get(0).className.length){l.data[m.settings.languages[f]]={};l.data[m.settings.languages[f]].title=m.get_text(e,m.settings.languages[f]);if(k.children("ins").get(0).style.className.length){l.data[m.settings.languages[f]].icon=k.children("ins").get(0).style.className;}if(k.children("ins").get(0).style.backgroundImage.length){l.data[m.settings.languages[f]].icon=k.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","");}if(b.inner_attrib.length){l.data[m.settings.languages[f]].attributes={};for(var d in b.inner_attrib){if(!b.inner_attrib.hasOwnProperty(d)){continue;}var c=k.attr(b.inner_attrib[d]);
if(typeof c!="undefined"&&c.toString().replace(" ","").length>0){l.data[m.settings.languages[f]].attributes[b.inner_attrib[d]]=c;}delete c;}}}else{l.data[m.settings.languages[f]]=m.get_text(e,m.settings.languages[f]);}}}else{var k=e.children("a");l.data.title=m.get_text(e);if(k.children("ins").size()&&k.children("ins").get(0).className.length){l.data.icon=k.children("ins").get(0).className;}if(k.children("ins").size()&&k.children("ins").get(0).style.backgroundImage.length){l.data.icon=k.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","");}if(b.inner_attrib.length){l.data.attributes={};for(var d in b.inner_attrib){if(!b.inner_attrib.hasOwnProperty(d)){continue;}var c=k.attr(b.inner_attrib[d]);if(typeof c!="undefined"&&c.toString().replace(" ","").length>0){l.data.attributes[b.inner_attrib[d]]=c;}delete c;}}}if(e.children("ul").size()>0){l.children=[];e.children("ul").children("li").each(function(){l.children.push(h.get(this,m,b));});}return l;},parse:function(d,l,b,h){if(Object.prototype.toString.apply(d)==="[object Array]"){var g="";
for(var e=0;e<d.length;e++){if(typeof d[e]=="function"){continue;}g+=this.parse(d[e],l,b);}if(h){h.call(null,g);}return g;}if(!d||!d.data){if(h){h.call(null,false);}return"";}var g="";g+="<li ";var k=false;if(d.attributes){for(var e in d.attributes){if(!d.attributes.hasOwnProperty(e)){continue;}if(e=="class"){g+=" class='"+d.attributes[e]+" ";if(d.state=="closed"||d.state=="open"){g+=" "+d.state+" ";}g+="' ";k=true;}else{g+=" "+e+"='"+d.attributes[e]+"' ";}}}if(!k&&(d.state=="closed"||d.state=="open")){g+=" class='"+d.state+"' ";}g+=">";if(l.settings.languages.length){for(var e=0;e<l.settings.languages.length;e++){var f={};f.href="";f.style="";f["class"]=l.settings.languages[e];if(d.data[l.settings.languages[e]]&&(typeof d.data[l.settings.languages[e]].attributes).toLowerCase()!="undefined"){for(var c in d.data[l.settings.languages[e]].attributes){if(!d.data[l.settings.languages[e]].attributes.hasOwnProperty(c)){continue;}if(c=="style"||c=="class"){f[c]+=" "+d.data[l.settings.languages[e]].attributes[c];
}else{f[c]=d.data[l.settings.languages[e]].attributes[c];}}}g+="<a";for(var c in f){if(!f.hasOwnProperty(c)){continue;}g+=" "+c+'="'+f[c]+'" ';}g+=">";if(d.data[l.settings.languages[e]]&&d.data[l.settings.languages[e]].icon){g+="<ins "+(d.data[l.settings.languages[e]].icon.indexOf("/")==-1?" class='"+d.data[l.settings.languages[e]].icon+"' ":" style='background-image:url(\""+d.data[l.settings.languages[e]].icon+"\");' ")+">&nbsp;</ins>";}else{g+="<ins>&nbsp;</ins>";}g+=((typeof d.data[l.settings.languages[e]].title).toLowerCase()!="undefined"?d.data[l.settings.languages[e]].title:d.data[l.settings.languages[e]])+"</a>";}}else{var f={};f.href="";f.style="";f["class"]="";if((typeof d.data.attributes).toLowerCase()!="undefined"){for(var e in d.data.attributes){if(!d.data.attributes.hasOwnProperty(e)){continue;}if(e=="style"||e=="class"){f[e]+=" "+d.data.attributes[e];}else{f[e]=d.data.attributes[e];}}}g+="<a";for(var e in f){if(!f.hasOwnProperty(e)){continue;}g+=" "+e+'="'+f[e]+'" ';}g+=">";
if(d.data.icon){g+="<ins "+(d.data.icon.indexOf("/")==-1?" class='"+d.data.icon+"' ":" style='background-image:url(\""+d.data.icon+"\");' ")+">&nbsp;</ins>";}else{g+="<ins>&nbsp;</ins>";}g+=((typeof d.data.title).toLowerCase()!="undefined"?d.data.title:d.data)+"</a>";}if(d.children&&d.children.length){g+="<ul>";for(var e=0;e<d.children.length;e++){g+=this.parse(d.children[e],l,b);}g+="</ul>";}g+="</li>";if(h){h.call(null,g);}return g;},load:function(d,b,c,e){if(c["static"]){e.call(null,c["static"]);}else{a.ajax({type:c.method,url:c.url,data:d,dataType:"json",success:function(f,g){e.call(null,f);},error:function(g,h,f){e.call(null,false);b.error(f+" "+h);}});}}};}});})(jQuery);