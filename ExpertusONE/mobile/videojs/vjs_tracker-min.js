function VjsTracker(m,d){$(window).on("orientationchange",function(n){setTimeout(function(){if(window.innerHeight>window.innerWidth){var o=($(window).width()/2)-10;var p=($(window).height()/2)-40;$(".vjs-big-play-button").css("left",o+"px");$(".vjs-big-play-button").css("top",p+"px");}else{var o=($(window).width()/2)-10;var p=($(window).height()/2)-40;$(".vjs-big-play-button").css("left",o+"px");$(".vjs-big-play-button").css("top",p+"px");}},100);});var b=$(window).width();var b=($(window).width()/2)-10;var e=($(window).height()/2)-40;$(".vjs-big-play-button").css("left",b+"px");$(".vjs-big-play-button").css("top",e+"px");var m=m;var j=1;var k=new VideoProgressTracker({config:d,player:m,progress:d.progress,url:d.url,frequency:d.frequency,video_duration_callback:m.duration,resume_from_last:d.resume_from_last,progress_only:d.progress_only,debug:d.debug,additional_data:d.additional_data});i();function i(){k.log("_setup");if(k.hasValidOptions()){k.log("hasValidOptions");m.on("timeupdate",a);
m.on("play",l);m.on("durationchange",c);m.on("ended",f);m.on("seeking",h);m.on("pause",_onpause);}}function a(){k.log("_updateProgress");if(j==1){var o=k.player;o.pause();o.currentTime(Math.floor((k.progressPercentage/100)*k.videoDuration()));o.play();j++;}var n=parseInt(m.currentTime());k.updateProgress(n);}function l(){k.log("_initPosition");k.initPosition();playVideo();}function c(){k.log("_initPositionAndDuration");k.initPrevPosition();}function f(n){k.log("_completeUpdate");g();var o=parseInt(k.videoDuration());k.updateProgress(o,true);}function g(){k.log("_setPrevPosition");if(k.prevPostion<=0){var n=k.videoDuration();if(n!=="undefined"){k.initPosition();}}}function h(n){k.log("_onSeek");k.updateProgress(parseInt(m.currentTime()),true,true);}}function VideoProgressTracker(b){this.progressPercentage=b.progress;this.progressUpdateUrl=b.url;this.prevPosition=0;this.frequency=(b.frequency!=="undefined"&&b.frequency>0)?b.frequency:10;this.player=b.player;this.video_duration_callback=b.video_duration_callback;
this.resume_from_last=b.resume_from_last;this.debug=(b.debug===true)?b.debug:false;this.additional_data=b.additional_data;this.total_session_duration=0;this.progress_only=(b.progress_only===true)?b.progress_only:false;this.session_id=a();this.current_progress_percent=0;this.last_updated_progress=0;function a(){function c(d){var e=(Math.random().toString(16)+"000000000").substr(2,8);return d?"-"+e.substr(0,4)+"-"+e.substr(4,4):e;}return c()+c(true)+c(true)+c();}}VideoProgressTracker.prototype.videoDuration=function(){return this.video_duration_callback.apply(this.player);};VideoProgressTracker.prototype.initPrevPosition=function(){if(this.resume_from_last===true){if(this.prevPosition===0){this.prevPosition=Math.floor((this.progressPercentage/100)*this.videoDuration());}this.player.currentTime(this.prevPosition);this.resume_from_last=false;}};VideoProgressTracker.prototype.initPosition=function(){if(this.prevPosition===0&&this.resume_from_last===true){this.prevPosition=Math.floor((this.progressPercentage/100)*this.videoDuration());
}if(this.currentPosition>=parseInt(this.videoDuration())){this.currentPosition=0;}if(this.prevPosition>=parseInt(this.videoDuration())){this.prevPosition=0;}};VideoProgressTracker.prototype.hasValidOptions=function(){return this.hasProgressUpdateUrl();};VideoProgressTracker.prototype.hasProgressUpdateUrl=function(){return this.progressUpdateUrl!=="";};VideoProgressTracker.prototype.updateProgress=function(a,e,d){console.log("updateProgress111");if(d){var c=this.currentPosition-this.prevPosition;}this.currentPosition=a;if(!d){var c=this.currentPosition-this.prevPosition;}this.frequency_counter=0;var b=parseInt(this.videoDuration());if(this.currentPosition>b){this.currentPosition=b;}this.current_progress_percent=Math.round((this.currentPosition/b)*100);this.total_session_duration=this.total_session_duration+(c>0?c:0);if(!this.progress_only||(this.progress_only&&this.last_updated_progress<this.current_progress_percent)){this.saveProgress();this.last_updated_progress=this.current_progress_percent;
}video_data.previous_position=this.prevPosition;this.prevPosition=this.currentPosition;video_data.current_position=this.currentPosition;video_data.progress=this.current_progress_percent;video_data.video_duration=parseInt(this.videoDuration());};VideoProgressTracker.prototype.saveProgress=function(){this.log("Updating progress to the server.");var a=this;var b={session_id:a.session_id,previous_position:a.prevPosition,current_position:a.currentPosition,progress:a.current_progress_percent,video_duration:parseInt(this.videoDuration())};if(!this.progress_only){b.total_session_duration=a.total_session_duration;}if(this.additional_data){b.additional_data=this.additional_data;}this.log("progress info - "+console.log(JSON.parse(JSON.stringify(b))));$.ajax({url:this.progressUpdateUrl,method:"POST",data:b,statusCode:{404:function(){a.log("URL not found.");},500:function(){a.log("Error on the server.");}}}).done(function(c){a.log("Server update complete.");if(typeof server_update_callback!=="undefined"){this.server_update_callback.apply(c);
}});};VideoProgressTracker.prototype.log=function(a){if(this.debug===true&&!(typeof window.console==="undefined")){console.log(a);}};