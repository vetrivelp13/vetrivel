var uc_discountsisUpdating=false;function uc_discountsOnLoad(a){context=$("body");$discountFrom=$("input[name=checkout_from_admin]:hidden").val();if($("textarea[id*=uc-discounts-codes]",context).val()&&$discountFrom!="admin_order"){uc_discountsProcessCodes(context,a);}Drupal.behaviors.orderAdminApplyDiscountButton={attach:function(b,c){$("input[id*=uc-discounts-button]:not(.uc_discountsOnLoad-processed)").addClass("uc_discountsOnLoad-processed").each(function(){$(this).click(function(d){uc_discountsProcessCodes($("body"),d);return false;});});}};$("input[id*=uc-discounts-button]:not(.uc_discountsOnLoad-processed)",context).addClass("uc_discountsOnLoad-processed").click(function(b){uc_discountsProcessCodes(context,b);return false;});}function uc_discountsProcessCodes(d,f){textareaVal=$.trim($("textarea[id*=uc-discounts-codes]",d).val());if(textareaVal==null||textareaVal==""){$("#message-container").html("");var c=new Array();c[0]=Drupal.t("LBL752")+" "+Drupal.t("MSG697")+".";var b=expertus_error_message(c,"error");
$("#show_expertus_message").show();$("#show_expertus_message").html(b);return false;}if(uc_discountsisUpdating){setTimeout(function(){uc_discountsProcessCodes(d);},200);return;}var a={};a["uc-discounts-codes"]=$("textarea[id*=uc-discounts-codes]",d).val();var g="?q=cart/checkout/uc_discounts/calculate";if($("input[name=checkout_from_admin]:hidden").val()=="admin_order"){g="?q=administration/create/uc_discounts/calculate";a["uc-discounts-codes"]=(a["uc-discounts-codes"]==Drupal.t("MSG592"))?"":a["uc-discounts-codes"];}abstractDetailWidget=EXPERTUS_SMARTPORTAL_AbstractDetailsWidget;abstractDetailWidget.createLoader("clone_cart-pane");$.ajax({type:"POST",url:Drupal.settings.basePath+g,data:a,complete:function(m,n){abstractDetailWidget.destroyLoader("clone_cart-pane");if(parseInt(m.status)!=0&&parseInt(m.status/100)!=2){alert(Drupal.settings.uc_discounts.err_msg);return;}var l=m.responseText;var j=null;try{l=m.responseText;j=$.parseJSON(l);}catch(k){alert(Drupal.settings.uc_discounts.response_parse_err_msg+l);
return;}try{uc_discountsProcessCalculateDiscountResponse(j,d);if(f.type=="click"){$("input[id*=quote-button]").click();}}catch(k){var h=new Array();h[0]=Drupal.settings.uc_discounts.err_msg;var e=expertus_error_message(h,"error");$("#show_expertus_message").show();$("#show_expertus_message").html(e);window.scrollTo(0,0);return;}}});}function uc_discountsProcessCalculateDiscountResponse(b,a){if(uc_discountsisUpdating){return;}uc_discountsisUpdating=true;try{var g;if(b==null){alert(Drupal.settings.uc_discounts.err_msg);return;}var j=null;var l=null;var f=null;var e=null;var h=null;try{j=b[Drupal.settings.uc_discounts.calculate_discount_response_line_items_key];l=b[Drupal.settings.uc_discounts.calculate_discount_response_errors_key];f=b[Drupal.settings.uc_discounts.calculate_discount_response_messages_key];e=b.total_discount_theme;h=b.total_theme;}catch(d){}var n=$("textarea[id*=uc-discounts-codes]",a).val();n=$.trim(n);if(n.length==0){l.push(t("MSG697"));}if((l!=null)&&(l.length>0)){$("#show_expertus_message").empty();
var c=expertus_error_message(l,"error");var k=$("#message-container").html();if(k!=null&&k!=""&&k!="null"){$("#message-container .error").append(c);}else{$("#show_expertus_message").html(c);}$("#show_expertus_message").show();window.scrollTo(0,0);}if((f!=null)&&(f.length>0)){var m=$("<ul></ul>");for(var g=0;g<f.length;g++){m.append($("<li></li>").append(f[g]));}discounts_messages_container.append($("<div class='uc-discounts-messages messages'> </div>").append(m));}if((h!=null)&&(e!=null)){$("#exp-clone-cart-discount").html(e);$("#exp-clone-cart-total").html(h);}uc_discountsisUpdating=false;}catch(d){uc_discountsisUpdating=false;throw d;}}function uc_discountsRenderLineItems(b,d){if((window.set_line_item==null)||(b==null)){return;}remove_line_item(Drupal.settings.uc_discounts.line_item_key_name);var c=0;for(i=0;i<b.length;i++){var a=b[i];c+=parseFloat(a.amount);}if(b.length>0){set_line_item(Drupal.settings.uc_discounts.line_item_key_name,Drupal.settings.uc_discounts.total_discount_text,c,parseFloat(Drupal.settings.uc_discounts.line_item_weight)+0.5,1,false);
}if(window.render_line_items){render_line_items();}if(window.getTax){getTax();}}