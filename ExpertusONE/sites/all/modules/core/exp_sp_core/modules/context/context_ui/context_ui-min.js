(function(a){function b(c){this.form=c;this.setState=function(){var d=[];a(".context-plugin-list > li",this.form).each(function(){var e=a(this).attr("class").split("context-plugin-")[1].split(" ")[0];if(a(this).is(".disabled")){a(".context-plugin-selector select option[value="+e+"]",this.form).show();}else{d.push(e);a(".context-plugin-selector select option[value="+e+"]",this.form).hide();}});a(".context-plugin-selector input.context-plugins-state",this.form).val(d.join(","));a(".context-plugin-selector select",this.form).val(0);return this;};this.addPlugin=function(d){a(".context-plugin-list > li.context-plugin-"+d,this.form).removeClass("disabled");this.showForm(d).setState();return this;};this.removePlugin=function(d){a(".context-plugin-list > li.context-plugin-"+d,this.form).addClass("disabled");this.hideForm(d).setState();return this;};this.showForm=function(d){a(".context-plugin-forms > .context-plugin-form.active-form",this.form).removeClass("active-form");a(".context-plugin-forms > .context-plugin-form-"+d,this.form).addClass("active-form");
a(".context-plugin-list > li > a").removeClass("active-form");a(".context-plugin-list > li.context-plugin-"+d+" > a").addClass("active-form");return this;};this.hideForm=function(d){a(".context-plugin-forms > .context-plugin-form-"+d,this.form).removeClass("active-form");a(".context-plugin-list > li.context-plugin-"+d+" > a").removeClass("active-form");return this;};a(".context-plugin-selector select",this.form).change(function(){var d=a(this).parents("div.context-plugins").data("contextPlugins");if(d){var e=a(this).val();d.addPlugin(e);}});a(".context-plugin-list > li > a",this.form).click(function(){var d=a(this).parents("div.context-plugins").data("contextPlugins");if(d){var e=a(this).attr("href").split("#context-plugin-form-")[1];d.showForm(e);}return false;});a(".context-plugin-list span.remove",this.form).click(function(){var d=a(this).parents("div.context-plugins").data("contextPlugins");if(d){var e=a(this).parent().attr("href").split("#context-plugin-form-")[1];d.removePlugin(e);
}return false;});this.setState();}Drupal.behaviors.context_ui={attach:function(c){a("form div.context-plugins:not(.context-ui-processed)").each(function(){a(this).addClass("context-ui-processed");a(this).data("contextPlugins",new b(a(this)));});if(jQuery().pageEditor){a("form.context-editor:not(.context-ui-processed)").addClass("context-ui-processed").pageEditor().each(function(){var e=a(this);var d=a("li.context-editable",this).attr("id").split("context-editable-trigger-")[1];a(this).data("defaultContext",d);a("li.context-editable a.edit",e).click(function(){var f=a(this).parents("li.context-editable").addClass("context-editing");var g=f.attr("id").split("context-editable-trigger-")[1];e.pageEditor("start",g);return false;});a("li.context-editable a.done",e).click(function(){e.pageEditor("end");return false;});a(e).submit(function(){if(e.pageEditor("isEditing")){e.pageEditor("end");}});e.bind("start.pageEditor",function(g,f){if(!f){f=a(this).data("defaultContext");a("li#context-editable-trigger-"+f,this).addClass("context-editing");
}a(document.body).addClass("context-editing");a("#context-editable-"+f,this).show();});e.bind("end.pageEditor",function(g,f){a(document.body).removeClass("context-editing");a("div.contexts div.context-editable",this).hide();a("li.context-editable").removeClass("context-editing");a("form.context-editor").addClass("edited");});});}}};})(jQuery);