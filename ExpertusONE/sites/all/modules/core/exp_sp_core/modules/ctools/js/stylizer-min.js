(function(a){Drupal.CTools=Drupal.CTools||{};Drupal.CTools.Stylizer={};Drupal.CTools.Stylizer.addFarbtastic=function(d){if(a("ctools_stylizer_color_scheme_form .color-form.Stylizer-processed").size()){return;}var c=a(".color-form",d);var f=[];var l=[];var m=[];var h=null;a(c).prepend('<div id="placeholder"></div>').addClass("color-processed");var g=a.farbtastic("#placeholder");a("#edit-scheme",c).change(function(){var o=this.options[this.selectedIndex].value;if(o!=""){o=o.split(",");for(i in o){k(f[i],o[i],false,true);}}});function b(r,p,o){r=g.RGBToHSL(g.unpack(r));r[0]+=o[0]-p[0];if(p[1]==0||o[1]==0){r[1]=o[1];}else{var q=p[1]/o[1];if(q>1){r[1]/=q;}else{r[1]=1-(1-r[1])*q;}}if(p[2]==0||o[2]==0){r[2]=o[2];}else{var q=p[2]/o[2];if(q>1){r[2]/=q;}else{r[2]=1-(1-r[2])*q;}}return g.pack(g.HSLToRGB(r));}function k(s,r,p,q){a(s).css({backgroundColor:r,color:g.RGBToHSL(g.unpack(r))[2]>0.5?"#000":"#fff"});if(s.value&&s.value!=r){s.value=r;if(p){var t=s.i;for(j=t+1;;++j){if(!m[j-1]||a(m[j-1]).is(".unlocked")){break;
}var o=b(r,reference[s.key],reference[f[j].key]);k(f[j],o,false);}for(j=t-1;;--j){if(!m[j]||a(m[j]).is(".unlocked")){break;}var o=b(r,reference[s.key],reference[f[j].key]);k(f[j],o,false);}}if(!q){e();}}}function e(){a("#edit-scheme",c).each(function(){this.selectedIndex=this.options.length-1;});}function n(){var o=this;h&&a(h).unbind("keyup",g.updateValue).unbind("keyup",e).parent().removeClass("item-selected");h=this;g.linkTo(function(p){k(o,p,true,false);});g.setColor(this.value);a(h).keyup(g.updateValue).keyup(e).parent().addClass("item-selected");}a("#palette input.form-text",c).each(function(){this.key=this.id.substring(13);g.linkTo(function(){}).setColor("#000").linkTo(this);var p=f.length;if(f.length){var o=a('<div class="lock"></div>').toggle(function(){a(this).addClass("unlocked");a(l[p-1]).attr("class",m[p-2]&&a(m[p-2]).is(":not(.unlocked)")?"hook up":"hook");a(l[p]).attr("class",m[p]&&a(m[p]).is(":not(.unlocked)")?"hook down":"hook");},function(){a(this).removeClass("unlocked");
a(l[p-1]).attr("class",m[p-2]&&a(m[p-2]).is(":not(.unlocked)")?"hook both":"hook down");a(l[p]).attr("class",m[p]&&a(m[p]).is(":not(.unlocked)")?"hook both":"hook up");});a(this).after(o);m.push(o);}var q=a('<div class="hook"></div>');a(this).after(q);l.push(q);a(this).parent().find(".lock").click();this.i=p;f.push(this);}).focus(n);a("#palette label",c);n.call(f[0]);};Drupal.behaviors.CToolsColorSettings={attach:function(){a(".ctools-stylizer-color-edit:not(.ctools-color-processed)").addClass("ctools-color-processed").each(function(){Drupal.CTools.Stylizer.addFarbtastic("#"+a(this).attr("id"));});a("div.form-item div.ctools-style-icon:not(.ctools-color-processed)").addClass("ctools-color-processed").click(function(){$widget=a("input",a(this).parent());$widget.attr("checked",!$widget.attr("checked")||$widget.is("input[type=radio]"));});}};})(jQuery);