<?php

/**
 * @file
 *  h5peditor.module php file
 *  Drupal module h5peditor. A HTML5 Package editor for Drupal.
 */
/**
 * Implements hook_menu().
 */
function h5peditor_menu() {
  $items = array();

  $items['h5peditor/%/%/libraries'] = array(
    'title' => 'H5peditor Libraries',
    'page callback' => 'h5peditor_libraries_callback',
    'access callback' => 'h5peditor_access',
    'access arguments' => array(2),
    'type' => MENU_CALLBACK,
  );
  $items['h5peditor/%/%/libraries/%/%/%'] = array(
    'title' => 'H5peditor Library',
    'page callback' => 'h5peditor_library_callback',
    'page arguments' => array(4, 5, 6),
    'access callback' => 'h5peditor_access',
    'access arguments' => array(2),
    'type' => MENU_CALLBACK,
  );
  $items['h5peditor/%/%/files'] = array(
    'title' => 'H5peditor Files',
    'page callback' => 'h5peditor_files_callback',
    'page arguments' => array(1),
    'access callback' => 'h5peditor_access',
    'access arguments' => array(2),
    'type' => MENU_CALLBACK,
  );

  return $items;
}

/**
 * Access callback.
 *
 * @param int $node_id
 * @return bool
 */
function h5peditor_access($node_id) {
   //Since h5peditor encapsulated with e1 permissions following code commened.
   return TRUE;
  /*if ($node_id === '0') {
    return node_access('create', 'h5p_content');
  }

  $node = node_load($node_id);
  return node_access('update', $node);*/
}

/**
 * Implements hook_form_FORM_ID_alter().
 */
function h5peditor_form_h5p_content_node_form_alter(&$form, &$form_state) {
  $node = h5peditor_get_source_node($form['#node']);
  $library = isset($node->main_library) ? H5PCore::libraryToString($node->main_library) : (isset($node->h5p_library) ? $node->h5p_library : 0);

  if (variable_get('h5p_first_runnable_saved', 0) === 0) {
    drupal_set_message(t("If you don't have any H5P content types installed you may <a href=\"http://h5p.org/update-all-content-types\" target=\"_blank\">download them all at once</a> from H5P.org and upload them all at once on the <a href=\"!library_admin_url\" target=\"_blank\">library admin page</a>. Refresh this page when you've installed the libraries.", array('!library_admin_url' => url('admin/content/h5p'))));
  }

  $form['h5p_type'] = array(
    '#type' => 'radios',
    '#title' => t('HTML5 Content'),
    '#prefix'=>'<div style="display:none">', '#suffix'=>'</div>',
    '#options' => array(
      'upload' => t('Upload'),
      'create' => isset($node->nid) ? t('Edit') : t('Create'),
    ),
    '#default_value' => $library ? 'create' : (variable_get('h5p_first_runnable_saved', 0) ? 'create' : 'upload'),
    '#weight' => $form['h5p']['#weight'] - 1,
  );

  $form['content_master_id'] = array(
    '#type' => 'hidden',
    '#default_value' =>"0",
  );

  $form['h5p_editor'] = array(
    '#type' => 'item',
    '#title' => t('Content type'),
    '#markup' => '<div class="h5p-editor">' . t('Waiting for javascript...') . '</div>',
    '#weight' => $form['h5p']['#weight'],
  );
  $form['#after_build'][] = 'h5peditor_h5p_content_node_form_after_build';

  $form['h5p_library'] = array(
    '#type' => 'hidden',
    '#default_value' => $library,
  );

  $form["#theme"]='templates/h5p_content--edit';

  $form['#submit'][] = 'h5peditor_h5p_content_node_form_submit';
  for ($i = 0, $s = count($form['#validate']); $i < $s; $i++) {
    if ($form['#validate'][$i] == 'h5p_form_validate') {
      $form['#validate'][$i] = 'h5peditor_h5p_content_node_form_validate';
    }
  }
}

/**
 * Add scripts and styles to the h5p node form.
 */
function h5peditor_h5p_content_node_form_after_build($form) {
	
  global $language;
  static $done;
  if ($done === TRUE) {
    // Make sure we only add the js once.
    return $form;
  }
  $done = TRUE;

  $node = h5peditor_get_source_node($form['#node']);
  $assets = h5p_add_core_assets();
  h5p_add_files_and_settings(TRUE, TRUE); // Force integration

  $h5peditor_module_path = drupal_get_path('module', 'h5peditor');
  $cache_buster = '?' . variable_get('css_js_query_string', '');

  // Add our own styles
  foreach (H5peditor::$styles as $style) {
    $assets['css'][] = base_path() . $h5peditor_module_path . '/h5peditor/' . $style . $cache_buster;
  }

  // Add our own scripts
  foreach (H5peditor::$scripts as $script) {
    // We do not want the creator of the iframe inside the iframe
    if ($script !== 'scripts/h5peditor-editor.js') {
      $assets['js'][] = base_path() . $h5peditor_module_path . '/h5peditor/' . $script . $cache_buster;
      
    }
  }
  drupal_add_js($h5peditor_module_path . '/h5peditor/scripts/h5peditor-editor.js');
  drupal_add_js($h5peditor_module_path . '/scripts/application.js');

  // Add translation
  $language_file = $h5peditor_module_path . '/h5peditor/language/' . $language->language . '.js';
  if (!file_exists($language_file)) {
    $language_file = $h5peditor_module_path . '/h5peditor/language/en.js';
  }
  drupal_add_js($language_file);

  // TODO: If we're going to preprocess the assets one day, remember to skip ckeditor.

  $content_validator = _h5p_get_instance('contentvalidator');
  $file_path = file_stream_wrapper_get_instance_by_uri('public://')->getDirectoryPath();
  $settings = array(
    'h5peditor' => array(
      'filesPath' => base_path() . $file_path . '/h5peditor',
      'fileIcon' => array(
        'path' => base_path() . $h5peditor_module_path . '/h5peditor/images/binary-file.png',
        'width' => 50,
        'height' => 50,
      ),
      'ajaxPath' => url('h5peditor/' . H5PCore::createToken('editorajax') . '/' . (isset($node->nid) ? $node->nid : 0) . '/'),
      'modulePath' => $h5peditor_module_path,
      'libraryPath' => _h5p_get_h5p_path() . '/libraries/',
      'copyrightSemantics' => $content_validator->getCopyrightSemantics(),
      'assets' => $assets,
      'contentRelUrl' => '../contentupload/',
      'editorRelUrl' => '../../../h5peditor',
    ),
  );

  if (isset($node->json_content)) {
    $settings['h5peditor']['nodeVersionId'] = h5p_get_content_id($node);
  }

  drupal_add_js($settings, array('type' => 'setting', 'scope' => JS_DEFAULT));

  return $form;
}

/**
 * @todo Please document this function.
 * @see http://drupal.org/node/1354
 */
function h5peditor_h5p_content_node_form_validate($form, $form_state) {
	
	//drupal_prepare_form("h5p_content_node_form",$form,$form_state);
	expDebug::dPrint("h5peditor_h5p_content_node_form_validate:1");
	
  if ($form_state['values']['h5p_type'] == 'upload') {
    h5p_form_validate($form, $form_state);
    return;
  }
  else {
  		$secret = session_id();
  		$form_state["values"]["form_token"] = drupal_hmac_base64("h5p_content_node_form", $secret.drupal_get_private_key().drupal_get_hash_salt());
  		expDebug::dPrint("h5peditor_h5p_content_node_form_validate:222");
	
    $library_data = H5PCore::libraryFromString($form_state['values']['h5p_library']);
		expDebug::dPrint("h5peditor_h5p_content_node_form_validate:3");
	
    if ($library_data === FALSE) {
    		expDebug::dPrint("h5peditor_h5p_content_node_form_validate:4");
		
      form_set_error('h5p_editor', t('You must choose an H5P content type or upload an H5P file.'));
    }
    else {
    		expDebug::dPrint("h5peditor_h5p_content_node_form_validate:5");
		
      $is_runnable = db_query(
        "SELECT runnable
        FROM {h5p_libraries}
        WHERE machine_name = :machine_name
        AND major_version = :major_version
        AND minor_version = :minor_version", array(
          ':machine_name' => $library_data['machineName'],
          ':major_version' => $library_data['majorVersion'],
          ':minor_version' => $library_data['minorVersion'],
        ))->fetchField();
      if (!$is_runnable) {
        form_set_error('h5p_editor', t('Invalid H5P content type'));
      }
    }
  }
}

/**
 * Node form submit handler.
 */
function h5peditor_h5p_content_node_form_submit($form, &$form_state) {
	//echo "suresh:";
	//var_dump($form);
	//echo drupal_json_encode($form_state);
	//exit();
	expDebug::dPrint("h5peditor_h5p_content_node_form_submit:1");
  if ($form_state['values']['h5p_type'] == 'upload') {
    return;
  }
expDebug::dPrint("h5peditor_h5p_content_node_form_submit:2");
  if (isset($form['#node']->main_library)) {
  	expDebug::dPrint("h5peditor_h5p_content_node_form_submit:3");
    $form_state['values']['h5p_library_old'] = $form['#node']->main_library;
    $form_state['values']['h5p_params_old'] = $form['#node']->json_content;
    expDebug::dPrint("h5peditor_h5p_content_node_form_submit:4");
  }
	expDebug::dPrint("content_master:". $form_state['values']['content_master_id']);
  $form_state['values']['main_library_id'] = h5peditor_get_library_property($form_state['values']['h5p_library'], 'libraryId');
  $node = h5peditor_get_source_node($form['#node']);
  $node->content_master_id =  $form_state['values']['content_master_id'];
  $form['#node'] = $node;
  
  
  $form_state['redirect'] = false;
  $form['redirect'] = false;
}

/**
 * Implements hook_node_insert().
 */
function h5peditor_node_insert($node) {
 _h5peditor_create_content($node);
}

/**
 * Implements hook_node_update().
 */
function h5peditor_node_update($node) {
  _h5peditor_create_content($node);
}

/**
 * Create or update H5P content.
 */
function _h5peditor_create_content($node) {
  if (!isset($node->h5p_type) || $node->h5p_type == 'upload') {
    return;
  }
  $editor = h5peditor_get_instance();
  $content_id = h5p_get_content_id($node);

  if (!$editor->createDirectories($content_id)) {
    drupal_set_message('Unable to create content directory.', 'error');
    return;
  }

  if (isset($node->translation_source) || isset($node->clone_from_original_nid)) {
    $storage = _h5p_get_instance('storage');
    $source_node = h5peditor_get_source_node($node);
    $storage->copyPackage(h5p_get_content_id($node), h5p_get_content_id($source_node), $node->nid);
  }

  // Move files.
  $editor->processParameters(h5p_get_content_id($node), h5peditor_get_library_property($node->h5p_library), json_decode($node->json_content), isset($node->h5p_library_old) ? $node->h5p_library_old : NULL, isset($node->h5p_params_old) ? json_decode($node->h5p_params_old) : NULL);
}

/**
 * Callback that lists all h5p libraries.
 */
function h5peditor_libraries_callback() {
  $editor = h5peditor_get_instance();
  drupal_add_http_header('Cache-Control', 'no-cache');
  drupal_add_http_header('Content-type', 'application/json');
  print $editor->getLibraries();
}

/**
 * Callback that returns all library data
 *
 * @param string $library
 */
function h5peditor_library_callback($machine_name, $major_version, $minor_version) {
  global $language;
  $editor = h5peditor_get_instance();

  // TODO: Make Drupal cache result?
  // TODO: Consider if we should leverage browser caching by just using .js files instead of eval, or a combination.

  drupal_add_http_header('Cache-Control', 'no-cache');
  drupal_add_http_header('Content-type', 'application/json');
  print $editor->getLibraryData($machine_name, $major_version, $minor_version, $language->language, '', _h5p_get_h5p_path());

  // Log library loaded
  new H5PEvent('library', NULL, NULL, NULL,
    $machine_name,
    $major_version . '.' . $minor_version
  );
}

/**
 * Callback for file uploads.
 */
function h5peditor_files_callback($token) {
	//Comment by suresh
//  if (!H5PCore::validToken('editorajax', $token)) {
 //   return H5PCore::ajaxError(t('Invalid security token. Please reload the editor.'));
 // }
   $typ = $_POST['pre'];
   expDebug::dPrint('debug abhi test 1111111= ' . $typ );
   
  
  /*  if($typ == 'pre'){
   	$content_id1 = $_POST['contentId'];
   	expDebug::dPrint("abhiii23433333344444333wwwww...." .$content_id1);
   	$_POST['contentId'] = core_decrypt($_POST['contentId']);
   	expDebug::dPrint("abhiii23433333344444333...." .$content_id);
   } */
   
  /*  if($typ == 'pre'){
   	$_POST['contentId'] = core_decrypt($_POST['contentId']);
   	expDebug::dPrint("abhiii23433333344444333...." .$_POST['contentId']);
   	}  */
   	 
   
	expDebug::dPrint('debug abhi test 123 = ' . $token . '---->' . print_r($token, true), 4);
	// we need to know if its presentation, then only decrypt. Shall we hit the DB for this?
	/* if ($_REQUEST["q"] == "administration/contentauthor/presentation/")
		expDebug::dPrint("abhiii23433333344444333...."); */

	
	 $files_directory = file_stream_wrapper_get_instance_by_uri('public://')->getDirectoryPath();
  expDebug::dPrint("abhiii234...." .$files_directory);
  
  
  
 /*  else  
  	$content_id = $_POST['contentId']; */
  
  
 /*  if (isset($content_id) && $content_id) {
  	expDebug::dPrint("abhiii2341111111111...." .$content_id);
    //h5pcustomization - restructure
  //  $files_directory .= '/' . variable_get('h5p_default_path', 'h5p') . '/content/' . $_POST['contentId'];
  	$files_directory .= '/' . variable_get('h5p_default_path', 'h5p') . '/' . $content_id;
  }
  else {
    $files_directory .= '/h5peditor';
  } */
 
  
  
  
 /*  $files_directory = file_stream_wrapper_get_instance_by_uri('public://')->getDirectoryPath(); */
  if (isset($_POST['contentId']) && $_POST['contentId']) {
  	//h5pcustomization - restructure
  	//  $files_directory .= '/' . variable_get('h5p_default_path', 'h5p') . '/content/' . $_POST['contentId'];
  	$files_directory .= '/' . variable_get('h5p_default_path', 'h5p') . '/' . $_POST['contentId'];
  }
  else {
  	$files_directory .= '/h5peditor';
  }
   
  
  

  $file = new H5peditorFile(_h5p_get_instance('interface'), $files_directory);

  if (!$file->isLoaded()) {
    drupal_not_found();
    return;
  }

  if ($file->validate() && $file->copy()) {
    $editor = h5peditor_get_instance();

/* #85246 - content files getting deleted automatically. Because it is added as tmp file.Commented out below lines.

    // Keep track of temporary files so they can be cleaned up later.
    $editor->addTmpFile($file); */
  }

  header('Content-type: text/html; charset=utf-8');
  print $file->getResult();
}

/**
 * Keeps track of our editor instance, saving valuable resources.
 *
 * @staticvar H5peditor $instance
 * @return \H5peditor
 */
function h5peditor_get_instance() {
  expDebug::dPrint("W1....");
  static $instance;

  if (!$instance) {
    if (variable_get('h5p_library_development', 0) === 1) {
      $development = _h5p_get_instance('development');
    }
  expDebug::dPrint("W1...1.");
    $instance = new H5peditor(
      _h5p_get_instance('core'),
      new H5peditorDrupalStorage(),
      base_path(),
      _h5p_get_h5p_path(),
      file_stream_wrapper_get_instance_by_uri('public://')->getDirectoryPath() . DIRECTORY_SEPARATOR . 'h5peditor',
      '/^(\.\.\/){1,3}(\d+|h5peditor)\/(.+)$/'
    );
    expDebug::dPrint("W1...2.");
  }

  return $instance;
}

/**
 * TODO: Rather use core functions than this?
 */
function h5peditor_get_library_property($library, $property = 'all') {
  $matches = array();
  preg_match_all('/(.+)\s(\d+)\.(\d+)$/', $library, $matches);
  if (count($matches) == 4) {
    $library_data = array(
      'machineName' => $matches[1][0],
      'majorVersion' => $matches[2][0],
      'minorVersion' => $matches[3][0],
    );
    switch ($property) {
      case 'all':
        return $library_data;
      case 'libraryId':
        $temp = db_query(
          "SELECT library_id
          FROM {h5p_libraries}
          WHERE machine_name = :name
          AND major_version = :major_version
          AND minor_version = :minor_version",
          array(':name' => $library_data['machineName'], ':major_version' => $library_data['majorVersion'], ':minor_version' => $library_data['minorVersion']))->fetchField();
        return $temp;
      default:
        return $library_data[$property];
    }
  }
  else {
    return FALSE;
  }
}

/**
 * If a node is translated or copied this function finds the source
 *
 * @param stdClass $node
 *  The node object we're working with
 * @return stdClass $node
 *  The node itself, or its copy or translation source
 */
function h5peditor_get_source_node($node) {
  $node = isset($node->translation_source) ? $node->translation_source : $node;
  if (isset($node->clone_from_original_nid)) {
    $node = node_load($node->clone_from_original_nid);
  }
  return $node;
}

/**
 * Implements hook_field_extra_fields().
 */
function h5peditor_field_extra_fields() {
  $extra['node']['h5p_content'] = array(
    'form' => array(
      'h5p_type' => array(
        'label' => t('H5P Action'),
        'description' => t('Choose whether to upload or create/edit content.'),
        'weight' => 1,
      ),
      'h5p_editor' => array(
        'label' => t('H5P Editor'),
        'description' => t('Create or edit interactive content.'),
        'weight' => 2,
      )
    )
  );

  return $extra;
}


/**
 * Implements hook_theme_registry_alter().
 */

function h5peditor_theme_registry_alter(&$theme_registry) {
	// Defined path to the current module.
	$module_path = drupal_get_path('module', 'h5peditor');
	// Find all .tpl.php files in this module's folder recursively.
	$template_file_objects = drupal_find_theme_templates($theme_registry, '.tpl.php', $module_path);
	// Iterate through all found template file objects.
	foreach ($template_file_objects as $key => $template_file_object) {
		// If the template has not already been overridden by a theme.
		if (!isset($theme_registry[$key]['theme path']) || !preg_match('#/themes/#', $theme_registry[$key]['theme path'])) {
			// Alter the theme path and template elements.
			$theme_registry[$key]['theme path'] = $module_path;
			$theme_registry[$key] = array_merge($theme_registry[$key], $template_file_object);
			$theme_registry[$key]['type'] = 'module';
		}
	}
}
 


function h5peditor_theme($existing, $type, $theme, $path) {

  return array(
    'h5p_content_node_form' => array(
      'render element' => 'form',
      'template' => 'node--h5p_content',
      // this will set to module/theme path by default:
      'path' => drupal_get_path('module', 'h5peditor'),
    ),
  );
}
/*
function h5peditor_h5p_styles_alter(&$styles, $libraries, $mode) {
 // if (isset($libraries['H5P.MultiChoice']) && $libraries['H5P.MultiChoice']['majorVersion'] == '1') 
 {
 	    $styles[] = (object) array(
      // Path relative to drupal root
      'path' => '/sites/all/modules/core/exp_sp_core/modules/exp_sp_administration/exp_sp_administration_contentauthor/exp_sp_administration_contentauthor.css',
      // Cache buster
      'version' => '?ver=1',
    );
  }
}*/

function h5peditor_h5p_semantics_alter(&$semantics, $machine_name, $major_version, $minor_version) {
	
	expDebug::dPrint("Semantics:".$machine_name);
	expDebug::dPrint("Semantics:".json_encode($semantics));
 
   if($machine_name == "H5P.CoursePresentation")
   {
   	$semantics = json_decode('[{"name":"presentation","type":"group","widget":"coursepresentation","fields":[{"name":"slides","type":"list","field":{"name":"slide","type":"group","fields":[{"name":"elements","type":"list","field":{"name":"element","type":"group","fields":[{"name":"x","type":"number","widget":"none"},{"name":"y","type":"number","widget":"none"},{"name":"width","type":"number","widget":"none","optional":true},{"name":"height","type":"number","widget":"none","optional":true},{"name":"action","type":"library","options":["H5P.AdvancedText 1.1","H5P.Link 1.1","H5P.Image 1.0","H5P.Video 1.2","H5P.Audio 1.2","H5P.Blanks 1.4","H5P.SingleChoiceSet 1.3","H5P.DragText 1.4","H5P.MarkTheWords 1.5"],"optional":true},{"name":"solution","type":"text","widget":"text","optional":true,"label":"Comments","description":"The comments are shown when the user displays the suggested answers for all slides.","enterMode":"p","tags":["strong","em","del","a","ul","ol","h2","h3","hr"]},{"name":"alwaysDisplayComments","type":"boolean","label":"Always display comments","optional":true},{"name":"backgroundOpacity","type":"number","label":"Background Opacity","min":0,"max":100,"step":5,"default":0,"optional":true},{"name":"displayAsButton","type":"boolean","label":"Display as button","default":false,"optional":true},{"name":"title","type":"text","optional":true,"label":"Title"},{"name":"goToSlide","type":"number","label":"Go To Slide","min":1,"optional":true},{"name":"invisible","type":"boolean","label":"Invisible","description":"Default cursor, no title and no tab index. Warning: Users with disabilities or keyboard only users will have trouble using this element.","default":false},{"name":"metadata","type":"group","label":"Metadata","optional":true,"deprecated":true,"fields":[{"name":"title","type":"text","optional":true,"label":"Title"},{"name":"author","type":"text","optional":true,"label":"Author"},{"name":"lisence","type":"text","optional":true,"label":"License"}]}]}},{"name":"keywords","type":"list","optional":true,"field":{"name":"keyword","type":"group","optional":true,"fields":[{"name":"main","type":"text","optional":true},{"name":"subs","type":"list","optional":true,"field":{"name":"keyword","type":"text"}}]}},{"name":"slideBackgroundSelector","type":"group","widget":"radioSelector","fields":[{"name":"imageSlideBackground","type":"image","label":"Image","optional":true,"description":"Image background should have a 2:1 width to height ratio to avoid stretching. High resolution images will display better on larger screens."},{"name":"fillSlideBackground","type":"text","widget":"colorSelector","label":"Pick a color","spectrum":{"flat":true,"showInput":true,"allowEmpty":true,"showButtons":false},"default":null,"optional":true}]}]}},{"name":"ct","type":"text","widget":"none","optional":true,"tags":["strong","em","del","br","p","a","h2","h3"]},{"name":"keywordListEnabled","type":"boolean","label":"Keyword list","default":true},{"name":"keywordListAlwaysShow","type":"boolean","label":"Always show","default":false},{"name":"keywordListAutoHide","type":"boolean","label":"Auto hide","default":false},{"name":"keywordListOpacity","type":"number","label":"Opacity","min":0,"max":100,"default":90},{"name":"globalBackgroundSelector","type":"group","widget":"radioSelector","fields":[{"name":"imageGlobalBackground","type":"image","label":"Image","optional":true,"description":"Image background should have a 2:1 width to height ratio to avoid stretching. High resolution images will display better on larger screens."},{"name":"fillGlobalBackground","type":"text","widget":"colorSelector","label":"Pick a color","spectrum":{"flat":true,"showInput":true,"allowEmpty":true,"showButtons":false},"default":null,"optional":true}]}]},{"name":"l10n","type":"group","label":"Localize","common":true,"fields":[{"name":"slide","type":"text","label":"Translation for \"Slide\"","default":"Slide"},{"name":"yourScore","type":"text","label":"Translation for \"Your Score\"","default":"Your Score"},{"name":"maxScore","type":"text","label":"Translation for \"Max Score\"","default":"Max Score"},{"name":"goodScore","type":"text","label":"Greeting given for GOOD score","default":"Congratulations! You got @percent correct!","description":"@percent is replaced by the real user score in percent"},{"name":"okScore","type":"text","label":"Greeting given for OK score","default":"Nice effort! You got @percent correct!","description":"@percent is replaced by the real user score in percent"},{"name":"badScore","type":"text","label":"Greeting given for BAD score","default":"You got @percent correct.","description":"@percent is replaced by the real user score in percent"},{"name":"Total","type":"text","label":"Translation for \"Total\"","default":"Total"},{"name":"showSolutions","type":"text","label":"Title for show solutions button","default":"Show solutions"},{"name":"retry","type":"text","label":"Text for the retry button","default":"Retry","optional":true},{"name":"title","type":"text","label":"Translation for \"Title\"","default":"Title"},{"name":"author","type":"text","label":"Translation for \"Author\/supplier\"","default":"Author"},{"name":"lisence","type":"text","label":"Translation for \"License\"","default":"License","deprecated":true,"optional":true},{"name":"license","type":"text","label":"Translation for \"License\"","default":"License"},{"name":"exportAnswers","type":"text","label":"Text for the export text button","default":"Export text"},{"name":"copyright","type":"text","label":"Text for the \"Rights of use\" button","default":"Rights of use"},{"name":"hideKeywords","type":"text","label":"Hide keywords list button title","default":"Hide keywords list"},{"name":"showKeywords","type":"text","label":"Show keywords list button title","default":"Show keywords list"},{"name":"fullscreen","type":"text","label":"Fullscreen label","default":"Fullscreen"},{"name":"exitFullscreen","type":"text","label":"Exit fullscreen label","default":"Exit fullscreen"},{"name":"prevSlide","type":"text","label":"Previous slide label","default":"Previous slide"},{"name":"nextSlide","type":"text","label":"Next slide label","default":"Next slide"},{"name":"currentSlide","type":"text","label":"Current slide label","default":"Current slide"},{"name":"lastSlide","type":"text","label":"Last slide label","default":"Last slide"},{"name":"solutionModeTitle","type":"text","label":"Exit solution mode text","default":"Exit solution mode"},{"name":"solutionModeText","type":"text","label":"Solution mode text","default":"Solution Mode"},{"name":"summaryMultipleTaskText","type":"text","label":"Text when multiple tasks on a page","default":"Multiple tasks"},{"name":"scoreMessage","type":"text","label":"Score message text","default":"You achieved:"},{"name":"shareFacebook","type":"text","label":"Share to Facebook text","default":"Share on Facebook"},{"name":"shareTwitter","type":"text","label":"Share to Twitter text","default":"Share on Twitter"},{"name":"summary","type":"text","label":"Title for summary slide","default":"Summary"},{"name":"solutionsButtonTitle","type":"text","label":"Title for the comments icon","default":"Show comments"},{"name":"printTitle","type":"text","label":"Title for print button","default":"Print"},{"name":"printIngress","type":"text","label":"Print dialog ingress","default":"How would you like to print this presentation?"},{"name":"printAllSlides","type":"text","label":"Label for \"Print all slides\" button","default":"Print all slides"},{"name":"printCurrentSlide","type":"text","label":"Label for \"Print current slide\" button","default":"Print current slide"}]},{"name":"override","type":"group","label":"Behaviour settings.","description":"These options will let you override behaviour settings.","optional":true,"fields":[{"name":"activeSurface","type":"boolean","widget":"disposableBoolean","label":"Activate Active Surface Mode","description":"Removes navigation controls for the end user. Use Go To Slide to navigate.","default":false},{"name":"overrideButtons","type":"boolean","label":"Enable behaviour override.","description":"If this is enabled the questions own settings will be ignored and the below settings will be used instead.","default":false},{"name":"overrideShowSolutionButton","type":"boolean","label":"Enable \"Show solution\" buttons.","description":"Enabling this option will make questions show the \"Show solution\" button.","default":false},{"name":"overrideRetry","type":"boolean","label":"Enable \"Retry\".","description":"Enabling this option will make the user able to \"Retry\" .","default":false},{"name":"hideSummarySlide","type":"boolean","label":"Hide Summary Slide","description":"Hides the summary slide.","default":false}]}]');
   	
   	//	$semantics = json_decode('[{"name":"presentation","type":"group","widget":"coursepresentation","fields":[{"name":"slides","type":"list","field":{"name":"slide","type":"group","fields":[{"name":"elements","type":"list","field":{"name":"element","type":"group","fields":[{"name":"x","type":"number","widget":"none"},{"name":"y","type":"number","widget":"none"},{"name":"width","type":"number","widget":"none","optional":true},{"name":"height","type":"number","widget":"none","optional":true},{"name":"action","type":"library","options":["H5P.AdvancedText 1.1","H5P.Link 1.1","H5P.Image 1.0","H5P.Video 1.2","H5P.Audio 1.2","H5P.Blanks 1.4","H5P.SingleChoiceSet 1.3","H5P.Summary 1.4","H5P.DragText 1.4","H5P.MarkTheWords 1.5"],"optional":true},{"name":"solution","type":"text","widget":"text","optional":true,"label":"Comments","description":"The comments are shown when the user displays the suggested answers for all slides.","enterMode":"p","tags":["strong","em","del","a","ul","ol","h2","h3","hr"]},{"name":"alwaysDisplayComments","type":"boolean","label":"Always display comments","optional":true},{"name":"backgroundOpacity","type":"number","label":"Background Opacity","min":0,"max":100,"step":5,"default":0,"optional":true},{"name":"displayAsButton","type":"boolean","label":"Display as button","default":false,"optional":true},{"name":"title","type":"text","optional":true,"label":"Title"},{"name":"goToSlide","type":"number","label":"Go To Slide","min":1,"optional":true},{"name":"invisible","type":"boolean","label":"Invisible","description":"Default cursor, no title and no tab index. Warning: Users with disabilities or keyboard only users will have trouble using this element.","default":false},{"name":"metadata","type":"group","label":"Metadata","optional":true,"deprecated":true,"fields":[{"name":"title","type":"text","optional":true,"label":"Title"},{"name":"author","type":"text","optional":true,"label":"Author"},{"name":"lisence","type":"text","optional":true,"label":"License"}]}]}},{"name":"keywords","type":"list","optional":true,"field":{"name":"keyword","type":"group","optional":true,"fields":[{"name":"main","type":"text","optional":true},{"name":"subs","type":"list","optional":true,"field":{"name":"keyword","type":"text"}}]}},{"name":"slideBackgroundSelector","type":"group","widget":"radioSelector","fields":[{"name":"imageSlideBackground","type":"image","label":"Image","optional":true,"description":"Image background should have a 2:1 width to height ratio to avoid stretching. High resolution images will display better on larger screens."},{"name":"fillSlideBackground","type":"text","widget":"colorSelector","label":"Pick a color","spectrum":{"flat":true,"showInput":true,"allowEmpty":true,"showButtons":false},"default":null,"optional":true}]}]}},{"name":"ct","type":"text","widget":"none","optional":true,"tags":["strong","em","del","br","p","a","h2","h3"]},{"name":"keywordListEnabled","type":"boolean","label":"Keyword list","default":true},{"name":"keywordListAlwaysShow","type":"boolean","label":"Always show","default":false},{"name":"keywordListAutoHide","type":"boolean","label":"Auto hide","default":false},{"name":"keywordListOpacity","type":"number","label":"Opacity","min":0,"max":100,"default":90},{"name":"globalBackgroundSelector","type":"group","widget":"radioSelector","fields":[{"name":"imageGlobalBackground","type":"image","label":"Image","optional":true,"description":"Image background should have a 2:1 width to height ratio to avoid stretching. High resolution images will display better on larger screens."},{"name":"fillGlobalBackground","type":"text","widget":"colorSelector","label":"Pick a color","spectrum":{"flat":true,"showInput":true,"allowEmpty":true,"showButtons":false},"default":null,"optional":true}]}]},{"name":"l10n","type":"group","label":"Localize","common":true,"fields":[{"name":"slide","type":"text","label":"Translation for \"Slide\"","default":"Slide"},{"name":"yourScore","type":"text","label":"Translation for \"Your Score\"","default":"Your Score"},{"name":"maxScore","type":"text","label":"Translation for \"Max Score\"","default":"Max Score"},{"name":"goodScore","type":"text","label":"Greeting given for GOOD score","default":"Congratulations! You got @percent correct!","description":"@percent is replaced by the real user score in percent"},{"name":"okScore","type":"text","label":"Greeting given for OK score","default":"Nice effort! You got @percent correct!","description":"@percent is replaced by the real user score in percent"},{"name":"badScore","type":"text","label":"Greeting given for BAD score","default":"You got @percent correct.","description":"@percent is replaced by the real user score in percent"},{"name":"Total","type":"text","label":"Translation for \"Total\"","default":"Total"},{"name":"showSolutions","type":"text","label":"Title for show solutions button","default":"Show solutions"},{"name":"retry","type":"text","label":"Text for the retry button","default":"Retry","optional":true},{"name":"title","type":"text","label":"Translation for \"Title\"","default":"Title"},{"name":"author","type":"text","label":"Translation for \"Author\/supplier\"","default":"Author"},{"name":"lisence","type":"text","label":"Translation for \"License\"","default":"License","deprecated":true,"optional":true},{"name":"license","type":"text","label":"Translation for \"License\"","default":"License"},{"name":"exportAnswers","type":"text","label":"Text for the export text button","default":"Export text"},{"name":"copyright","type":"text","label":"Text for the \"Rights of use\" button","default":"Rights of use"},{"name":"hideKeywords","type":"text","label":"Hide keywords list button title","default":"Hide keywords list"},{"name":"showKeywords","type":"text","label":"Show keywords list button title","default":"Show keywords list"},{"name":"fullscreen","type":"text","label":"Fullscreen label","default":"Fullscreen"},{"name":"exitFullscreen","type":"text","label":"Exit fullscreen label","default":"Exit fullscreen"},{"name":"prevSlide","type":"text","label":"Previous slide label","default":"Previous slide"},{"name":"nextSlide","type":"text","label":"Next slide label","default":"Next slide"},{"name":"currentSlide","type":"text","label":"Current slide label","default":"Current slide"},{"name":"lastSlide","type":"text","label":"Last slide label","default":"Last slide"},{"name":"solutionModeTitle","type":"text","label":"Exit solution mode text","default":"Exit solution mode"},{"name":"solutionModeText","type":"text","label":"Solution mode text","default":"Solution Mode"},{"name":"summaryMultipleTaskText","type":"text","label":"Text when multiple tasks on a page","default":"Multiple tasks"},{"name":"scoreMessage","type":"text","label":"Score message text","default":"You achieved:"},{"name":"shareFacebook","type":"text","label":"Share to Facebook text","default":"Share on Facebook"},{"name":"shareTwitter","type":"text","label":"Share to Twitter text","default":"Share on Twitter"},{"name":"summary","type":"text","label":"Title for summary slide","default":"Summary"},{"name":"solutionsButtonTitle","type":"text","label":"Title for the comments icon","default":"Show comments"},{"name":"printTitle","type":"text","label":"Title for print button","default":"Print"},{"name":"printIngress","type":"text","label":"Print dialog ingress","default":"How would you like to print this presentation?"},{"name":"printAllSlides","type":"text","label":"Label for \"Print all slides\" button","default":"Print all slides"},{"name":"printCurrentSlide","type":"text","label":"Label for \"Print current slide\" button","default":"Print current slide"}]},{"name":"override","type":"group","label":"Behaviour settings.","description":"These options will let you override behaviour settings.","optional":true,"fields":[{"name":"activeSurface","type":"boolean","widget":"disposableBoolean","label":"Activate Active Surface Mode","description":"Removes navigation controls for the end user. Use Go To Slide to navigate.","default":false},{"name":"overrideButtons","type":"boolean","label":"Enable behaviour override.","description":"If this is enabled the questions own settings will be ignored and the below settings will be used instead.","default":false},{"name":"overrideShowSolutionButton","type":"boolean","label":"Enable \"Show solution\" buttons.","description":"Enabling this option will make questions show the \"Show solution\" button.","default":false},{"name":"overrideRetry","type":"boolean","label":"Enable \"Retry\".","description":"Enabling this option will make the user able to \"Retry\" .","default":false},{"name":"hideSummarySlide","type":"boolean","label":"Hide Summary Slide","description":"Hides the summary slide.","default":false}]}]');
		//$semantics = json_decode('[{"name":"presentation","type":"group","widget":"coursepresentation","fields":[{"name":"slides","type":"list","field":{"name":"slide","type":"group","fields":[{"name":"elements","type":"list","field":{"name":"element","type":"group","fields":[{"name":"x","type":"number","widget":"none"},{"name":"y","type":"number","widget":"none"},{"name":"width","type":"number","widget":"none","optional":true},{"name":"height","type":"number","widget":"none","optional":true},{"name":"action","type":"library","options":["H5P.AdvancedText 1.1","H5P.ContinuousText 1.2","H5P.Link 1.1","H5P.Image 1.0","H5P.Video 1.2","H5P.Audio 1.2","H5P.Blanks 1.4","H5P.SingleChoiceSet 1.3","H5P.MultiChoice 1.6","H5P.Summary 1.4","H5P.DragText 1.4","H5P.MarkTheWords 1.5"],"optional":true},{"name":"solution","type":"text","widget":"text","optional":true,"label":"Comments","description":"The comments are shown when the user displays the suggested answers for all slides.","enterMode":"p","tags":["strong","em","del","a","ul","ol","h2","h3","hr"]},{"name":"alwaysDisplayComments","type":"boolean","label":"Always display comments","optional":true},{"name":"backgroundOpacity","type":"number","label":"Background Opacity","min":0,"max":100,"step":5,"default":0,"optional":true},{"name":"displayAsButton","type":"boolean","label":"Display as button","default":false,"optional":true},{"name":"title","type":"text","optional":true,"label":"Title"},{"name":"goToSlide","type":"number","label":"Go To Slide","min":1,"optional":true},{"name":"invisible","type":"boolean","label":"Invisible","description":"Default cursor, no title and no tab index. Warning: Users with disabilities or keyboard only users will have trouble using this element.","default":false},{"name":"metadata","type":"group","label":"Metadata","optional":true,"deprecated":true,"fields":[{"name":"title","type":"text","optional":true,"label":"Title"},{"name":"author","type":"text","optional":true,"label":"Author"},{"name":"lisence","type":"text","optional":true,"label":"License"}]}]}},{"name":"keywords","type":"list","optional":true,"field":{"name":"keyword","type":"group","optional":true,"fields":[{"name":"main","type":"text","optional":true},{"name":"subs","type":"list","optional":true,"field":{"name":"keyword","type":"text"}}]}},{"name":"slideBackgroundSelector","type":"group","widget":"radioSelector","fields":[{"name":"imageSlideBackground","type":"image","label":"Image","optional":true,"description":"Image background should have a 2:1 width to height ratio to avoid stretching. High resolution images will display better on larger screens."},{"name":"fillSlideBackground","type":"text","widget":"colorSelector","label":"Pick a color","spectrum":{"flat":true,"showInput":true,"allowEmpty":true,"showButtons":false},"default":null,"optional":true}]}]}},{"name":"ct","type":"text","widget":"none","optional":true,"tags":["strong","em","del","br","p","a","h2","h3"]},{"name":"keywordListEnabled","type":"boolean","label":"Keyword list","default":true},{"name":"keywordListAlwaysShow","type":"boolean","label":"Always show","default":false},{"name":"keywordListAutoHide","type":"boolean","label":"Auto hide","default":false},{"name":"keywordListOpacity","type":"number","label":"Opacity","min":0,"max":100,"default":90},{"name":"globalBackgroundSelector","type":"group","widget":"radioSelector","fields":[{"name":"imageGlobalBackground","type":"image","label":"Image","optional":true,"description":"Image background should have a 2:1 width to height ratio to avoid stretching. High resolution images will display better on larger screens."},{"name":"fillGlobalBackground","type":"text","widget":"colorSelector","label":"Pick a color","spectrum":{"flat":true,"showInput":true,"allowEmpty":true,"showButtons":false},"default":null,"optional":true}]}]},{"name":"l10n","type":"group","label":"Localize","common":true,"fields":[{"name":"slide","type":"text","label":"Translation for \"Slide\"","default":"Slide"},{"name":"yourScore","type":"text","label":"Translation for \"Your Score\"","default":"Your Score"},{"name":"maxScore","type":"text","label":"Translation for \"Max Score\"","default":"Max Score"},{"name":"goodScore","type":"text","label":"Greeting given for GOOD score","default":"Congratulations! You got @percent correct!","description":"@percent is replaced by the real user score in percent"},{"name":"okScore","type":"text","label":"Greeting given for OK score","default":"Nice effort! You got @percent correct!","description":"@percent is replaced by the real user score in percent"},{"name":"badScore","type":"text","label":"Greeting given for BAD score","default":"You got @percent correct.","description":"@percent is replaced by the real user score in percent"},{"name":"Total","type":"text","label":"Translation for \"Total\"","default":"Total"},{"name":"showSolutions","type":"text","label":"Title for show solutions button","default":"Show solutions"},{"name":"retry","type":"text","label":"Text for the retry button","default":"Retry","optional":true},{"name":"title","type":"text","label":"Translation for \"Title\"","default":"Title"},{"name":"author","type":"text","label":"Translation for \"Author\/supplier\"","default":"Author"},{"name":"lisence","type":"text","label":"Translation for \"License\"","default":"License","deprecated":true,"optional":true},{"name":"license","type":"text","label":"Translation for \"License\"","default":"License"},{"name":"exportAnswers","type":"text","label":"Text for the export text button","default":"Export text"},{"name":"copyright","type":"text","label":"Text for the \"Rights of use\" button","default":"Rights of use"},{"name":"hideKeywords","type":"text","label":"Hide keywords list button title","default":"Hide keywords list"},{"name":"showKeywords","type":"text","label":"Show keywords list button title","default":"Show keywords list"},{"name":"fullscreen","type":"text","label":"Fullscreen label","default":"Fullscreen"},{"name":"exitFullscreen","type":"text","label":"Exit fullscreen label","default":"Exit fullscreen"},{"name":"prevSlide","type":"text","label":"Previous slide label","default":"Previous slide"},{"name":"nextSlide","type":"text","label":"Next slide label","default":"Next slide"},{"name":"currentSlide","type":"text","label":"Current slide label","default":"Current slide"},{"name":"lastSlide","type":"text","label":"Last slide label","default":"Last slide"},{"name":"solutionModeTitle","type":"text","label":"Exit solution mode text","default":"Exit solution mode"},{"name":"solutionModeText","type":"text","label":"Solution mode text","default":"Solution Mode"},{"name":"summaryMultipleTaskText","type":"text","label":"Text when multiple tasks on a page","default":"Multiple tasks"},{"name":"scoreMessage","type":"text","label":"Score message text","default":"You achieved:"},{"name":"shareFacebook","type":"text","label":"Share to Facebook text","default":"Share on Facebook"},{"name":"shareTwitter","type":"text","label":"Share to Twitter text","default":"Share on Twitter"},{"name":"summary","type":"text","label":"Title for summary slide","default":"Summary"},{"name":"solutionsButtonTitle","type":"text","label":"Title for the comments icon","default":"Show comments"},{"name":"printTitle","type":"text","label":"Title for print button","default":"Print"},{"name":"printIngress","type":"text","label":"Print dialog ingress","default":"How would you like to print this presentation?"},{"name":"printAllSlides","type":"text","label":"Label for \"Print all slides\" button","default":"Print all slides"},{"name":"printCurrentSlide","type":"text","label":"Label for \"Print current slide\" button","default":"Print current slide"}]},{"name":"override","type":"group","label":"Behaviour settings.","description":"These options will let you override behaviour settings.","optional":true,"fields":[{"name":"activeSurface","type":"boolean","widget":"disposableBoolean","label":"Activate Active Surface Mode","description":"Removes navigation controls for the end user. Use Go To Slide to navigate.","default":false},{"name":"overrideButtons","type":"boolean","label":"Enable behaviour override.","description":"If this is enabled the questions own settings will be ignored and the below settings will be used instead.","default":false},{"name":"overrideShowSolutionButton","type":"boolean","label":"Enable \"Show solution\" buttons.","description":"Enabling this option will make questions show the \"Show solution\" button.","default":false},{"name":"overrideRetry","type":"boolean","label":"Enable \"Retry\".","description":"Enabling this option will make the user able to \"Retry\" .","default":false},{"name":"hideSummarySlide","type":"boolean","label":"Hide Summary Slide","description":"Hides the summary slide.","default":false}]}]');
   
   }
 else if($machine_name == "H5P.Text")
 {
 	$semantics = json_decode('[{"name":"text","label":"Text","type":"text","widget":"html","tags":["strong","em","del","br","p","a","h2","h3"]}]');
 	
 }
 else if($machine_name == "H5P.Blanks")
 {
	 //	$semantics = json_decode('[{"name":"image","type":"image","label":"Task image","optional":true,"description":"An optional image to display above the task."},{"label":"Task description","name":"text","type":"text","widget":"html","default":"Fill in the missing words","description":"A guide telling the user how to answer this task.","enterMode":"p","tags":["strong","em","u","a","ul","ol","h2","h3","hr"]},{"name":"questions","type":"list","label":"Text blocks","entity":"text block","min":1,"max":31,"field":{"name":"question","type":"text","widget":"html","label":"Line of text","placeholder":"","description":"Blanks are added with an asterix (*) in front and behind the correct word\/phrase. Alternative answers are separated with a forward slash (\/). You may add a textual tip, using a colon (:) in front of the tip. Example: H5P content may be edited using a *browser\/web-browser:Something you use every day*.","enterMode":"p","tags":["strong","em","del","u"]}},{"label":"Feedback text","name":"score","type":"text","default":"You got @score of @total blanks correct.","description":"Feedback text, variables available: @score and @total. Example: 'You got @score of @total possible points'","common":true},{"label":"Text for \"Show solutions\" button","name":"showSolutions","type":"text","default":"Show solutions","common":true},{"label":"Text for \"Retry\" button","name":"tryAgain","type":"text","default":"Retry","common":true,"optional":true},{"label":"Text for \"Check\" button","name":"checkAnswer","type":"text","default":"Check","common":true,"optional":true},{"label":"Text for \"Not filled out\" message","name":"notFilledOut","type":"text","default":"Please fill in all blanks","common":true,"optional":true},{"name":"behaviour","type":"group","label":"Behavioural settings.","description":"These options will let you control how the task behaves.","optional":true,"fields":[{"label":"Enable \"Retry\"","name":"enableRetry","type":"boolean","default":true,"optional":true},{"label":"Enable \"Show solutions\" button","name":"enableSolutionsButton","type":"boolean","default":true,"optional":true},{"label":"Automatically check answers after input","name":"autoCheck","type":"boolean","default":false,"optional":true},{"name":"caseSensitive","type":"boolean","default":true,"label":"Case sensitive","description":"Makes sure the user input has to be exactly the same as the answer."},{"label":"Require all fields to be answered before the solution can be viewed","name":"showSolutionsRequiresInput","type":"boolean","default":true,"optional":true},{"label":"Put input fields on separate lines","name":"separateLines","type":"boolean","default":false,"optional":true},{"label":"Disable image zooming for question image","name":"disableImageZooming","type":"boolean","default":false,"optional":true}]}]');
 }
 else if($machine_name == "H5P.ContinuousText")
 {
 	$semantics = json_decode('[{"name":"text","type":"text","widget":"text","label":"Text","tags":["strong","em","del","br","p","a","h2","h3"]}]');
 }
 else if($machine_name == "H5P.AdvancedText")
 {
 		$semantics = json_decode('[{"name":"text","type":"text","widget":"text","label":"Text","enterMode":"p","tags":["strong","em","del","a","ul","ol","h2","h3","hr"],"font":{"size":true,"color":true,"background":true}}]');
 }
else if($machine_name == "H5P.SingleChoiceSet")
 {
 	$semantics=json_decode('[{"name":"choices","type":"list","entity":"question","min":1,"defaultNum":1,"field":{"name":"choice","type":"group","label":"Question","fields":[{"name":"question","type":"text","label":"Question"},{"name":"answers","type":"list","label":"Answer(Correct)","entity":"answer","min":2,"max":4,"defaultNum":2,"field":{"name":"answer","type":"text","label":"Answer"}}]}}]');
 		 		
 }
else if ($machine_name == 'H5P.InteractiveVideo')
{
	//$semantics = json_decode('[{"name":"interactiveVideo","type":"group","widget":"wizard","label":"Interactive Video Editor","fields":[{"fields":[{"name":"interactions","type":"list","field":{"name":"interaction","type":"group","fields":[{"name":"duration","type":"group","widget":"duration","label":"Display time","fields":[{"name":"from","type":"number"},{"name":"to","type":"number"}]},{"name":"pause","label":"Pause video","type":"boolean"},{"name":"displayType","label":"Display as","description":"<b>Button</b> is a collapsed interaction the user must press to open. <b>Poster</b> is an expanded interaction displayed directly on top of the video","type":"select","widget":"imageRadioButtonGroup","options":[{"value":"button","label":"Button"},{"value":"poster","label":"Poster"}],"default":"button"},{"name":"label","type":"text","label":"Label","description":"Label displayed next to interaction icon.","optional":true},{"name":"x","type":"number","widget":"none"},{"name":"y","type":"number","widget":"none"},{"name":"width","type":"number","widget":"none","optional":true},{"name":"height","type":"number","widget":"none","optional":true},{"name":"action","type":"library","options":["H5P.Nil 1.0","H5P.Text 1.1","H5P.Table 1.1","H5P.Link 1.1","H5P.Image 1.0","H5P.Summary 1.4","H5P.SingleChoiceSet 1.3","H5P.MultiChoice 1.6","H5P.Blanks 1.4","H5P.DragQuestion 1.5","H5P.MarkTheWords 1.5","H5P.DragText 1.4","H5P.GoToQuestion 1.0"]},{"name":"adaptivity","type":"group","label":"Adaptivity","optional":true,"fields":[{"name":"correct","type":"group","label":"Action on all correct","fields":[{"name":"seekTo","type":"number","widget":"timecode","label":"Seek to","description":"Enter timecode in the format M:SS"},{"name":"allowOptOut","type":"boolean","label":"Allow the user to opt out and continue"},{"name":"message","type":"text","widget":"html","enterMode":"p","tags":["strong","em","del","a"],"label":"Message"},{"name":"seekLabel","type":"text","label":"Label for seek button"}]},{"name":"wrong","type":"group","label":"Action on wrong","fields":[{"name":"seekTo","type":"number","widget":"timecode","label":"Seek to","description":"Enter timecode in the format M:SS"},{"name":"allowOptOut","type":"boolean","label":"Allow the user to opt out and continue"},{"name":"message","type":"text","widget":"html","enterMode":"p","tags":["strong","em","del","a"],"label":"Message"},{"name":"seekLabel","type":"text","label":"Label for seek button"}]}]}]}},{"name":"bookmarks","type":"list","field":{"name":"bookmark","type":"group","fields":[{"name":"time","type":"number"},{"name":"label","type":"text"}]}}],"label":"Add interactions","name":"assets","poster":"video/poster","type":"group","video":"video/files","widget":"interactiveVideo"},{"name":"video","type":"group","label":"Upload/embed video","fields":[{"name":"files","type":"video","label":"Video files","description":"Select the video files you wish to use in your interactive video. To ensure maximum support in browsers at least add a version of the video in webm and mp4 formats."},{"name":"poster","type":"image","label":"Poster image"},{"name":"title","type":"text","label":"The title of this interactive video","maxLength":60,"default":"Interactive Video","description":"Used in summaries, statistics etc."},{"name":"startScreenOptions","type":"group","label":"Video start screen options","optional":true,"fields":[{"name":"hideStartTitle","type":"boolean","label":"Hide title on video start screen","optional":true,"default":false},{"name":"shortStartDescription","type":"text","label":"Short description (Optional)","optional":true,"maxLength":120,"description":"Optional. Display a short description text on the video start screen."}]},{"name":"copyright","type":"text","widget":"html","enterMode":"p","label":"Video copyright information","optional":true,"description":"Information regarding copyright of the video and elements used in the video.","tags":["strong","em","del","a"]}]},{"name":"summary","type":"group","label":"Summary task","fields":[{"name":"task","type":"library","options":["H5P.Summary 1.4"],"default":{"library":"H5P.Summary 1.4","params":{}}},{"name":"displayAt","type":"number","label":"Display at","description":"Number of seconds before the video ends.","default":3}]}]},{"name":"override","type":"group","label":"Settings for \"Show solution\" button and \"Retry\".","description":"These options will let you override when to display \"Show solution\" button and \"Retry\" in integrated h5p content.","optional":true,"fields":[{"name":"overrideButtons","type":"boolean","label":"Enable override for \"Show solution\" and \"Retry\" settings.","description":"If this is enabled the questions own settings will be ignored and the below settings will be used instead.","default":false},{"name":"overrideShowSolutionButton","type":"boolean","label":"Enable \"Show solution\" buttons.","description":"Enabling this option will make questions show the \"Show solution\" button.","default":false},{"name":"overrideRetry","type":"boolean","label":"Enable \"Retry\".","description":"Enabling this option will make the user able to \"Retry\" .","default":false}]},{"name":"l10n","type":"group","label":"Localize","common":true,"optional":true,"fields":[{"name":"interaction","type":"text","label":"Interaction title","default":"Interaction","optional":true},{"name":"play","type":"text","label":"Play title","default":"Play","optional":true},{"name":"pause","type":"text","label":"Pause title","default":"Pause","optional":true},{"name":"mute","type":"text","label":"Mute title","default":"Mute","optional":true},{"name":"unmute","type":"text","label":"Unmute title","default":"Unmute","optional":true},{"name":"quality","type":"text","label":"Video quality title","default":"Video Quality","optional":true},{"name":"fullscreen","type":"text","label":"Fullscreen title","default":"Fullscreen","optional":true},{"name":"exitFullscreen","type":"text","label":"Exit fullscreen title","default":"Exit Fullscreen","optional":true},{"name":"summary","type":"text","label":"Summary title","default":"Summary","optional":true},{"name":"bookmarks","type":"text","label":"Bookmarks title","default":"Bookmarks","optional":true},{"name":"defaultAdaptivitySeekLabel","type":"text","label":"Default label for adaptivity seek button","default":"Continue","optional":true}]}]');
	$semantics = json_decode('[{"name":"interactiveVideo","type":"group","widget":"wizard","label":"","fields":[{"fields":[{"name":"interactions","type":"list","field":{"name":"interaction","type":"group","fields":[{"name":"duration","type":"group","widget":"duration","label":"Display time","fields":[{"name":"from","type":"number"},{"name":"to","type":"number"}]},{"name":"pause","label":"Pause video","type":"boolean"},{"name":"displayType","label":"Display as","description":"<b>Button</b> is a collapsed interaction the user must press to open. <b>Poster</b> is an expanded interaction displayed directly on top of the video","type":"select","widget":"imageRadioButtonGroup","options":[{"value":"button","label":"Button"},{"value":"poster","label":"Poster"}],"default":"button"},{"name":"label","type":"text","label":"Label","description":"Label displayed next to interaction icon.","optional":true},{"name":"x","type":"number","widget":"none"},{"name":"y","type":"number","widget":"none"},{"name":"width","type":"number","widget":"none","optional":true},{"name":"height","type":"number","widget":"none","optional":true},{"name":"action","type":"library","options":["H5P.Nil 1.0","H5P.Text 1.1","H5P.Link 1.1","H5P.Image 1.0","H5P.SingleChoiceSet 1.3","H5P.Blanks 1.4","H5P.MarkTheWords 1.5","H5P.DragText 1.4","H5P.GoToQuestion 1.0"]},{"name":"adaptivity","type":"group","label":"Adaptivity","optional":true,"fields":[{"name":"correct","type":"group","label":"Action on all correct","fields":[{"name":"seekTo","type":"number","widget":"timecode","label":"Seek to","description":"Enter timecode in the format M:SS"},{"name":"allowOptOut","type":"boolean","label":"Allow the user to opt out and continue"},{"name":"message","type":"text","widget":"html","enterMode":"p","tags":["strong","em","del","a"],"label":"Message"},{"name":"seekLabel","type":"text","label":"Label for seek button"}]},{"name":"wrong","type":"group","label":"Action on wrong","fields":[{"name":"seekTo","type":"number","widget":"timecode","label":"Seek to","description":"Enter timecode in the format M:SS"},{"name":"allowOptOut","type":"boolean","label":"Allow the user to opt out and continue"},{"name":"message","type":"text","widget":"html","enterMode":"p","tags":["strong","em","del","a"],"label":"Message"},{"name":"seekLabel","type":"text","label":"Label for seek button"}]}]}]}},{"name":"bookmarks","type":"list","field":{"name":"bookmark","type":"group","fields":[{"name":"time","type":"number"},{"name":"label","type":"text"}]}}],"label":"Add interactions","name":"assets","poster":"video/poster","type":"group","video":"video/files","widget":"interactiveVideo"},{"name":"video","type":"group","label":"Upload/embed video","fields":[{"name":"files","type":"video","label":"Video files","description":"Select the video files you wish to use in your interactive video. To ensure maximum support in browsers at least add a version of the video in webm and mp4 formats."},{"name":"poster","type":"image","label":"Poster image"},{"name":"title","type":"text","label":"The title of this interactive video","maxLength":60,"default":"Interactive Video","description":"Used in summaries, statistics etc."},{"name":"startScreenOptions","type":"group","label":"Video start screen options","optional":true,"fields":[{"name":"hideStartTitle","type":"boolean","label":"Hide title on video start screen","optional":true,"default":false},{"name":"shortStartDescription","type":"text","label":"Short description (Optional)","optional":true,"maxLength":120,"description":"Optional. Display a short description text on the video start screen."}]},{"name":"copyright","type":"text","widget":"html","enterMode":"p","label":"Video copyright information","optional":true,"description":"Information regarding copyright of the video and elements used in the video.","tags":["strong","em","del","a"]}]},{"name":"summary","type":"group","label":"Summary task","fields":[{"name":"task","type":"library","options":["H5P.Summary 1.4"],"default":{"library":"H5P.Summary 1.4","params":{}}},{"name":"displayAt","type":"number","label":"Display at","description":"Number of seconds before the video ends.","default":3}]}]},{"name":"override","type":"group","label":"Settings for \"Show solution\" button and \"Retry\".","description":"These options will let you override when to display \"Show solution\" button and \"Retry\" in integrated h5p content.","optional":true,"fields":[{"name":"overrideButtons","type":"boolean","label":"Enable override for \"Show solution\" and \"Retry\" settings.","description":"If this is enabled the questions own settings will be ignored and the below settings will be used instead.","default":false},{"name":"overrideShowSolutionButton","type":"boolean","label":"Enable \"Show solution\" buttons.","description":"Enabling this option will make questions show the \"Show solution\" button.","default":false},{"name":"overrideRetry","type":"boolean","label":"Enable \"Retry\".","description":"Enabling this option will make the user able to \"Retry\" .","default":false}]},{"name":"l10n","type":"group","label":"Localize","common":true,"optional":true,"fields":[{"name":"interaction","type":"text","label":"Interaction title","default":"Interaction","optional":true},{"name":"play","type":"text","label":"Play title","default":"Play","optional":true},{"name":"pause","type":"text","label":"Pause title","default":"Pause","optional":true},{"name":"mute","type":"text","label":"Mute title","default":"Mute","optional":true},{"name":"unmute","type":"text","label":"Unmute title","default":"Unmute","optional":true},{"name":"quality","type":"text","label":"Video quality title","default":"Video Quality","optional":true},{"name":"fullscreen","type":"text","label":"Fullscreen title","default":"Fullscreen","optional":true},{"name":"exitFullscreen","type":"text","label":"Exit fullscreen title","default":"Exit Fullscreen","optional":true},{"name":"summary","type":"text","label":"Summary title","default":"Summary","optional":true},{"name":"bookmarks","type":"text","label":"Bookmarks title","default":"Bookmarks","optional":true},{"name":"defaultAdaptivitySeekLabel","type":"text","label":"Default label for adaptivity seek button","default":"Continue","optional":true}]}]');
	
	/*unset($semantics[0]->fields[0]->fields[1]);
 	unset($semantics[0]->fields[0]->fields[2]);
 	unset($semantics[0]->fields[0]->fields[3]);
 	unset($semantics[0]->fields[0]->fields[4]);
 	$semantics[0]->fields[0]->fields = array_values($semantics[0]->fields[0]->fields);
 	unset($semantics[1]);
 	unset($semantics[2]);
 	$semantics = array_values($semantics);
 	unset($semantics[0]->fields[2]->fields[1]);
 	$semantics[0]->fields[2]->fields = array_values($semantics[0]->fields[2]->fields);
 	expDebug::dPrint("json encode....".json_encode($semantics));
 	*/
 	
	
	//"H5P.Table 1.1"
} 
else if($machine_name == "H5P.MarkTheWords")
{
	$semantics = json_decode('[{"label":"Task description","name":"taskDescription","type":"text","widget":"text","description":"Describe how the user should solve the task.","placeholder":"Click on all the verbs in the text that follows.","enterMode":"p","tags":["strong","em","u","a","ul","ol","h2","h3","hr"]},{"label":"Textfield","name":"textField","type":"text","widget":"text","tags":["p","br","strong","em"],"placeholder":"This is an answer: *answer*.","description":"Marked words are added with an asterix (*). An asterix may be escaped with another asterix, resulting in ** = *. Example: The correct words are marked with like this: *correctword*, and a character asterix is written like this: **."},{"label":"Text for \"Check\" button","name":"checkAnswerButton","type":"text","default":"Check","common":true},{"label":"Text for \"Retry\" button","name":"tryAgainButton","type":"text","default":"Retry","common":true},{"label":"Text for \"Show solution\" button","name":"showSolutionButton","type":"text","default":"Show solution","common":true},{"label":"Feedback text","name":"score","type":"text","default":"You got @score of @total points.","placeholder":"You got @score of @total points.","description":"Feedback text, variables available: @score @total @correct @wrong @missed. Example: Score : @score of @total, correct: @correct, wrong: @wrong, missed: @missed.","common":true},{"name":"behaviour","type":"group","label":"Behavioural settings.","description":"These options will let you control how the task behaves.","optional":true,"fields":[{"name":"enableRetry","type":"boolean","label":"Enable \"Retry\"","default":true},{"name":"enableSolutionsButton","type":"boolean","label":"Enable \"Show solution\" button","default":true}]}]');
}
else if($machine_name == "H5P.DragText")
{
	$semantics = json_decode('[{"label":"Task description","name":"taskDescription","type":"text","widget":"text","description":"Describe how the user should solve the task.","enterMode":"p","tags":["strong","em","u","a","ul","ol","h2","h3","hr"]},{"label":"Textfield","name":"textField","type":"text","widget":"text","placeholder":"","description":"Droppable words are added with an asterisk (*) in front and behind the correct word\/phrase. You may add a textual tip, using a colon (:) in front of the tip. Example: H5P content may be edited using a *browser:Something you use every day*."},{"label":"Text for \"Check\" button","name":"checkAnswer","type":"text","default":"Check","common":true},{"label":"Text for \"Retry\" button","name":"tryAgain","type":"text","default":"Retry","common":true},{"label":"Text for \"Show Solution\" button","name":"showSolution","type":"text","default":"Show Solution","common":true},{"label":"Feedback text","name":"score","type":"text","default":"Score : @score of @total.","description":"Feedback text, variables available: @score @total. Example: You got @score of @total possible points","common":true},{"name":"behaviour","type":"group","label":"Behavioural settings.","description":"These options will let you control how the task behaves.","optional":true,"fields":[{"label":"Enable \"Retry\"","name":"enableRetry","type":"boolean","default":true},{"label":"Enable \"Show Solution\" button","name":"enableSolutionsButton","type":"boolean","default":true},{"label":"Instant feedback","name":"instantFeedback","type":"boolean","default":false,"optional":true}]}]');
} 
}

 
 function h5peditor_h5p_styles_alter(&$styles, $libraries, $mode) {
  //if (isset($libraries['H5P.MultiChoice']) && $libraries['H5P.MultiChoice']['majorVersion'] == '1') 
  {
    $styles[] = (object) array(
      // Path relative to drupal root
      'path' => drupal_get_path('module', 'h5peditor') . '/h5p-overrides.css',
      // Cache buster
      'version' => '?ver=1',
    );
  }
}

 
 function h5peditor_page_alter(&$page)
 {
 	expDebug::dPrint("suresh h5peditor page:".  $page['header']);
 	unset($page["content"]["submitted"]);
	unset($page["submitted"]);
 }