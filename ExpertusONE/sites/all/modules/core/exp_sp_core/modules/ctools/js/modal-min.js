(function(a){Drupal.CTools=Drupal.CTools||{};Drupal.CTools.Modal=Drupal.CTools.Modal||{};Drupal.CTools.Modal.show=function(b){var e={};if(b&&typeof b=="string"&&Drupal.settings[b]){a.extend(true,e,Drupal.settings[b]);}else{if(b){a.extend(true,e,b);}}var f={modalTheme:"CToolsModalDialog",throbberTheme:"CToolsModalThrobber",animation:"show",animationSpeed:"fast",modalSize:{type:"scale",width:0.8,height:0.8,addWidth:0,addHeight:0,contentRight:25,contentBottom:45},modalOptions:{opacity:0.55,background:"#fff"}};var d={};a.extend(true,d,f,Drupal.settings.CToolsModal,e);if(Drupal.CTools.Modal.currentSettings&&Drupal.CTools.Modal.currentSettings!=d){Drupal.CTools.Modal.modal.remove();Drupal.CTools.Modal.modal=null;}Drupal.CTools.Modal.currentSettings=d;var c=function(j){var h=j?document:Drupal.CTools.Modal.modal;if(Drupal.CTools.Modal.currentSettings.modalSize.type=="scale"){var i=a(window).width()*Drupal.CTools.Modal.currentSettings.modalSize.width;var g=a(window).height()*Drupal.CTools.Modal.currentSettings.modalSize.height;
}else{var i=Drupal.CTools.Modal.currentSettings.modalSize.width;var g=Drupal.CTools.Modal.currentSettings.modalSize.height;}a("div.ctools-modal-content",h).css({width:i+Drupal.CTools.Modal.currentSettings.modalSize.addWidth+"px",height:g+Drupal.CTools.Modal.currentSettings.modalSize.addHeight+"px"});a("div.ctools-modal-content .modal-content",h).css({width:(i-Drupal.CTools.Modal.currentSettings.modalSize.contentRight)+"px",height:(g-Drupal.CTools.Modal.currentSettings.modalSize.contentBottom)+"px"});};if(!Drupal.CTools.Modal.modal){Drupal.CTools.Modal.modal=a(Drupal.theme(d.modalTheme));if(d.modalSize.type=="scale"){a(window).bind("resize",c);}}c();a("span.modal-title",Drupal.CTools.Modal.modal).html(Drupal.CTools.Modal.currentSettings.loadingText);Drupal.CTools.Modal.modalContent(Drupal.CTools.Modal.modal,d.modalOptions,d.animation,d.animationSpeed);a("#modalContent .modal-content").html(Drupal.theme(d.throbberTheme));};Drupal.CTools.Modal.dismiss=function(){if(Drupal.CTools.Modal.modal){Drupal.CTools.Modal.unmodalContent(Drupal.CTools.Modal.modal);
}};Drupal.theme.prototype.CToolsModalDialog=function(){var b="";b+='  <div id="ctools-modal">';b+='    <div class="ctools-modal-content">';b+='      <div class="modal-header">';b+='        <a class="close" href="#">';b+=Drupal.CTools.Modal.currentSettings.closeText+Drupal.CTools.Modal.currentSettings.closeImage;b+="        </a>";b+='        <span id="modal-title" class="modal-title">&nbsp;</span>';b+="      </div>";b+='      <div id="modal-content" class="modal-content">';b+="      </div>";b+="    </div>";b+="  </div>";return b;};Drupal.theme.prototype.CToolsModalThrobber=function(){var b="";b+='  <div id="modal-throbber">';b+='    <div class="modal-throbber-wrapper">';b+=Drupal.CTools.Modal.currentSettings.throbber;b+="    </div>";b+="  </div>";return b;};Drupal.CTools.Modal.getSettings=function(c){var b=a(c).attr("class").match(/ctools-modal-(\S+)/);if(b){return b[1];}};Drupal.CTools.Modal.clickAjaxCacheLink=function(){Drupal.CTools.Modal.show(Drupal.CTools.Modal.getSettings(this));return Drupal.CTools.AJAX.clickAJAXCacheLink.apply(this);
};Drupal.CTools.Modal.clickAjaxLink=function(){Drupal.CTools.Modal.show(Drupal.CTools.Modal.getSettings(this));return false;};Drupal.CTools.Modal.submitAjaxForm=function(d){var b=a(this).attr("action");var c=a(this);setTimeout(function(){Drupal.CTools.AJAX.ajaxSubmit(c,b);},1);return false;};Drupal.behaviors.ZZCToolsModal={attach:function(b){a("a.ctools-use-modal:not(.ctools-use-modal-processed)",b).addClass("ctools-use-modal-processed").click(Drupal.CTools.Modal.clickAjaxLink).each(function(){var d={};if(a(this).attr("href")){d.url=a(this).attr("href");d.event="click";d.progress={type:"throbber"};}var c=a(this).attr("href");Drupal.ajax[c]=new Drupal.ajax(c,this,d);});a("input.ctools-use-modal:not(.ctools-use-modal-processed), button.ctools-use-modal:not(.ctools-use-modal-processed)",b).addClass("ctools-use-modal-processed").click(Drupal.CTools.Modal.clickAjaxLink).each(function(){var c=this;var e={};e.url=Drupal.CTools.Modal.findURL(this);e.event="click";var d=a(this).attr("id");Drupal.ajax[d]=new Drupal.ajax(d,this,e);
a("."+a(c).attr("id")+"-url").change(function(){Drupal.ajax[d].options.url=Drupal.CTools.Modal.findURL(c);});});a("#modal-content form:not(.ctools-use-modal-processed)",b).addClass("ctools-use-modal-processed").each(function(){var d={};d.url=a(this).attr("action");d.event="submit";d.progress={type:"throbber"};var c=a(this).attr("id");Drupal.ajax[c]=new Drupal.ajax(c,this,d);Drupal.ajax[c].form=a(this);a("input[type=submit], button",this).click(function(){Drupal.ajax[c].element=this;this.form.clk=this;});});a(".loginusername").focus();}};Drupal.CTools.Modal.modal_display=function(d,c,b){if(a("#modalContent").length==0){Drupal.CTools.Modal.show(Drupal.CTools.Modal.getSettings(d.element));}a("#modal-title").html(c.title);a("#modal-content").html(c.output);Drupal.attachBehaviors();};Drupal.CTools.Modal.modal_dismiss=function(b){Drupal.CTools.Modal.dismiss();a("link.ctools-temporary-css").remove();};Drupal.CTools.Modal.modal_loading=function(b){Drupal.CTools.Modal.modal_display({output:Drupal.theme(Drupal.CTools.Modal.currentSettings.throbberTheme),title:Drupal.CTools.Modal.currentSettings.loadingText});
};Drupal.CTools.Modal.findURL=function(c){var b="";var d="."+a(c).attr("id")+"-url";a(d).each(function(){if(b&&a(this).val()){b+="/";}b+=a(this).val();});return b;};Drupal.CTools.Modal.modalContent=function(j,g,e,d){if(!e){e="show";}else{if(e!="fadeIn"&&e!="slideDown"){e="show";}}if(!d){d="fast";}g=jQuery.extend({position:"absolute",left:"0px",margin:"0px",background:"#000",opacity:".55"},g);g.filter="alpha(opacity="+(100*g.opacity)+")";j.hide();if(a("#modalBackdrop")){a("#modalBackdrop").remove();}if(a("#modalContent")){a("#modalContent").remove();}if(self.pageYOffset){var i=self.pageYOffset;}else{if(document.documentElement&&document.documentElement.scrollTop){var i=document.documentElement.scrollTop;}else{if(document.body){var i=document.body.scrollTop;}}}var n=a(document).height()+50;var h=a(document).width();var f=a(window).height();var c=a(window).width();if(n<f){n=f;}a("body").append('<div id="modalBackdrop" style="z-index: 1000; display: none;"></div><div id="modalContent" style="z-index: 1001; position: absolute;">'+a(j).html()+"</div>");
modalEventHandler=function(r){target=null;if(r){target=r.target;}else{r=window.event;target=r.srcElement;}var p=a(target).parents().get();for(var q in a(target).parents().get()){var o=a(p[q]).css("position");if(o=="absolute"||o=="fixed"){return true;}}if(a(target).filter("*:visible").parents("#modalContent").size()){return true;}if(a("#modalContent")){a("#modalContent").get(0).focus();}return false;};a("body").bind("focus",modalEventHandler);a("body").bind("keypress",modalEventHandler);var b=a("#modalContent").css("top","-1000px");var k=i+(f/2)-(b.outerHeight()/2);var l=(c/2)-(b.outerWidth()/2);a("#modalBackdrop").css(g).css("top",0).css("height",n+"px").css("width",h+"px").show();b.css({top:k+"px",left:l+"px"}).hide()[e](d);modalContentClose=function(){m();return false;};a(".close").bind("click",modalContentClose);function m(){a(window).unbind("resize",modalContentResize);a("body").unbind("focus",modalEventHandler);a("body").unbind("keypress",modalEventHandler);a(".close").unbind("click",modalContentClose);
a(document).trigger("CToolsDetachBehaviors",a("#modalContent"));if(e=="fadeIn"){e="fadeOut";}if(e=="slideDown"){e="slideUp";}if(e=="show"){e="hide";}b.hide()[e](d);a("#modalContent").remove();a("#modalBackdrop").remove();}modalContentResize=function(){var r=a(document).height();var s=a(document).width();var p=a(window).height();var o=a(window).width();if(r<p){r=p;}var t=a("#modalContent");var q=(p/2)-(t.outerHeight()/2);var u=(o/2)-(t.outerWidth()/2);a("#modalBackdrop").css("height",r+"px").css("width",s+"px").show();t.css("top",q+"px").css("left",u+"px").show();};a(window).bind("resize",modalContentResize);a("#modalContent").focus();};Drupal.CTools.Modal.unmodalContent=function(b,d,c){if(!d){var d="show";}else{if((d!="fadeOut")&&(d!="slideUp")){d="show";}}if(!c){var c="fast";}a(window).unbind("resize",modalContentResize);a("body").unbind("focus",modalEventHandler);a("body").unbind("keypress",modalEventHandler);a(".close").unbind("click",modalContentClose);a(document).trigger("CToolsDetachBehaviors",a("#modalContent"));
b.each(function(){if(d=="fade"){a("#modalContent").fadeOut(c,function(){a("#modalBackdrop").fadeOut(c,function(){a(this).remove();});a(this).remove();});}else{if(d=="slide"){a("#modalContent").slideUp(c,function(){a("#modalBackdrop").slideUp(c,function(){a(this).remove();});a(this).remove();});}else{a("#modalContent").remove();a("#modalBackdrop").remove();}}});};a(function(){Drupal.ajax.prototype.commands.modal_display=Drupal.CTools.Modal.modal_display;Drupal.ajax.prototype.commands.modal_dismiss=Drupal.CTools.Modal.modal_dismiss;});})(jQuery);