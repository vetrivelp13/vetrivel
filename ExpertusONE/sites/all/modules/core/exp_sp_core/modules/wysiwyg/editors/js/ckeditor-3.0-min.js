(function(a){Drupal.wysiwyg.editor.init.ckeditor=function(c){var b={};for(var f in c){if(Drupal.settings.wysiwyg.plugins[f]){for(var e in Drupal.settings.wysiwyg.plugins[f]["native"]){if(!b[e]){var d=Drupal.settings.wysiwyg.plugins[f]["native"][e];CKEDITOR.plugins.addExternal(e,d.path,d.fileName);b[e]=true;}}for(var e in Drupal.settings.wysiwyg.plugins[f].drupal){if(!b[e]){Drupal.wysiwyg.editor.instance.ckeditor.addPlugin(e,Drupal.settings.wysiwyg.plugins[f].drupal[e],Drupal.settings.wysiwyg.plugins.drupal[e]);b[e]=true;}}}if(Drupal.settings.wysiwyg.configs.ckeditor[f].stylesSet){CKEDITOR.stylesSet.add(f,Drupal.settings.wysiwyg.configs.ckeditor[f].stylesSet);}}};Drupal.wysiwyg.editor.attach.ckeditor=function(b,e,c){CKEDITOR.config.customConfig="";var d=a("#toolbar",Drupal.overlayChild?window.parent.document:document);c.on={instanceReady:function(j){var h=j.editor;var i=CKEDITOR.dtd;var g=CKEDITOR.tools.extend({},i.$block,i.$listItem,i.$tableContent);if(c.apply_source_formatting){for(var f in g){if(f=="pre"){continue;
}this.dataProcessor.writer.setRules(f,{indent:true,breakBeforeOpen:true,breakAfterOpen:false,breakBeforeClose:false,breakAfterClose:true});}}else{g.br=1;for(var f in g){if(f=="pre"){continue;}this.dataProcessor.writer.setRules(f,{indent:false,breakBeforeOpen:false,breakAfterOpen:false,breakBeforeClose:false,breakAfterClose:false});}}},pluginsLoaded:function(g){var f=g.editor;if(f.dataProcessor&&Drupal.settings.wysiwyg.plugins[e.format]){f.dataProcessor.toHtml=CKEDITOR.tools.override(f.dataProcessor.toHtml,function(h){return function(k,i){for(var j in Drupal.settings.wysiwyg.plugins[e.format].drupal){if(typeof Drupal.wysiwyg.plugins[j].attach=="function"){k=Drupal.wysiwyg.plugins[j].attach(k,Drupal.settings.wysiwyg.plugins.drupal[j],f.name);k=Drupal.wysiwyg.instances[e.field].prepareContent(k);}}return h.call(this,k,i);};});f.dataProcessor.toDataFormat=CKEDITOR.tools.override(f.dataProcessor.toDataFormat,function(h){return function(k,i){k=h.call(this,k,i);for(var j in Drupal.settings.wysiwyg.plugins[e.format].drupal){if(typeof Drupal.wysiwyg.plugins[j].detach=="function"){k=Drupal.wysiwyg.plugins[j].detach(k,Drupal.settings.wysiwyg.plugins.drupal[j],f.name);
}}return k;};});}},selectionChange:function(f){var g=Drupal.settings.wysiwyg.plugins[e.format];if(g&&g.drupal){a.each(g.drupal,function(h){var j=Drupal.wysiwyg.plugins[h];if(a.isFunction(j.isNode)){var i=f.data.selection.getSelectedElement();var k=j.isNode(i?i.$:null)?CKEDITOR.TRISTATE_ON:CKEDITOR.TRISTATE_OFF;f.editor.getCommand(h).setState(k);}});}},focus:function(f){Drupal.wysiwyg.activeId=f.editor.name;},afterCommandExec:function(f){if(f.data.name!="maximize"){return;}if(f.data.command.state==CKEDITOR.TRISTATE_ON){d.hide();}else{d.show();}}};CKEDITOR.replace(e.field,c);};Drupal.wysiwyg.editor.detach.ckeditor=function(e,f,d){var g=(d=="serialize")?"updateElement":"destroy";if(typeof f!="undefined"){var b=CKEDITOR.instances[f.field];if(b){b[g]();}}else{for(var c in CKEDITOR.instances){if(CKEDITOR.instances.hasOwnProperty(c)){CKEDITOR.instances[c][g]();}}}};Drupal.wysiwyg.editor.instance.ckeditor={addPlugin:function(c,b,d){CKEDITOR.plugins.add(c,{init:function(f){if(b.css){f.on("mode",function(g){if(g.editor.mode=="wysiwyg"){a("head",a("#cke_contents_"+g.editor.name+" iframe").eq(0).contents()).append('<link rel="stylesheet" href="'+b.css+'" type="text/css" >');
}});}if(typeof Drupal.wysiwyg.plugins[c].invoke=="function"){var e={exec:function(h){var i={format:"html",node:null,content:""};var g=h.getSelection();if(g){i.node=g.getSelectedElement();if(i.node){i.node=i.node.$;}if(g.getType()==CKEDITOR.SELECTION_TEXT){if(CKEDITOR.env.ie){i.content=g.getNative().createRange().text;}else{i.content=g.getNative().toString();}}else{if(i.node){i.content=i.node.parentNode.innerHTML;}}}Drupal.wysiwyg.plugins[c].invoke(i,d,h.name);}};f.addCommand(c,e);}f.ui.addButton(c,{label:b.iconTitle,command:c,icon:b.icon});}});},prepareContent:function(b){return b;},insert:function(b){b=this.prepareContent(b);CKEDITOR.instances[this.field].insertHtml(b);},setContent:function(b){CKEDITOR.instances[this.field].setData(b);},getContent:function(){return CKEDITOR.instances[this.field].getData();}};})(jQuery);