(function(a){a.extend(a.tree.plugins,{contextmenu:{object:a("<ul id='jstree-contextmenu' class='tree-context' />"),data:{t:false,a:false,r:false},defaults:{class_name:"hover",items:{create:{label:"Create",icon:"create",visible:function(b,c){if(b.length!=1){return 0;}return c.check("creatable",b);},action:function(b,c){c.create(false,c.get_node(b[0]));},separator_after:true},rename:{label:"Rename",icon:"rename",visible:function(b,c){if(b.length!=1){return false;}return c.check("renameable",b);},action:function(b,c){c.rename(b);}},remove:{label:"Delete",icon:"remove",visible:function(b,c){var d=true;a.each(b,function(){if(c.check("deletable",this)==false){d=false;}return false;});return d;},action:function(b,c){a.each(b,function(){c.remove(this);});}}}},show:function(f,p){var c=a.extend(true,{},a.tree.plugins.contextmenu.defaults,p.settings.plugins.contextmenu);f=a(f);a.tree.plugins.contextmenu.object.empty();var l="";var e=0;for(var g in c.items){if(!c.items.hasOwnProperty(g)){continue;}if(c.items[g]===false){continue;
}var d=1;if(typeof c.items[g].visible=="function"){d=c.items[g].visible.call(null,a.tree.plugins.contextmenu.data.a,p);}if(d==-1){continue;}else{e++;}if(c.items[g].separator_before===true){l+="<li class='separator'><span>&nbsp;</span></li>";}l+='<li><a href="#" rel="'+g+'" class="'+g+" "+(d==0?"disabled":"")+'">';if(c.items[g].icon){l+="<ins "+(c.items[g].icon.indexOf("/")==-1?" class='"+c.items[g].icon+"' ":" style='background-image:url(\""+c.items[g].icon+"\");' ")+">&nbsp;</ins>";}else{l+="<ins>&nbsp;</ins>";}l+="<span>"+c.items[g].label+"</span></a></li>";if(c.items[g].separator_after===true){l+="<li class='separator'><span>&nbsp;</span></li>";}}var j=f.children("a:visible").offset();a.tree.plugins.contextmenu.object.attr("class","tree-context tree-"+p.settings.ui.theme_name.toString()+"-context").html(l);var k=a.tree.plugins.contextmenu.object.height();var o=a.tree.plugins.contextmenu.object.width();var n=j.left;var m=j.top+parseInt(f.children("a:visible").height())+2;var q=a(window).height()+a(window).scrollTop();
var b=a(window).width()+a(window).scrollLeft();if(m+k>q){m=Math.max((q-k-2),0);}if(n+o>b){n=Math.max((b-o-2),0);}a.tree.plugins.contextmenu.object.css({left:(n),top:(m)}).fadeIn("fast");},hide:function(){if(!a.tree.plugins.contextmenu.data.t){return;}var b=a.extend(true,{},a.tree.plugins.contextmenu.defaults,a.tree.plugins.contextmenu.data.t.settings.plugins.contextmenu);if(a.tree.plugins.contextmenu.data.r&&a.tree.plugins.contextmenu.data.a){a.tree.plugins.contextmenu.data.a.children("a, span").removeClass(b.class_name);}a.tree.plugins.contextmenu.data={a:false,r:false,t:false};a.tree.plugins.contextmenu.object.fadeOut("fast");},exec:function(c){if(a.tree.plugins.contextmenu.data.t==false){return;}var b=a.extend(true,{},a.tree.plugins.contextmenu.defaults,a.tree.plugins.contextmenu.data.t.settings.plugins.contextmenu);try{b.items[c].action.apply(null,[a.tree.plugins.contextmenu.data.a,a.tree.plugins.contextmenu.data.t]);}catch(d){}},callbacks:{oninit:function(){if(!a.tree.plugins.contextmenu.css){var b="#jstree-contextmenu { display:none; position:absolute; z-index:2000; list-style-type:none; margin:0; padding:0; left:-2000px; top:-2000px; } .tree-context { margin:20px; padding:0; width:180px; border:1px solid #979797; padding:2px; background:#f5f5f5; list-style-type:none; }.tree-context li { height:22px; margin:0 0 0 27px; padding:0; background:#ffffff; border-left:1px solid #e0e0e0; }.tree-context li a { position:relative; display:block; height:22px; line-height:22px; margin:0 0 0 -28px; text-decoration:none; color:black; padding:0; }.tree-context li a ins { text-decoration:none; float:left; width:16px; height:16px; margin:0 0 0 0; background-color:#f0f0f0; border:1px solid #f0f0f0; border-width:3px 5px 3px 6px; line-height:16px; }.tree-context li a span { display:block; background:#f0f0f0; margin:0 0 0 29px; padding-left:5px; }.tree-context li.separator { background:#f0f0f0; height:2px; line-height:2px; font-size:1px; border:0; margin:0; padding:0; }.tree-context li.separator span { display:block; margin:0px 0 0px 27px; height:1px; border-top:1px solid #e0e0e0; border-left:1px solid #e0e0e0; line-height:1px; font-size:1px; background:white; }.tree-context li a:hover { border:1px solid #d8f0fa; height:20px; line-height:20px; }.tree-context li a:hover span { background:#e7f4f9; margin-left:28px; }.tree-context li a:hover ins { background-color:#e7f4f9; border-color:#e7f4f9; border-width:2px 5px 2px 5px; }.tree-context li a.disabled { color:gray; }.tree-context li a.disabled ins { }.tree-context li a.disabled:hover { border:0; height:22px; line-height:22px; }.tree-context li a.disabled:hover span { background:#f0f0f0; margin-left:29px; }.tree-context li a.disabled:hover ins { border-color:#f0f0f0; background-color:#f0f0f0; border-width:3px 5px 3px 6px; }";
a.tree.plugins.contextmenu.css=this.add_sheet({str:b});}},onrgtclk:function(f,b,d){var c=a.extend(true,{},a.tree.plugins.contextmenu.defaults,b.settings.plugins.contextmenu);f=a(f);if(f.size()==0){return;}a.tree.plugins.contextmenu.data.t=b;if(!f.children("a:eq(0)").hasClass("clicked")){a.tree.plugins.contextmenu.data.a=f;a.tree.plugins.contextmenu.data.r=true;f.children("a").addClass(c.class_name);d.target.blur();}else{a.tree.plugins.contextmenu.data.r=false;a.tree.plugins.contextmenu.data.a=(b.selected_arr&&b.selected_arr.length>1)?b.selected_arr:b.selected;}a.tree.plugins.contextmenu.show(f,b);d.preventDefault();d.stopPropagation();},onchange:function(){a.tree.plugins.contextmenu.hide();},beforedata:function(){a.tree.plugins.contextmenu.hide();},ondestroy:function(){a.tree.plugins.contextmenu.hide();}}}});a(function(){a.tree.plugins.contextmenu.object.hide().appendTo("body");a("#jstree-contextmenu a").live("click",function(b){if(!a(this).hasClass("disabled")){a.tree.plugins.contextmenu.exec.apply(null,[a(this).attr("rel")]);
a.tree.plugins.contextmenu.hide();}b.stopPropagation();b.preventDefault();return false;});a(document).bind("mousedown",function(b){if(a(b.target).parents("#jstree-contextmenu").size()==0){a.tree.plugins.contextmenu.hide();}});});})(jQuery);