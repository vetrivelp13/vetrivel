(function(a){a.extend(a.jgrid,{showModal:function(b){b.w.show();},closeModal:function(b){b.w.hide().attr("aria-hidden","true");if(b.o){b.o.remove();}},hideModal:function(b,f){f=a.extend({jqm:true,gb:""},f||{});if(f.onClose){var c=f.onClose(b);if(typeof c=="boolean"&&!c){return;}}if(a.fn.jqm&&f.jqm===true){a(b).attr("aria-hidden","true").jqmHide();}else{if(f.gb!==""){try{a(".jqgrid-overlay:first",f.gb).hide();}catch(d){}}a(b).hide().attr("aria-hidden","true");}},findPos:function(c){var d=0,b=0;if(c.offsetParent){do{d+=c.offsetLeft;b+=c.offsetTop;}while(c=c.offsetParent);}return[d,b];},createModal:function(i,q,m,b,v,c,h){var k=document.createElement("div"),s,l=this;h=a.extend({},h||{});s=a(m.gbox).attr("dir")=="rtl"?true:false;k.className="ui-widget ui-widget-content ui-corner-all ui-jqdialog";k.id=i.themodal;var u=document.createElement("div");u.className="ui-jqdialog-titlebar ui-widget-header ui-corner-all ui-helper-clearfix";u.id=i.modalhead;a(u).append("<span class='ui-jqdialog-title'>"+m.caption+"</span>");
var n=a("<a href='javascript:void(0)' class='ui-jqdialog-titlebar-close ui-corner-all'></a>").hover(function(){n.addClass("ui-state-hover");},function(){n.removeClass("ui-state-hover");}).append("<span class='ui-icon ui-icon-closethick'></span>");a(u).append(n);if(s){k.dir="rtl";a(".ui-jqdialog-title",u).css("float","right");a(".ui-jqdialog-titlebar-close",u).css("left",0.3+"em");}else{k.dir="ltr";a(".ui-jqdialog-title",u).css("float","left");a(".ui-jqdialog-titlebar-close",u).css("right",0.3+"em");}var w=document.createElement("div");a(w).addClass("ui-jqdialog-content ui-widget-content").attr("id",i.modalcontent);a(w).append(q);k.appendChild(w);a(k).prepend(u);if(c===true){a("body").append(k);}else{if(typeof c=="string"){a(c).append(k);}else{a(k).insertBefore(b);}}a(k).css(h);if(typeof m.jqModal==="undefined"){m.jqModal=true;}var o={};if(a.fn.jqm&&m.jqModal===true){if(m.left===0&&m.top===0&&m.overlay){var d=[];d=this.findPos(v);m.left=d[0]+4;m.top=d[1]+4;}o.top=m.top+"px";o.left=m.left;
}else{if(m.left!==0||m.top!==0){o.left=m.left;o.top=m.top+"px";}}a("a.ui-jqdialog-titlebar-close",u).click(function(r){var p=a("#"+i.themodal).data("onClose")||m.onClose;var x=a("#"+i.themodal).data("gbox")||m.gbox;l.hideModal("#"+i.themodal,{gb:x,jqm:m.jqModal,onClose:p});return false;});if(m.width===0||!m.width){m.width=300;}if(m.height===0||!m.height){m.height=200;}if(!m.zIndex){var f=a(b).parents("*[role=dialog]").filter(":first").css("z-index");if(f){m.zIndex=parseInt(f,10)+1;}else{m.zIndex=950;}}var g=0;if(s&&o.left&&!c){g=a(m.gbox).width()-(!isNaN(m.width)?parseInt(m.width,10):0)-8;o.left=parseInt(o.left,10)+parseInt(g,10);}if(o.left){o.left+="px";}a(k).css(a.extend({width:isNaN(m.width)?"auto":m.width+"px",height:isNaN(m.height)?"auto":m.height+"px",zIndex:m.zIndex,overflow:"hidden"},o)).attr({tabIndex:"-1",role:"dialog","aria-labelledby":i.modalhead,"aria-hidden":"true"});if(typeof m.drag=="undefined"){m.drag=true;}if(typeof m.resize=="undefined"){m.resize=true;}if(m.drag){a(u).css("cursor","move");
if(a.fn.jqDrag){a(k).jqDrag(u);}else{try{a(k).draggable({handle:a("#"+u.id)});}catch(t){}}}if(m.resize){if(a.fn.jqResize){a(k).append("<div class='jqResize ui-resizable-handle ui-resizable-se ui-icon ui-icon-gripsmall-diagonal-se ui-icon-grip-diagonal-se'></div>");a("#"+i.themodal).jqResize(".jqResize",i.scrollelm?"#"+i.scrollelm:false);}else{try{a(k).resizable({handles:"se, sw",alsoResize:i.scrollelm?"#"+i.scrollelm:false});}catch(j){}}}if(m.closeOnEscape===true){a(k).keydown(function(r){if(r.which==27){var p=a("#"+i.themodal).data("onClose")||m.onClose;l.hideModal(this,{gb:m.gbox,jqm:m.jqModal,onClose:p});}});}},viewModal:function(b,d){d=a.extend({toTop:true,overlay:10,modal:false,onShow:this.showModal,onHide:this.closeModal,gbox:"",jqm:true,jqM:true},d||{});if(a.fn.jqm&&d.jqm===true){if(d.jqM){a(b).attr("aria-hidden","false").jqm(d).jqmShow();}else{a(b).attr("aria-hidden","false").jqmShow();}}else{if(d.gbox!==""){a(".jqgrid-overlay:first",d.gbox).show();a(b).data("gbox",d.gbox);}a(b).show().attr("aria-hidden","false");
try{a(":input:visible",b)[0].focus();}catch(c){}}},info_dialog:function(q,k,c,p){var n={width:290,height:"auto",dataheight:"auto",drag:true,resize:false,caption:"<b>"+q+"</b>",left:250,top:170,zIndex:1000,jqModal:true,modal:false,closeOnEscape:true,align:"center",buttonalign:"center",buttons:[]};a.extend(n,p||{});var f=n.jqModal,r=this;if(a.fn.jqm&&!f){f=false;}var h="";if(n.buttons.length>0){for(var g=0;g<n.buttons.length;g++){if(typeof n.buttons[g].id=="undefined"){n.buttons[g].id="info_button_"+g;}h+="<a href='javascript:void(0)' id='"+n.buttons[g].id+"' class='fm-button ui-state-default ui-corner-all'>"+n.buttons[g].text+"</a>";}}var l=isNaN(n.dataheight)?n.dataheight:n.dataheight+"px",o="text-align:"+n.align+";";var b="<div id='info_id'>";b+="<div id='infocnt' style='margin:0px;padding-bottom:1em;width:100%;overflow:auto;position:relative;height:"+l+";"+o+"'>"+k+"</div>";b+=c?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+n.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'><a href='javascript:void(0)' id='closedialog' class='fm-button ui-state-default ui-corner-all'>"+c+"</a>"+h+"</div>":h!==""?"<div class='ui-widget-content ui-helper-clearfix' style='text-align:"+n.buttonalign+";padding-bottom:0.8em;padding-top:0.5em;background-image: none;border-width: 1px 0 0 0;'>"+h+"</div>":"";
b+="</div>";try{if(a("#info_dialog").attr("aria-hidden")=="false"){this.hideModal("#info_dialog",{jqm:f});}a("#info_dialog").remove();}catch(j){}this.createModal({themodal:"info_dialog",modalhead:"info_head",modalcontent:"info_content",scrollelm:"infocnt"},b,n,"","",true);if(h){a.each(n.buttons,function(e){a("#"+this.id,"#info_id").bind("click",function(){n.buttons[e].onClick.call(a("#info_dialog"));return false;});});}a("#closedialog","#info_id").click(function(i){r.hideModal("#info_dialog",{jqm:f});return false;});a(".fm-button","#info_dialog").hover(function(){a(this).addClass("ui-state-hover");},function(){a(this).removeClass("ui-state-hover");});if(a.isFunction(n.beforeOpen)){n.beforeOpen();}this.viewModal("#info_dialog",{onHide:function(e){e.w.hide().remove();if(e.o){e.o.remove();}},modal:n.modal,jqm:f});if(a.isFunction(n.afterOpen)){n.afterOpen();}try{a("#info_dialog").focus();}catch(d){}},createEl:function(f,g,u,k,s){var t="";function l(i,e){if(a.isFunction(e.dataInit)){e.dataInit(i);
}if(e.dataEvents){a.each(e.dataEvents,function(){if(this.data!==undefined){a(i).bind(this.type,this.data,this.fn);}else{a(i).bind(this.type,this.fn);}});}return e;}function q(z,y,i){var e=["dataInit","dataEvents","dataUrl","buildSelect","sopt","searchhidden","defaultValue","attr"];if(typeof(i)!="undefined"&&a.isArray(i)){e=a.extend(e,i);}a.each(y,function(A,B){if(a.inArray(A,e)===-1){a(z).attr(A,B);}});if(!y.hasOwnProperty("id")){a(z).attr("id",a.jgrid.randId());}}switch(f){case"textarea":t=document.createElement("textarea");if(k){if(!g.cols){a(t).css({width:"98%"});}}else{if(!g.cols){g.cols=20;}}if(!g.rows){g.rows=2;}if(u=="&nbsp;"||u=="&#160;"||(u.length==1&&u.charCodeAt(0)==160)){u="";}t.value=u;q(t,g);g=l(t,g);a(t).attr({role:"textbox",multiline:"true"});break;case"checkbox":t=document.createElement("input");t.type="checkbox";if(!g.value){var x=u.toLowerCase();if(x.search(/(false|0|no|off|undefined)/i)<0&&x!==""){t.checked=true;t.defaultChecked=true;t.value=u;}else{t.value="on";}a(t).attr("offval","off");
}else{var n=g.value.split(":");if(u===n[0]){t.checked=true;t.defaultChecked=true;}t.value=n[0];a(t).attr("offval",n[1]);}q(t,g,["value"]);g=l(t,g);a(t).attr("role","checkbox");break;case"select":t=document.createElement("select");t.setAttribute("role","select");var c,h=[];if(g.multiple===true){c=true;t.multiple="multiple";a(t).attr("aria-multiselectable","true");}else{c=false;}if(typeof(g.dataUrl)!="undefined"){a.ajax(a.extend({url:g.dataUrl,type:"GET",dataType:"html",context:{elem:t,options:g,vl:u},success:function(A,z){var C,y=[],e=this.elem,i=this.vl,E=a.extend({},this.options),D=E.multiple===true;if(typeof(E.buildSelect)!="undefined"){var B=E.buildSelect(A);C=a(B).html();}else{C=a(A).html();}if(C){a(e).append(C);q(e,E);E=l(e,E);if(typeof E.size==="undefined"){E.size=D?3:1;}if(D){y=i.split(",");y=a.map(y,function(F){return a.trim(F);});}else{y[0]=a.trim(i);}setTimeout(function(){a("option",e).each(function(F){a(this).attr("role","option");if(a.inArray(a.trim(a(this).text()),y)>-1||a.inArray(a.trim(a(this).val()),y)>-1){this.selected="selected";
}});},0);}}},s||{}));}else{if(g.value){var o;if(c){h=u.split(",");h=a.map(h,function(e){return a.trim(e);});if(typeof g.size==="undefined"){g.size=3;}}else{g.size=1;}if(typeof g.value==="function"){g.value=g.value();}var p,m,j;if(typeof g.value==="string"){p=g.value.split(";");for(o=0;o<p.length;o++){m=p[o].split(":");if(m.length>2){m[1]=a.map(m,function(y,e){if(e>0){return y;}}).join(":");}j=document.createElement("option");j.setAttribute("role","option");j.value=m[0];j.innerHTML=m[1];if(!c&&(a.trim(m[0])==a.trim(u)||a.trim(m[1])==a.trim(u))){j.selected="selected";}if(c&&(a.inArray(a.trim(m[1]),h)>-1||a.inArray(a.trim(m[0]),h)>-1)){j.selected="selected";}t.appendChild(j);}}else{if(typeof g.value==="object"){var d=g.value;for(var w in d){if(d.hasOwnProperty(w)){j=document.createElement("option");j.setAttribute("role","option");j.value=w;j.innerHTML=d[w];if(!c&&(a.trim(w)==a.trim(u)||a.trim(d[w])==a.trim(u))){j.selected="selected";}if(c&&(a.inArray(a.trim(d[w]),h)>-1||a.inArray(a.trim(w),h)>-1)){j.selected="selected";
}t.appendChild(j);}}}}q(t,g,["value"]);g=l(t,g);}}break;case"text":case"password":case"button":var v;if(f=="button"){v="button";}else{v="textbox";}t=document.createElement("input");t.type=f;t.value=u;q(t,g);g=l(t,g);if(f!="button"){if(k){if(!g.size){a(t).css({width:"98%"});}}else{if(!g.size){g.size=20;}}}a(t).attr("role",v);break;case"image":case"file":t=document.createElement("input");t.type=f;q(t,g);g=l(t,g);break;case"custom":t=document.createElement("span");try{if(a.isFunction(g.custom_element)){var b=g.custom_element.call(this,u,g);if(b){b=a(b).addClass("customelement").attr({id:g.id,name:g.name});a(t).empty().append(b);}else{throw"e2";}}else{throw"e1";}}catch(r){if(r=="e1"){this.info_dialog(a.jgrid.errors.errcap,"function 'custom_element' "+a.jgrid.edit.msg.nodefined,a.jgrid.edit.bClose);}if(r=="e2"){this.info_dialog(a.jgrid.errors.errcap,"function 'custom_element' "+a.jgrid.edit.msg.novalue,a.jgrid.edit.bClose);}else{this.info_dialog(a.jgrid.errors.errcap,typeof(r)==="string"?r:r.message,a.jgrid.edit.bClose);
}}break;}return t;},checkDate:function(o,d){var m=function(i){return(((i%4===0)&&(i%100!==0||(i%400===0)))?29:28);},l=function(r){for(var j=1;j<=r;j++){this[j]=31;if(j==4||j==6||j==9||j==11){this[j]=30;}if(j==2){this[j]=29;}}return this;};var f={},q;o=o.toLowerCase();if(o.indexOf("/")!=-1){q="/";}else{if(o.indexOf("-")!=-1){q="-";}else{if(o.indexOf(".")!=-1){q=".";}else{q="/";}}}o=o.split(q);d=d.split(q);if(d.length!=3){return false;}var h=-1,p,g=-1,e=-1;for(var k=0;k<o.length;k++){var c=isNaN(d[k])?0:parseInt(d[k],10);f[o[k]]=c;p=o[k];if(p.indexOf("y")!=-1){h=k;}if(p.indexOf("m")!=-1){e=k;}if(p.indexOf("d")!=-1){g=k;}}if(o[h]=="y"||o[h]=="yyyy"){p=4;}else{if(o[h]=="yy"){p=2;}else{p=-1;}}var b=l(12),n;if(h===-1){return false;}else{n=f[o[h]].toString();if(p==2&&n.length==1){p=1;}if(n.length!=p||(f[o[h]]===0&&d[h]!="00")){return false;}}if(e===-1){return false;}else{n=f[o[e]].toString();if(n.length<1||f[o[e]]<1||f[o[e]]>12){return false;}}if(g===-1){return false;}else{n=f[o[g]].toString();
if(n.length<1||f[o[g]]<1||f[o[g]]>31||(f[o[e]]==2&&f[o[g]]>m(f[o[h]]))||f[o[g]]>b[f[o[e]]]){return false;}}return true;},isEmpty:function(b){if(b.match(/^\s+$/)||b===""){return true;}else{return false;}},checkTime:function(d){var c=/^(\d{1,2}):(\d{2})([ap]m)?$/,b;if(!this.isEmpty(d)){b=d.match(c);if(b){if(b[3]){if(b[1]<1||b[1]>12){return false;}}else{if(b[1]>23){return false;}}if(b[2]>59){return false;}}else{return false;}}return true;},checkValues:function(d,p,l,q,j){var h,k,r,c,m;if(typeof(q)==="undefined"){if(typeof(p)=="string"){for(k=0,m=l.p.colModel.length;k<m;k++){if(l.p.colModel[k].name==p){h=l.p.colModel[k].editrules;p=k;try{r=l.p.colModel[k].formoptions.label;}catch(o){}break;}}}else{if(p>=0){h=l.p.colModel[p].editrules;}}}else{h=q;r=j===undefined?"_":j;}if(h){if(!r){r=l.p.colNames[p];}if(h.required===true){if(this.isEmpty(d)){return[false,r+": "+a.jgrid.edit.msg.required,""];}}var f=h.required===false?false:true;if(h.number===true){if(!(f===false&&this.isEmpty(d))){if(isNaN(d)){return[false,r+": "+a.jgrid.edit.msg.number,""];
}}}if(typeof h.minValue!="undefined"&&!isNaN(h.minValue)){if(parseFloat(d)<parseFloat(h.minValue)){return[false,r+": "+a.jgrid.edit.msg.minValue+" "+h.minValue,""];}}if(typeof h.maxValue!="undefined"&&!isNaN(h.maxValue)){if(parseFloat(d)>parseFloat(h.maxValue)){return[false,r+": "+a.jgrid.edit.msg.maxValue+" "+h.maxValue,""];}}var b;if(h.email===true){if(!(f===false&&this.isEmpty(d))){b=/^((([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+(\.([a-z]|\d|[!#\$%&'\*\+\-\/=\?\^_`{\|}~]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])+)*)|((\x22)((((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(([\x01-\x08\x0b\x0c\x0e-\x1f\x7f]|\x21|[\x23-\x5b]|[\x5d-\x7e]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(\\([\x01-\x09\x0b\x0c\x0d-\x7f]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF]))))*(((\x20|\x09)*(\x0d\x0a))?(\x20|\x09)+)?(\x22)))@((([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|\d|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.)+(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])|(([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])([a-z]|\d|-|\.|_|~|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])*([a-z]|[\u00A0-\uD7FF\uF900-\uFDCF\uFDF0-\uFFEF])))\.?$/i;
if(!b.test(d)){return[false,r+": "+a.jgrid.edit.msg.email,""];}}}if(h.integer===true){if(!(f===false&&this.isEmpty(d))){if(isNaN(d)){return[false,r+": "+a.jgrid.edit.msg.integer,""];}if((d%1!==0)||(d.indexOf(".")!=-1)){return[false,r+": "+a.jgrid.edit.msg.integer,""];}}}if(h.date===true){if(!(f===false&&this.isEmpty(d))){if(l.p.colModel[p].formatoptions&&l.p.colModel[p].formatoptions.newformat){c=l.p.colModel[p].formatoptions.newformat;}else{c=l.p.colModel[p].datefmt||"Y-m-d";}if(!this.checkDate(c,d)){return[false,r+": "+a.jgrid.edit.msg.date+" - "+c,""];}}}if(h.time===true){if(!(f===false&&this.isEmpty(d))){if(!this.checkTime(d)){return[false,r+": "+a.jgrid.edit.msg.date+" - hh:mm (am/pm)",""];}}}if(h.url===true){if(!(f===false&&this.isEmpty(d))){b=/^(((https?)|(ftp)):\/\/([\-\w]+\.)+\w{2,3}(\/[%\-\w]+(\.\w{2,})?)*(([\w\-\.\?\\\/+@&#;`~=%!]*)(\.\w{2,})?)*\/?)/i;if(!b.test(d)){return[false,r+": "+a.jgrid.edit.msg.url,""];}}}if(h.custom===true){if(!(f===false&&this.isEmpty(d))){if(a.isFunction(h.custom_func)){var n=h.custom_func.call(l,d,r);
if(a.isArray(n)){return n;}else{return[false,a.jgrid.edit.msg.customarray,""];}}else{return[false,a.jgrid.edit.msg.customfcheck,""];}}}}return[true,"",""];}});})(jQuery);