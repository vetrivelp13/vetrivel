<?php 
class AdministrationCommerceCountryUpdateBase extends AdministrationCommerceSettingTestHelper
{
	public function updateCommerceCountryTestCase($scope = 'all') {
		$this->openCommerceSettingModal('countrysetting');
		// Based on the scope set the data to test
		if ($scope == 'all') {
			$testCases = $this->testcases['setCountry'];
		} else {
			$testCases = array($this->testcases['setCountry'][$scope]);
		}
		
		foreach($testCases as $test){
			$this->populateCountryResults($test['name']);
			$this->enableDisableCountry($test);
		}
	}
	
	
	public function populateCountryResults($term = '') {
		$prev = $this->content;
			
		$opt = array(
				'_search' => false,
				'page' => 1,
				'rows' => 15,
				'sidx' => '',
				'sord' => 'desc',
				'searhType' => 'countryname'
		);
		$searchTerm = $term;
		$ajaxUrl = 'administration/multiselect-grid/edit/CountrySetting/'.$searchTerm.'/1/commerce/0';
			
		$srcRc = $this->drupalGetAJAX($ajaxUrl,array('query'=>$opt));
		$dom = new DOMDocument();
		$dom->loadHTML($prev);
		$xpath = new DOMXPath($dom);
			
		// Prepare Search Result data
		$src = '';
		$this->cId = null;
		$i=0;
		
		// append a head row
		if (count($srcRc['rows']) > 1) {
			$src = '<tr><th>'.t('Name').'</th><th>'.t('Code').'</th><th> </th></tr>';
			if(!empty($src)){
				$idPath = 'datagrid-container-CountrySetting-1-commerce';
				$Node = $xpath->query('//*[@id="'.$idPath.'"]')->item(0);
				$Node->setAttribute('clear','both');
				$newDom = new DOMDocument();
				$newDom->loadHTML($src);
				$newNode = $dom->importNode($newDom->getElementsByTagName('tr')->item(0), TRUE);
				$Node->appendChild($newNode);
				$this->content = $dom->saveHTML();
			}
		}
		
		foreach($srcRc['rows'] as $row){
			$this->cId[$i]['id']=$row['id'];
			//$this->cId[$i]['id']=$row['id'];
			$src = '<tr><td>'.$row['cell']['name'].'</td><td>'.$row['cell']['code'].'</td><td>'.$row['cell']['ActionList'].'</td></tr>';
			$i++;
		
			
			// Appending Search Details
			if(!empty($src)){
				$idPath = 'datagrid-container-CountrySetting-1-commerce';
				$Node = $xpath->query('//*[@id="'.$idPath.'"]')->item(0);
				$Node->setAttribute('style','width:460px');
				$newDom = new DOMDocument();
				$newDom->loadHTML($src);
				$newNode = $dom->importNode($newDom->getElementsByTagName('tr')->item(0), TRUE);
				$Node->appendChild($newNode);
				$this->content = $dom->saveHTML();
			}
		}
			
		$this->verbose('Request to: ' . $this->getUrl() . '<hr />' . $this->content);
	}
	
	public function enableDisableCountry($country = array()) {
		
		// Publish section
		$publishUrl = '?q=administration/commerce/setting/country/action/'.$country['code'] .'/' . $country['id'];
		$this->drupalPostAJAX(null, $edit,'Save',$publishUrl, array(),array(),'',$post_field);
		$this->assertResponse(200,'Disable/Enable action completed');
		// Ubpublish section
		$this->drupalPostAJAX(null, $edit,'Save',$publishUrl, array(),array(),'',$post_field);
		$this->assertResponse(200,'Disable/Enable action completed');
		
	}

}

class AdministrationCommerceCountryUpdateAll extends AdministrationCommerceCountryUpdateBase
{
	public static function getInfo() {
		return array(
				'name' => 'Administration - CommerceSetting - Country - All Tests',
				'description' => 'Module : exp_sp_administration_commerce_setting',
				'group' => '1704 - Administration - Manage - CommerceSetting - Country',
		);
	}
	
	public function testCommerceCountryUpdateAll() {
		$this->manageAdminCommerceSetting();
		debug('testCommerceCountryUpdateAll called');
		$this->updateCommerceCountryTestCase('all');
	}
}

class AdministrationCommerceCountryUpdateCase1 extends AdministrationCommerceCountryUpdateBase
{
	public static function getInfo() {
		return array(
				'name' => 'Administration - CommerceSetting - Country - US',
				'description' => 'Module : exp_sp_administration_commerce_setting',
				'group' => '1704 - Administration - Manage - CommerceSetting - Country',
		);
	}

	public function testCommerceCountryUpdateCase1() {
		$this->manageAdminCommerceSetting();
		debug('testCommerceCountryUpdateCase1 called');
		$this->updateCommerceCountryTestCase('us');
	}
}

class AdministrationCommerceCountryUpdateCase2 extends AdministrationCommerceCountryUpdateBase
{
	public static function getInfo() {
		return array(
				'name' => 'Administration - CommerceSetting - Country - India',
				'description' => 'Module : exp_sp_administration_commerce_setting',
				'group' => '1704 - Administration - Manage - CommerceSetting - Country',
		);
	}

	public function testCommerceCountryUpdateCase2() {
		$this->manageAdminCommerceSetting();
		debug('testCommerceCountryUpdateCase2 called');
		$this->updateCommerceCountryTestCase('in');
	}
}
?>