(function(a){if(typeof Sarissa=="undefined"){throw"jsTree xml_flat: Sarissa is not included.";}a.extend(a.tree.datastores,{xml_flat:function(){return{get:function(e,c,d){var g="";if(!e||a(e).size()==0){e=c.container.children("ul").children("li");}else{e=a(e);}if(e.size()>1){var h=this;var g="<root>";e.each(function(){d.callback=true;g+=h.get(this,c,d);});g+="</root>";return g;}if(!d){var d={};}if(!d.outer_attrib){d.outer_attrib=["id","rel","class"];}if(!d.inner_attrib){d.inner_attrib=[];}if(!d.callback){g+="<root>";}g+="<item ";g+=' parent_id="'+(e.parents("li:eq(0)").size()?e.parents("li:eq(0)").attr("id"):0)+'" ';for(var b in d.outer_attrib){if(!d.outer_attrib.hasOwnProperty(b)){continue;}var f=(d.outer_attrib[b]=="class")?e.attr(d.outer_attrib[b]).toString().replace(/(^| )last( |$)/ig," ").replace(/(^| )(leaf|closed|open)( |$)/ig," "):e.attr(d.outer_attrib[b]);if(typeof f!="undefined"&&f.toString().replace(" ","").length>0){g+=" "+d.outer_attrib[b]+'="'+f.toString()+'" ';}delete f;}g+=">";
g+="<content>";if(c.settings.languages.length){for(var b in c.settings.languages){if(!c.settings.languages.hasOwnProperty(b)){continue;}g+=this.process_inner(e.children("a."+c.settings.languages[b]),c,d,c.settings.languages[b]);}}else{g+=this.process_inner(e.children("a"),c,d);}g+="</content>";g+="</item>";if(e.children("ul").size()>0){var h=this;d.callback=true;e.children("ul").children("li").each(function(){g+=h.get(this,c,d);});d.callback=false;}if(!d.callback){g+="</root>";}return g;},process_inner:function(e,c,d,h){var g="<name ";if(h){g+=' lang="'+h+'" ';}if(d.inner_attrib.length||e.children("ins").get(0).style.backgroundImage.toString().length||e.children("ins").get(0).className.length){if(e.children("ins").get(0).style.className.length){g+=' icon="'+e.children("ins").get(0).style.className+'" ';}if(e.children("ins").get(0).style.backgroundImage.length){g+=' icon="'+e.children("ins").get(0).style.backgroundImage.replace("url(","").replace(")","")+'" ';}if(d.inner_attrib.length){for(var b in d.inner_attrib){if(!d.inner_attrib.hasOwnProperty(b)){continue;
}var f=e.attr(d.inner_attrib[b]);if(typeof f!="undefined"&&f.toString().replace(" ","").length>0){g+=" "+d.inner_attrib[b]+'="'+f.toString()+'" ';}delete f;}}}g+="><![CDATA["+c.get_text(e,h)+"]]></name>";return g;},parse:function(f,c,e,g){var d=new XSLTProcessor();d.importStylesheet(a.tree.datastores.xml_flat.xsl);var b=a((new XMLSerializer()).serializeToString(d.transformToDocument(f)));if(b.is("ul")){b=b.html();}else{b=b.find("ul").html();}if(g){g.call(null,b);}},load:function(d,b,c,e){if(c["static"]){e.call(null,(new DOMParser()).parseFromString(c["static"],"text/xml"));}else{a.ajaxSetup({xhr:function(){try{if(window.ActiveXObject){return new window.ActiveXObject("Microsoft.XMLHTTP");}}catch(f){}return new window.XMLHttpRequest();}});a.ajax({type:c.method,url:c.url,data:d,dataType:"xml",success:function(f,g){e.call(null,f);},error:function(g,h,f){e.call(null,false);b.error(f+" "+h);}});}}};}});a.tree.datastores.xml_flat.xsl=(new DOMParser()).parseFromString('<?xml version="1.0" encoding="utf-8" ?><xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" ><xsl:output method="html" encoding="utf-8" omit-xml-declaration="yes" standalone="no" indent="no" media-type="text/xml" /><xsl:template match="/"><ul><xsl:for-each select="//item[not(@parent_id) or @parent_id=0]"><xsl:call-template name="nodes"><xsl:with-param name="node" select="." /><xsl:with-param name="is_last" select="number(position() = last())" /></xsl:call-template></xsl:for-each></ul></xsl:template><xsl:template name="nodes"><xsl:param name="node" /><xsl:param name="theme_path" /><xsl:param name="theme_name" /><xsl:param name="is_last" /><xsl:variable name="children" select="count(//item[@parent_id=$node/attribute::id]) &gt; 0" /><li><xsl:attribute name="class"><xsl:if test="$is_last = true()"> last </xsl:if><xsl:choose><xsl:when test="@state = \'open\'"> open </xsl:when><xsl:when test="$children or @hasChildren or @state = \'closed\'"> closed </xsl:when><xsl:otherwise> leaf </xsl:otherwise></xsl:choose><xsl:value-of select="@class" /></xsl:attribute><xsl:for-each select="@*"><xsl:if test="name() != \'parent_id\' and name() != \'hasChildren\' and name() != \'class\' and name() != \'state\'"><xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute></xsl:if></xsl:for-each><xsl:for-each select="content/name"><a href="#"><xsl:attribute name="class"><xsl:value-of select="@lang" /><xsl:value-of select="@class" /></xsl:attribute><xsl:attribute name="style"><xsl:value-of select="@style" /></xsl:attribute><xsl:for-each select="@*"><xsl:if test="name() != \'style\' and name() != \'class\'"><xsl:attribute name="{name()}"><xsl:value-of select="." /></xsl:attribute></xsl:if></xsl:for-each><ins><xsl:if test="string-length(attribute::icon) > 0"><xsl:choose><xsl:when test="not(contains(@icon,\'/\'))"><xsl:attribute name="class"><xsl:value-of select="@icon" /></xsl:attribute></xsl:when><xsl:otherwise><xsl:attribute name="style">background-image:url(<xsl:value-of select="@icon" />);</xsl:attribute></xsl:otherwise></xsl:choose></xsl:if><xsl:text>&#xa0;</xsl:text></ins><xsl:value-of select="." /></a></xsl:for-each><xsl:if test="$children or @hasChildren"><ul><xsl:for-each select="//item[@parent_id=$node/attribute::id]"><xsl:call-template name="nodes"><xsl:with-param name="node" select="." /><xsl:with-param name="is_last" select="number(position() = last())" /></xsl:call-template></xsl:for-each></ul></xsl:if></li></xsl:template></xsl:stylesheet>',"text/xml");
})(jQuery);