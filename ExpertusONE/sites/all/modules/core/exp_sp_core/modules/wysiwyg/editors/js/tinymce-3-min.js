(function(a){Drupal.wysiwyg.editor.init.tinymce=function(b){var d=a("#toolbar",Drupal.overlayChild?window.parent.document:document);tinyMCE.onAddEditor.add(function(g,f){if(f.id=="mce_fullscreen"){d.hide();}});tinyMCE.onRemoveEditor.add(function(g,f){if(f.id=="mce_fullscreen"){d.show();}});for(var e in b){if(Drupal.settings.wysiwyg.plugins[e]){for(var c in Drupal.settings.wysiwyg.plugins[e]["native"]){tinymce.PluginManager.load(c,Drupal.settings.wysiwyg.plugins[e]["native"][c]);}for(var c in Drupal.settings.wysiwyg.plugins[e].drupal){Drupal.wysiwyg.editor.instance.tinymce.addPlugin(c,Drupal.settings.wysiwyg.plugins[e].drupal[c],Drupal.settings.wysiwyg.plugins.drupal[c]);}}}};Drupal.wysiwyg.editor.attach.tinymce=function(c,f,e){var h=new tinymce.Editor(f.field,e);h.onKeyDown.add(function(p,q){if(q.keyCode!=9){return;}var o=a("#"+p.editorId+"_ifr").attr("tabindex");var k=[];a(":input[tabindex]").each(function(){k[a(this).attr("tabindex")]=this;});var m=[];for(var l in k){if(k.hasOwnProperty(l)){m.push(l);
}}m.sort(function(s,n){return parseInt(s)-parseInt(n);});if(q.shiftKey){for(var r=m.length-1;r>=0;r--){if(parseInt(m[r])>=parseInt(o)){continue;}if(!a(k[m[r]]).is(":visible")){continue;}if(a(k[m[r]]).is(":disabled")){continue;}k[m[r]].focus();break;}}else{for(var r=0;r<m.length;r++){if(parseInt(m[r])<=parseInt(o)){continue;}if(!a(k[m[r]]).is(":visible")){continue;}if(a(k[m[r]]).is(":disabled")){continue;}k[m[r]].focus();break;}}tinymce.dom.Event.cancel(q);return;});h.onEvent.add(function(k,l){Drupal.wysiwyg.activeId=k.id;});tinymce.dom.Event.domLoaded=true;h.onPostRender.add(function(k){var l=a('<div class="wysiwygToolbar"></div>');a("#"+k.editorContainer+" table.mceToolbar > tbody > tr > td").each(function(){a("<div></div>").addClass(this.className).append(a(this).children()).appendTo(l);});a("#"+k.editorContainer+" table.mceLayout td.mceToolbar").append(l);a("#"+k.editorContainer+" table.mceToolbar").remove();});$field=a("#"+f.field);$field.val($field.val().replace(/(<.+?\s+class=['"][\w\s]*?)\bmceItem\b([\w\s]*?['"].*?>)/ig,"$1$2"));
h.render();var d=h.editorId;var j=a("#"+d);var g=j.attr("tabindex");var i="#"+d+"_ifr";if(typeof g!=="undefined"&&g!==false&&g!==0){j.removeAttr("tabindex");var b=function(){if(jQuery(i).length<=0){setTimeout(b,200);return;}jQuery(i).attr("tabindex",g);};a(document).ready(function(){setTimeout(b,500);});}};Drupal.wysiwyg.editor.detach.tinymce=function(d,e,c){if(typeof e!="undefined"){var b=tinyMCE.get(e.field);if(b){b.save();if(c!="serialize"){b.remove();}}}else{tinyMCE.triggerSave();if(c!="serialize"){for(var b in tinyMCE.editors){tinyMCE.editors[b].remove();}}}};Drupal.wysiwyg.editor.instance.tinymce={addPlugin:function(c,b,d){if(typeof Drupal.wysiwyg.plugins[c]!="object"){return;}tinymce.create("tinymce.plugins."+c,{init:function(e,f){e.addCommand(c,function(){if(typeof Drupal.wysiwyg.plugins[c].invoke=="function"){var h={format:"html",node:e.selection.getNode(),content:e.selection.getContent()};var g=e.id=="mce_fullscreen"?e.getParam("fullscreen_editor_id"):e.id;Drupal.wysiwyg.plugins[c].invoke(h,d,g);
}});e.addButton(c,{title:b.iconTitle,cmd:c,image:b.icon});e.onInit.add(function(){if(b.css){e.dom.loadCSS(b.css);}});e.onBeforeSetContent.add(function(g,i){var h=(g.id=="mce_fullscreen"?g.getParam("fullscreen_editor_id"):g.id);if(typeof Drupal.wysiwyg.plugins[c].attach=="function"){i.content=Drupal.wysiwyg.plugins[c].attach(i.content,d,h);i.content=Drupal.wysiwyg.editor.instance.tinymce.prepareContent(i.content);}});e.onGetContent.add(function(g,i){var h=(g.id=="mce_fullscreen"?g.getParam("fullscreen_editor_id"):g.id);if(typeof Drupal.wysiwyg.plugins[c].detach=="function"){i.content=Drupal.wysiwyg.plugins[c].detach(i.content,d,h);}});e.onNodeChange.add(function(g,i,h){if(typeof Drupal.wysiwyg.plugins[c].isNode=="function"){i.setActive(c,Drupal.wysiwyg.plugins[c].isNode(h));}});},getInfo:function(){return{longname:b.title};}});tinymce.PluginManager.add(c,tinymce.plugins[c]);},openDialog:function(b,e){var d=this.getInstanceId();var c=tinyMCE.get(d);c.windowManager.open({file:b.url+"/"+d,width:b.width,height:b.height,inline:1},e);
},closeDialog:function(b){var c=tinyMCE.get(this.getInstanceId());c.windowManager.close(b);},prepareContent:function(c){var d={img:{"class":"mceItem"}};var b=a("<div>"+c+"</div>");b.find(".drupal-content").each(function(){var e=a(this);a.each(d,function(g,f){e.find(g).andSelf().each(function(){for(var h in f){if(h=="class"){a(this).addClass(f[h]);}else{a(this).attr(h,f[h]);}}});});});return b.html();},insert:function(b){b=this.prepareContent(b);tinyMCE.execInstanceCommand(this.getInstanceId(),"mceInsertContent",false,b);},setContent:function(b){b=this.prepareContent(b);tinyMCE.execInstanceCommand(this.getInstanceId(),"mceSetContent",false,b);},getContent:function(){return tinyMCE.get(this.getInstanceId()).getContent();},isFullscreen:function(){return tinyMCE.activeEditor.id=="mce_fullscreen"&&tinyMCE.activeEditor.getParam("fullscreen_editor_id")==this.field;},getInstanceId:function(){return this.isFullscreen()?"mce_fullscreen":this.field;}};})(jQuery);