<?php 
class TPDetailsTestCase extends ExpertusWebTestCase {
	private $test_case = array();
	public static function getInfo() {
		return array(
				'name' => 'TP Details',
				'description' => 'TP detail page testing',
				'group' => 'exp_sp_learning_plan_detail',
		);
	}
	public function setUp(){
		parent::setUp();
		$user = new stdClass();
		$user->name =  'admin';
		$user->pass_raw = 'welcome';
		$this->drupalLogin($user);
		 
	
	}
	public function testTPDetails(){
		// Retrive Course Detail's page content
		$this->getTPDetailsPageComponents();
		$this->addTopic();
	}
	private function getTPDetailsPageComponents(){
		// set refer to prevent access denied error
		$this->setHttpReferer('learning/learning-plan-details/47');
	
		// Retrive raw html content from server
		$out = $this->drupalGet('learning/learning-plan-details/47');
	
		// Check basic page load with blocks
		$this->assertRaw('<div class="lnp-details-content" id="learning-plan-details-display-content">','Course Details Content Loaded in Course level', 'exp_sp_learning_plan_detail');
		$this->assertRaw('<div id="forum-topic-list-display" class="forum-topic-list-class">','Listing Discussions in course detail in both Course and level', 'exp_sp_learning_plan_detail');
		//$this->assertRaw('<div class="class-detail-content" id="class_detail_content">','Class Details Content Loaded in Class level', 'exp_sp_coursedetail');
	
	
		// General check error message appear on the site.
		$webError = "Website encountered an unexpected error";
		$this->assertNoText(t($webError),'Web errors not found','exp_sp_learning_plan_detail');
	}
	private function addTopic(){
			
		$path = '//*[@id="qtip_visible_disp_addcomments_1362_forum-comments"]';
	
		$addClassObj = $this->getQtipAttributes($path,'onclick');
		expDebug::dPrint("sdfs fd	".print_r($addClassObj,true,5));
		die();
		//Add qtip popup for class
		$qtipDef = array(
				'tipWidth'=>$addClassObj['wBubble'],
				'tipTop'=>787,
				'tipLeft'=>139.767,
				'tipId'=>$addClassObj['catalogVisibleId'],
				'tipObjectId'=>$addClassObj['courseId'],
				'tipTableWidht'=>373,
				'tipContentId'=>$addClassObj['popupDispId'],
				'tipEntityType'=>'cre_sys_obt_cls',
				'tipClass'=>'qtip-parent',
				'tipPos'=>'bottomRight'
	
		);
	
		$this->addQtipModel($qtipDef);
		 
		$modelContent = $this->content;
	
		$post_field = array(
				'wrapper'=>'forum-topic');
		$out = $this->drupalPostAJAX(null,$edit,'Save','?q=ajax/forum-add-topic/frm-tp-list/edit',array(),array(),'',$post_field);
	
	
		$this->verbose('Request to: ' . $this->getUrl() .
				'<hr />' . $this->content);
	
		$this->assertResponse(200,'Form Rended successfully');
		$webError = "Website encountered an unexpected error";
		$this->assertNoText(t($webError),'Web errors not found','catalog_admin');
	
		$param = array(
				"form_id"=>"add_forum_topic_html",
				"_triggering_element_name"=>"save",
				"_triggering_element_value"=>"Post",
		);
	
		$post_field = array('submit'=>$param,	'wrapper'=>'admin-forum-add-topic-container');
		$out = $this->drupalPostAJAX(null,$test,'Save','?q=system/ajax',array(),array(),'',$post_field);
		$this->verbose('Request to: ' . $this->getUrl() .
				'<hr />' . $this->content);
	
	
		//Check if any error thrown
		$isError = $this->xpath('//div[@class="messages error"]//ul/li');
		$error = '';
		expDebug::dPrint("ERROR STRINGS ".print_r($isError,true),1);
		if(sizeOf($isError) > 0){
			$error = (string) $isError[0];
		}
		$this->assertResponse(200,'Form Repainted successfully');
		$txt = 'updated successfully';
		$this->assertText(t($txt),'Updated changes successfully','catalog_admin');
		$this->assertNoText(t($error),'Error - '.$error,'catalog_admin');
		$webError = "Website encountered an unexpected error";
		$this->assertNoText(t($webError),'Web errors not found','catalog_admin');
	
	
	}
}
	?>
