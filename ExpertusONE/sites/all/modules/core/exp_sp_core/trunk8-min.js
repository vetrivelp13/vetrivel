(function(a){var b,i,j={center:"center",left:"left",right:"right"},g={auto:"auto"};function c(k){this.$newJqueryelement=a(k);this.original_text=a.trim(this.$newJqueryelement.html());this.settings=a.extend({},a.fn.trunk8.defaults);}c.prototype.updateSettings=function(k){this.settings=a.extend(this.settings,k);};function d(l){var k=document.createElement("DIV");k.innerHTML=l;if(typeof k.textContent!="undefined"){return k.textContent;}return k.innerText;}function h(o){if(d(o)===o){return o.split(/\s/g);}var l=[],m=/<([a-z]+)([^<]*)(?:>([\S\s]*?(?!<\1>))<\/\1>|\s+\/>)(['.?!,]*)|((?:[^<>\s])+['.?!,]*\w?|<br\s?\/?>)/ig,p=m.exec(o),k,n;while(p&&k!==m.lastIndex){k=m.lastIndex;if(p[5]){l.push(p[5]);}else{if(p[1]){l.push({tag:p[1],attribs:p[2],content:p[3],after:p[4]});}}p=m.exec(o);}for(n=0;n<l.length;n++){if(typeof l[n]!=="string"&&l[n].content){l[n].content=h(l[n].content);}}return l;}function e(o,n,m){o=o.replace(m,"");var k=function(u,w){var v="",t,p,q,r,s;for(s=0;s<u.length;s++){t=u[s];q=a.trim(o).split(" ").length;
if(a.trim(o).length){if(typeof t==="string"){if(!/<br\s*\/?>/i.test(t)){if(q===1&&a.trim(o).length<=t.length){t=o;if(w==="p"||w==="div"){t+=m;}o="";}else{o=o.replace(t,"");}}v+=a.trim(t)+((s===u.length-1||q<=1)?"":" ");}else{p=k(t.content,t.tag);if(t.after){o=o.replace(t.after,"");}if(p){if(!t.after){t.after=" ";}v+="<"+t.tag+t.attribs+">"+p+"</"+t.tag+">"+t.after;}}}}return v;},l=k(n);if(l.slice(l.length-m.length)!==m){l+=m;}return l;}function f(){var q=this.data("trunk8"),o=q.settings,k=o.width,t=o.side,A=o.fill,x=o.parseHTML,v=(o.line_height>0)?o.line_height:i.getLineHeight(this),y=v*o.lines,u=q.original_text,l=u.length,m="",p,w,n,r,z,s;this.html(u);z=this.text();if(x&&d(u)!==u){s=h(u);u=d(u);l=u.length;}if(k===g.auto){if(this.height()<=y){return;}p=0;w=l-1;while(p<=w){n=p+((w-p)>>1);r=i.eatStr(u,t,l-n,A);this.html(r);if(this.height()>y){w=n-1;}else{p=n+1;m=(m.length>r.length)?m:r;}}this.html("");this.html(m);if(o.tooltip){this.attr("title",z);}}else{if(!isNaN(k)){n=l-k;r=i.eatStr(u,t,n,A);
this.html(r);if(o.tooltip){this.attr("title",u);}}else{a.error('Invalid width "'+k+'".');return;}}o.onTruncate();}b={init:function(k){return this.each(function(){var m=a(this),l=m.data("trunk8");if(!l){m.data("trunk8",(l=new c(this)));}l.updateSettings(k);f.call(m);});},update:function(k){return this.each(function(){var l=a(this);if(k){l.data("trunk8").original_text=k;}f.call(l);});},revert:function(){return this.each(function(){var k=a(this).data("trunk8").original_text;a(this).html(k);});},getSettings:function(){return a(this.get(0)).data("trunk8").settings;}};i={eatStr:function(r,n,m,q){var p=r.length,l=i.eatStr.generateKey.apply(null,arguments),k,o;if(i.eatStr.cache[l]){return i.eatStr.cache[l];}if((typeof r!=="string")||(p===0)){a.error('Invalid source string "'+r+'".');}if((m<0)||(m>p)){a.error('Invalid bite size "'+m+'".');}else{if(m===0){return r;}}if(typeof(q+"")!=="string"){a.error("Fill unable to be converted to a string.");}switch(n){case j.right:return i.eatStr.cache[l]=a.trim(r.substr(0,p-m))+q;
case j.left:return i.eatStr.cache[l]=q+a.trim(r.substr(m));case j.center:k=p>>1;o=m>>1;return i.eatStr.cache[l]=a.trim(i.eatStr(r.substr(0,p-k),j.right,m-o,""))+q+a.trim(i.eatStr(r.substr(p-k),j.left,o,""));default:a.error('Invalid side "'+n+'".');}},getLineHeight:function(m){var o=a(m).css("float");if(o!=="none"){a(m).css("float","none");}var p=a(m).css("position");if(p==="absolute"){a(m).css("position","static");}var k=a(m).html(),l="line-height-test",n;a(m).html("i").wrap('<div id="'+l+'" />');n=a("#"+l).innerHeight();a(m).html(k).css({"float":o,position:p}).unwrap();return n;}};i.eatStr.cache={};i.eatStr.generateKey=function(){return Array.prototype.join.call(arguments,"");};a.fn.trunk8=function(k){if(b[k]){return b[k].apply(this,Array.prototype.slice.call(arguments,1));}else{if(typeof k==="object"||!k){return b.init.apply(this,arguments);}else{a.error("Method "+k+" does not exist on jQuery.trunk8");}}};a.fn.trunk8.defaults={fill:"&hellip;",lines:1,side:j.right,tooltip:true,width:g.auto,parseHTML:false,onTruncate:function(){}};
})(jQuery);