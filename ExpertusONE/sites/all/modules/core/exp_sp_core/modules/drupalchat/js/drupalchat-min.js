(function(a){Drupal.drupalchat=Drupal.drupalchat||{};Drupal.drupalchat.chatboxTimeout=Drupal.drupalchat.chatboxTimeout||{};Drupal.drupalchat.saveAndSendMessage=function(b,f,g){Drupal.drupalchat.msgqueue=Drupal.drupalchat.msgqueue||[];var c;var d=false;for(c in Drupal.drupalchat.msgqueue){if(Drupal.drupalchat.msgqueue[c].uid2==b){d=true;break;}}if(d){Drupal.drupalchat.msgqueue[c].msgsList.push({id:f,msg:g});}else{Drupal.drupalchat.msgqueue.push({uid2:b,msgsList:[{id:f,msg:g}]});}if(Drupal.drupalchat.sending){return;}var e=function(){Drupal.drupalchat.sending=true;var h=Drupal.drupalchat.msgqueue;Drupal.drupalchat.msgqueue=[];var i=Drupal.settings.drupalchat.saveMsgs==2?{}:{drupalchat_msgs:h};a.ajax({type:"POST",url:Drupal.settings.drupalchat.saveMsgUrl,timeout:Drupal.settings.drupalchat.sessionCheckTimeout,data:i,success:function(j){Drupal.drupalchat.sendMessagesNodejs(Drupal.settings.drupalchat.uid,h);if(Drupal.drupalchat.msgqueue.length>0){e();}else{delete Drupal.drupalchat.sending;}},error:function(l){var k;
var j;var p;for(k=0;k<h.length;k++){j=h[k];var o={};o.uid2=j.uid2;o.msgIdList=[];for(p in j.msgsList){o.msgIdList.push(j.msgsList[p].id);}Drupal.drupalchat.processNoReceiverForMsg(o);}h=Drupal.drupalchat.msgqueue;Drupal.drupalchat.msgqueue=[];for(k=0;k<h.length;k++){j=h[k];var o={};o.uid2=j.uid2;o.msgIdList=[];for(p in j.msgsList){o.msgIdList.push(j.msgsList[p].id);}Drupal.drupalchat.processNoReceiverForMsg(o);}expSaveToPersistentStorage();var n=swfobject.getObjectById("drupalchatbeep");if(n&&Drupal.settings.drupalchat.notificationSound==1){try{n.drupalchatbeep();}catch(m){}}delete Drupal.drupalchat.sending;}});};e();};Drupal.drupalchat.checkChatBoxInputKey=function(b,i,h){if(jQuery(i).parent().siblings(".subpanel_title").hasClass("newchatmsg")){jQuery(i).parent().siblings(".subpanel_title").removeClass("newchatmsg");}if(b.keyCode==13&&b.shiftKey==0){var m;m=jQuery(i).val();m=m.replace(/^\s+|\s+$/g,"");m=Drupal.drupalchat.removeStopWords(m);jQuery(i).val("");jQuery(i).focus();if(m!=""){drupalchat.send_current_uid2=h;
drupalchat.send_current_message=m;drupalchat.send_current_message=drupalchat.send_current_message.replace(/\n/g,"{{drupalchat_newline}}");var g=new Date();drupalchat.send_current_message_id="m_"+Drupal.settings.drupalchat.uid+"_"+drupalchat.send_current_uid2+"_"+g.getTime();Drupal.drupalchat.saveAndSendMessage(drupalchat.send_current_uid2,drupalchat.send_current_message_id,drupalchat.send_current_message);m=m.replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\"/g,"&quot;").replace(/\n/g,"<br />");m=Drupal.drupalchat.urlify(m);if(Drupal.settings.drupalchat.enableSimleys==1){m=emotify(m);}if(jQuery("#chatbox_"+h+" .chatboxcontent .chatboxusername .chatmsgusername:last").attr("title")==drupalchat_htmlspecialchars_decode(Drupal.settings.drupalchat.userfullname,"ENT_QUOTES")&&jQuery("#chatbox_"+h+" .chatboxcontent .chatboxusername .chatmsgusername:last").parent().parent().nextAll(".conversation-time, .undelivered-errmsg").length<=0){if(jQuery("#chatbox_"+h+" .chatboxcontent .jspPane").length>0){jQuery("#chatbox_"+h+" .chatboxcontent .jspPane").append("<p><span class='"+drupalchat.send_current_message_id+"'>"+m+"</span></p>");
var l=jQuery("#chatbox_"+h+" .chatboxcontent").jScrollPane({});var e=l.data("jsp");e.scrollToPercentY(100);}else{jQuery("#chatbox_"+h+" .chatboxcontent").append("<p><span class='"+drupalchat.send_current_message_id+"'>"+m+"</span></p>");}}else{var k='<p><span class="chatboxusername"><span class="chatmsgusername" title="'+Drupal.settings.drupalchat.userfullname+'">'+Drupal.settings.drupalchat.me+":&nbsp;</span></span><span class='"+drupalchat.send_current_message_id+"'>"+m+"</span></p>";if(jQuery("#chatbox_"+h+" .chatboxcontent .jspPane").length>0){jQuery("#chatbox_"+h+" .chatboxcontent .jspPane").append(k);var l=jQuery("#chatbox_"+h+" .chatboxcontent").jScrollPane({});var e=l.data("jsp");e.scrollToPercentY(100);}else{jQuery("#chatbox_"+h+" .chatboxcontent").append(k);}}if(Drupal.drupalchat.chatboxTimeout.hasOwnProperty(h)){clearTimeout(Drupal.drupalchat.chatboxTimeout[h].timeout);}delete Drupal.drupalchat.chatboxTimeout[h];Drupal.drupalchat.chatboxTimeout[h]={};Drupal.drupalchat.chatboxTimeout[h].timeout=setTimeout('Drupal.drupalchat.appendConversationTime("'+h+'")',Drupal.settings.drupalchat.showChatTimeAfter);
Drupal.drupalchat.chatboxTimeout[h].msgid=drupalchat.send_current_message_id;var f=new Date().getTime();jQuery("#chatbox_"+h).data("age",f);jQuery("#chatbox_"+h+" .chatboxcontent").scrollTop(jQuery("#chatbox_"+h+" .chatboxcontent")[0].scrollHeight);}expSaveToPersistentStorage();vtip();return false;}var c=i.clientHeight;var j=94;if(j>c){c=Math.max(i.scrollHeight,c);if(j){c=Math.min(j,c);}if(c>i.clientHeight){jQuery(i).css("height",c+8+"px");}}else{jQuery(i).css("overflow","auto");}expSaveToPersistentStorage();return true;};Drupal.drupalchat.changeStatus=function(c,b){if(b==1){jQuery("#"+c+" .subpanel_title > div > div > div > div").removeClass("status-0").addClass("status-1");jQuery("#"+c+" .drupalchat_userOffline").css("display","none");}else{if(b==0){jQuery("#"+c+" .subpanel_title > div > div > div > div").removeClass("status-1").addClass("status-0");jQuery("#"+c+" .drupalchat_userOffline").css("display","block");}}};Drupal.drupalchat.removeStopWords=function(d){if(Drupal.settings.drupalchat.useStopWordList!=1){if(typeof Drupal.drupalchat.stopWords==="undefined"){Drupal.drupalchat.stopWords=Drupal.settings.drupalchat.stopWordList.split(",");
Drupal.drupalchat.stopWords.sort(function(f,e){f=f.toLowerCase();e=e.toLowerCase();return f<e?1:(f>e?-1:0);});}for(var b=0;b<Drupal.drupalchat.stopWords.length;b++){var c=new RegExp(Drupal.drupalchat.stopWords[b],"ig");d=d.replace(c,"");}}return d;};Drupal.drupalchat.urlify=function(c){var b=/(https?:\/\/[^\s]+)/g;return c.replace(b,function(d){return'<a href="'+d+'" target="_blank">'+d+"</a>";});};Drupal.drupalchat.appendConversationTime=function(h){delete Drupal.drupalchat.chatboxTimeout[h];var g=new Date();var c=g.getHours();var e=g.getMinutes();var d=Drupal.settings.drupalchat.chatTimeSuffixAM;if(c==12){d=Drupal.settings.drupalchat.chatTimeSuffixPM;}else{if(c>12){c=c-12;d=Drupal.settings.drupalchat.chatTimeSuffixPM;}}if(c<10){c="0"+c;}if(e<10){e="0"+e;}if(jQuery("#chatbox_"+h+" .chatboxcontent .jspPane").length>0){jQuery("#chatbox_"+h+" .chatboxcontent .jspPane").append('<p class="conversation-time">'+Drupal.settings.drupalchat.chatTimePrefix+"&nbsp;"+c+":"+e+"&nbsp;"+d+"</p>");var b=jQuery("#chatbox_"+h+" .chatboxcontent").jScrollPane({});
var f=b.data("jsp");f.scrollToPercentY(100);}else{jQuery("#chatbox_"+h+" .chatboxcontent").append('<p class="conversation-time">'+Drupal.settings.drupalchat.chatTimePrefix+"&nbsp;"+c+":"+e+"&nbsp;"+d+"</p>");}jQuery("#chatbox_"+h+" .chatboxcontent").scrollTop(jQuery("#chatbox_"+h+" .chatboxcontent")[0].scrollHeight);expSaveToPersistentStorage();};})(jQuery);var drupalchat={username:null,uid:null,send_current_message:null,send_current_message_id:null,last_timestamp:0,send_current_uid2:0,attach_messages_in_queue:0,running:0,online_users:0,smilies:{"O:-)":["25.gif","angel","O:)"],":))":["21.gif","laughing",":-))"],":)":["1.gif","happy",":-)"],";)":["3.gif","winking",";-)"],":D":["4.gif","big grin",":-D"],";;)":["5.gif","batting eyelashes"],":-/":["7.gif","confused",":/"],":x":["8.gif","love struck",":X"],":P":["10.gif","tongue",":p",":-p",":-P"],"=((":["12.gif","broken heart"],":-O":["13.gif","surprise",":O"],"X(":["14.gif","angry"],"B-)":["16.gif","cool"],":-S":["17.gif","worried"],"#:-S":["18.gif","whew!","#:-s"],":((":["20.gif","crying",":-((",":'(",":'-("],":(":["2.gif","sad",":-("],":|":["22.gif","straight face",":-|"],"/:)":["23.gif","raised eyebrow","/:-)"],"=))":["24.gif","rolling on the floor"],":-B":["26.gif","nerd"],"=;":["27.gif","talk to the hand"],"I-)":["28.gif","sleepy"],"8-|":["29.gif","rolling eyes"],"L-)":["30.gif","loser"],":-&":["31.gif","sick"],":-$":["32.gif","don't tell anyone"],"[-(":["33.gif","not talking"],":O)":["34.gif","clown"],"8-}":["35.gif","silly"],"(:|":["37.gif","yawn"],":-?":["39.gif","thinking"],"#-o":["40.gif","d'oh","#-O"],":-SS":["42.gif","nailbiting",":-ss"],":-w":["45.gif","waiting",":-W"],":)]":["100.gif","on the phone"],":-c":["101.gif","call me"],":-h":["103.gif","wave"],":-t":["104.gif","time out"],":!!":["110.gif","hurry up!"],":-q":["112.gif","thumbs down"],":-bd":["113.gif","thumbs up"],"^#(^":["114.gif","it wasn't me"]}};
jQuery(document).ready(function(){if(drupalchat_getCookie("DRUPALCHAT_NEWLOGIN")!=1){if(jQuery.drupalchatjStorage.get("username")!=null){drupalchat.username=jQuery.drupalchatjStorage.get("username");}if(jQuery.drupalchatjStorage.get("uid")!=null){drupalchat.uid=jQuery.drupalchatjStorage.get("uid");}if(jQuery.drupalchatjStorage.get("send_current_message")!=null){drupalchat.send_current_message=jQuery.drupalchatjStorage.get("send_current_message");}if(jQuery.drupalchatjStorage.get("last_timestamp")!=null){drupalchat.last_timestamp=jQuery.drupalchatjStorage.get("last_timestamp");}if(jQuery.drupalchatjStorage.get("send_current_uid2")!=null){drupalchat.send_current_uid2=jQuery.drupalchatjStorage.get("send_current_uid2");}if(jQuery.drupalchatjStorage.get("attach_messages_in_queue")!=null){drupalchat.attach_messages_in_queue=jQuery.drupalchatjStorage.get("attach_messages_in_queue");}if(jQuery.drupalchatjStorage.get("running")!=null){drupalchat.running=jQuery.drupalchatjStorage.get("running");}if(jQuery.drupalchatjStorage.get("drupalchat")!=null){if(jQuery.drupalchatjStorage.get("drupalchat").length>4){var a=jQuery("#chatpanel .icon").attr("src");
jQuery("#drupalchat").html(jQuery.drupalchatjStorage.get("drupalchat"));jQuery("#chatpanel .subpanel ul").empty();jQuery("#chatpanel .online-count").html(0);if(Drupal.settings.drupalchat.signInState==2){$("#chatpanel .subpanel .item-list").replaceWith(Drupal.settings.drupalchat.noUsers);}else{$("#chatpanel .subpanel .item-list").replaceWith(Drupal.settings.drupalchat.signedOut);}$("#drupalchat .chatbox .subpanel_title > div > div > div > div").removeClass("status-1").addClass("status-0");jQuery("#chatpanel .icon").attr("src",a);jQuery("#chatpanel .chattitle").html(Drupal.settings.drupalchat.chatTitle);$("span.chatMinMaxBtn").each(function(){if($(this).hasClass("titlemin")){$(this).attr("title",Drupal.settings.drupalchat.chatMinimizeText);}else{$(this).attr("title",Drupal.settings.drupalchat.chatMaximizeText);}});if(Drupal.settings.drupalchat.signInState==2){jQuery("#chatpanel .change-signin-state").html(Drupal.settings.drupalchat.signOutOfChat);jQuery("#chatpanel .change-signin-state").attr("title",Drupal.settings.drupalchat.signOutOfChat);
jQuery("#chatpanel .signin-signout-arrow").attr("title",Drupal.settings.drupalchat.signOutOfChat);}else{jQuery("#chatpanel .change-signin-state").html(Drupal.settings.drupalchat.signIntoChat);jQuery("#chatpanel .change-signin-state").attr("title",Drupal.settings.drupalchat.signIntoChat);jQuery("#chatpanel .signin-signout-arrow").attr("title",Drupal.settings.drupalchat.signIntoChat);}}}if((drupalchat.send_current_uid2!=null)&&(jQuery("#chatbox_"+drupalchat.send_current_uid2+" .chatboxcontent").length>0)){jQuery("#chatbox_"+drupalchat.send_current_uid2+" .chatboxcontent").scrollTop(jQuery("#chatbox_"+drupalchat.send_current_uid2+" .chatboxcontent")[0].scrollHeight);}}else{drupalchat_setCookie("DRUPALCHAT_NEWLOGIN",2,0);}if(Drupal.settings.drupalchat.enableSimleys==1){emotify.emoticons(Drupal.settings.drupalchat.smileyURL,true,drupalchat.smilies);}jQuery.fn.adjustPanel=function(){jQuery(this).find("ul, .subpanel").css({height:"auto"});var f=jQuery(window).height();var e=jQuery(this).find(".subpanel").height();
var c=f-100;var d=c-25;if(e>c){jQuery(this).find(".subpanel").css({height:c});jQuery(this).find("ul").css({height:(c-48)});}else{jQuery(this).find("ul").css({height:"auto"});}jQuery(".chatbox").css("height",f);limitChatboxesDisplayByViewportWidth();};jQuery("#chatpanel").adjustPanel();jQuery(window).resize(function(){jQuery("#chatpanel").adjustPanel();expSaveToPersistentStorage();});var b='<div style="width: 0px; height: 0px; overflow: hidden;"><object id="drupalchatbeep" classid="clsid:D27CDB6E-AE6D-11cf-96B8-444553540000" width="1" height="1"><param name="movie" value="'+Drupal.settings.drupalchat.sound+'"/><!--[if !IE]>--><object type="application/x-shockwave-flash" data="'+Drupal.settings.drupalchat.sound+'" width="1" height="1"></object><!--<![endif]--></object></div>';jQuery(b).appendTo(jQuery("body"));swfobject.registerObject("drupalchatbeep","9");jQuery("#drupalchat .subpanel .chatboxcontent").each(function(){jQuery(this).scrollTop(jQuery(this)[0].scrollHeight);});jQuery("#mainpanel li div.subpanel_toggle").live("click",function(){this.currTheme=Drupal.settings.ajaxPageState.theme;
if(jQuery(this).parent("#chatpanel").children(".subpanel").is(":visible")){jQuery(this).parent("#chatpanel").children(".subpanel").hide();if(this.currTheme=="expertusoneV2"){jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusoneV2/expertusone-internals/images/ExpertusIcons_v2.png") no-repeat -203px -390px');}else{jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusone/expertusone-internals/images/ExpertusIcons.png") no-repeat -121px -1571px');}jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").attr("title",Drupal.settings.drupalchat.chatMaximizeText);jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").addClass("titlemin");jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").removeClass("titlemin");}else{jQuery(this).parent("#chatpanel").children(".subpanel").show();if(this.currTheme=="expertusoneV2"){jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusoneV2/expertusone-internals/images/ExpertusIcons_v2.png") no-repeat -203px -386px');
}else{jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusone/expertusone-internals/images/ExpertusIcons.png") no-repeat -121px -1566px');}jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").attr("title",Drupal.settings.drupalchat.chatMinimizeText);jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").addClass("titlemin");jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").removeClass("titlemin");if((jQuery(".subpanel div.item-list ul li").size())>5){if(!(jQuery(".subpanel div.item-list").hasClass("jspScrollable"))){jQuery("#chatpanel .subpanel .item-list").css({height:"200"});jQuery("#chatpanel .subpanel").css({height:"200"});var c="";jQuery("#chatpanel .subpanel .item-list").bind("jsp-initialised",function(e,d){if(jQuery("#chatpanel").find(".jspDrag").height()<30){jQuery("#chatpanel").find(".jspDrag").css("height","30px");}}).bind("jsp-scroll-y",function(f,e,h,d){var g=Math.round(e);if(g==0){c=10;return false;}if(d!=true){if(g>c){jQuery("#chatpanel").find(".jspPane").css("top",-g-10-parseInt(Drupal.settings.drupalchat.onlineUsersListScrollingSetting)+"px");
c=g+10+parseInt(Drupal.settings.drupalchat.onlineUsersListScrollingSetting);return false;}if(g<c){jQuery("#chatpanel").find(".jspPane").css("top",-g+10+parseInt(Drupal.settings.drupalchat.onlineUsersListScrollingSetting)+"px");c=g-10-parseInt(Drupal.settings.drupalchat.onlineUsersListScrollingSetting);return false;}}}).jScrollPane({showArrows:true,autoReinitialise:true});this.currTheme=Drupal.settings.ajaxPageState.theme;if(this.currTheme=="expertusoneV2"){jQuery("#drupalchat .subpanel .item-list ul li a").css({width:"186"});}else{jQuery("#drupalchat .subpanel .item-list ul li a").css({width:"175"});}}}}expSaveToPersistentStorage();return false;});jQuery(".signin-signout-arrow").live("click",function(c){c.stopPropagation();if($("#chatpanel .subpanel").is(":visible")){jQuery(".signin-signout-container").toggle();}else{jQuery("#chatpanel .subpanel").show();if(Drupal.settings.ajaxPageState.theme=="expertusoneV2"){jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusoneV2/expertusone-internals/images/ExpertusIcons_v2.png") no-repeat -203px -384px');
}else{jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusone/expertusone-internals/images/ExpertusIcons.png") no-repeat -121px -1566px');}jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").attr("title",Drupal.settings.drupalchat.chatMinimizeText);jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").addClass("titlemin");jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").removeClass("titlemin");jQuery(".signin-signout-container").toggle();}});jQuery(".signin-signout-container .qtip-close-button").live("click",function(c){c.stopPropagation();jQuery(".signin-signout-container").hide();});$("body").bind("click",function(c){if(c.target.id!="signin-signout-arrow"){$(".signin-signout-container").css("display","none");}});jQuery("#mainpanel .change-signin-state").live("click",function(c){if(!Drupal.Nodejs.socket||Drupal.Nodejs.socket.socket.connected===false){alert(Drupal.settings.drupalchat.noChatServer);c.stopPropagation();
return;}$.ajax({type:"GET",url:Drupal.settings.drupalchat.changeSignInStateUrl+"/"+Drupal.settings.drupalchat.signInState,timeout:30000,data:{},dataType:"json",success:function(d){},error:function(d){}});c.stopPropagation();});$("body").bind("click",function(c){if(c.target.id!="exp-chat-options"){$("#exp-chat-options").css("display","none");}});jQuery(".subpanel .subpanel_title").live("click",function(){if(jQuery(this).hasClass("newchatmsg")){jQuery(this).removeClass("newchatmsg");}if(jQuery(this).siblings(".chatBoxContentWrapper").is(":visible")){jQuery(this).siblings(".chatBoxContentWrapper").hide();jQuery(this).siblings(".chatboxinput").hide();var d=jQuery(this).closest("li").attr("id");if(Drupal.settings.ajaxPageState.theme=="expertusoneV2"){jQuery("#"+d+" .subpanel .subpanel_title .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusoneV2/expertusone-internals/images/ExpertusIcons_v2.png") no-repeat -203px -390px');}else{jQuery("#"+d+" .subpanel .subpanel_title .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusone/expertusone-internals/images/ExpertusIcons.png") no-repeat -121px -1571px');
}jQuery("#"+d+" .subpanel .subpanel_title .chatMinMaxBtn").attr("title",Drupal.settings.drupalchat.chatMaximizeText);jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").addClass("titlemin");jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").removeClass("titlemin");}else{jQuery(this).siblings(".chatBoxContentWrapper").show();jQuery(this).siblings(".chatboxinput").show();var d=jQuery(this).closest("li").attr("id");if(Drupal.settings.ajaxPageState.theme=="expertusoneV2"){jQuery("#"+d+" .subpanel .subpanel_title .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusoneV2/expertusone-internals/images/ExpertusIcons_v2.png") no-repeat -203px -384px');}else{jQuery("#"+d+" .subpanel .subpanel_title .chatMinMaxBtn").css("background",'url("/sites/all/themes/core/expertusone/expertusone-internals/images/ExpertusIcons.png") no-repeat -121px -1566px');}jQuery("#"+d+" .subpanel .subpanel_title .chatMinMaxBtn").attr("title",Drupal.settings.drupalchat.chatMinimizeText);jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").addClass("titlemin");
jQuery("#mainpanel .subpanel_title_text .chatMinMaxBtn").removeClass("titlemin");var c=jQuery(this).siblings(".chatboxinput").children(".chatboxtextarea");if(c.length>0){c[0].focus();jQuery(this).siblings(".chatBoxContentWrapper").scrollTop(jQuery(this).siblings(".chatBoxContentWrapper")[0].scrollHeight);}}expSaveToPersistentStorage();});jQuery("#chatpanel .subpanel li:not(.link) a").live("click",function(){chatWith(jQuery(this).attr("class"),jQuery(this).text());expSaveToPersistentStorage();return false;});jQuery(".chatbox .subpanel_title span:not(.min)").live("click",function(c){closeChatBox(jQuery(this).attr("class"),c);expSaveToPersistentStorage();});jQuery("#drupalchat .subpanel .chatboxcontent").live("mouseenter",function(){jQuery(this).jScrollPane();});jQuery("#drupalchat .subpanel .chatboxcontent").live("mouseleave",function(){jQuery(this).css("overflow-y","hidden");var c=jQuery(this).jScrollPane({});var d=c.data("jsp");d.destroy();});jQuery(".chatbox .chatboxcontent").click(function(){if(jQuery(this).siblings(".chatboxinput").children(".chatboxtextarea").is(":visible")){jQuery(this).siblings(".chatboxinput").children(".chatboxtextarea").focus();
}expSaveToPersistentStorage();});expSaveToPersistentStorage();});function chatWith(b,a){createChatBox(b,a);jQuery("#chatbox_"+b+" .subpanel_title").click();jQuery("#chatbox_"+b+" .chatboxtextarea").focus();}function createChatBox(f,e,a){var d=new Date().getTime();if(jQuery("#chatbox_"+f).length>0){jQuery("#chatbox_"+f).data("age",d);if(jQuery("#chatbox_"+f).css("display")=="none"){jQuery("#chatbox_"+f).css("display","block").removeClass("autohidden");limitChatboxesDisplayByViewportWidth();}return;}if(e.length>=20){restrictTitle=e.substring(0,20);}else{restrictTitle=e;}this.currTheme=Drupal.settings.ajaxPageState.theme;if(this.currTheme=="expertusoneV2"){var b='<textarea class="chatboxtextarea" onkeydown="return Drupal.drupalchat.checkChatBoxInputKey(event, this, \''+f+"');\"></textarea>";}else{var b='<textarea class="chatboxtextarea" onkeydown="return Drupal.drupalchat.checkChatBoxInputKey(event, this, \''+f+"');\"></textarea>";}var c='<a href="#" class="chatboxhead"><div class="block-title-left"><div class="block-title-right"><div class="block-title-middle"><span class="subpanel_title_text">'+e+'</span></div></div></div></a><div class="subpanel"><div class="subpanel_title"><div class="block-title-left"><div class="block-title-right"><div class="block-title-middle"><span class="'+f+'" id="chatCloseBtn" title="'+Drupal.settings.drupalchat.chatClose+'"></span><span title = "'+Drupal.settings.drupalchat.chatMinimizeText+'" class="min chatMinMaxBtn titlemin"></span><div class="status-1"></div>'+restrictTitle+'</div></div></div></div><div class="chatBoxContentWrapper" style="display:none;"><div class="chatboxcontent"></div></div><div class="drupalchat_userOffline">'+e+' is currently offline.</div><div class="chatboxinput" style="display:none;">'+b+"</div></div>";
jQuery("<li />").attr("id","chatbox_"+f).addClass("chatbox").attr("data-age",d).html(c).prependTo(jQuery("#mainpanel"));jQuery(".chatbox").css("height",$(window).height());if(a==1){jQuery("#chatbox_"+f+" .subpanel_title").addClass("newchatmsg");}jQuery("#chatbox_"+f).show();limitChatboxesDisplayByViewportWidth();}function limitChatboxesDisplayByViewportWidth(){var c=jQuery(window).width();var j=203;var m=c-j;var l=225;var b=Math.floor(m/l);b=b<1?1:b;var a={};var n=[];var k={};var o=[];jQuery(".chatbox:visible").each(function(){var p=$(this).attr("id");var i=$(this).data("age");a[i]=p;n.push(i);});var h=n.length;jQuery(".chatbox.autohidden").each(function(){var p=$(this).attr("id");var i=$(this).data("age");k[i]=p;o.push(i);});var f=o.length;if(h<b){o.sort(function(p,i){return i-p;});var g=b-h;for(var d=0;d<g;d++){jQuery("#"+k[o[d]]).removeClass("autohidden").show();jQuery("#"+k[o[d]]+" .subpanel_title").click();}}else{if(h>b){n.sort(function(p,i){return p-i;});var e=h-b;for(var d=0;d<e;
d++){jQuery("#"+a[n[d]]).addClass("autohidden").hide();jQuery("#"+a[n[d]]).find(".chatBoxContentWrapper").hide();jQuery("#"+a[n[d]]).find(".chatboxinput").hide();}}}}function closeChatBox(b,a){jQuery("#chatbox_"+b).css("display","none");jQuery("#chatbox_"+b).find(".chatBoxContentWrapper").hide();jQuery("#chatbox_"+b).find(".chatboxinput").hide();limitChatboxesDisplayByViewportWidth();a.stopPropagation();}function expSaveToPersistentStorage(){jQuery.drupalchatjStorage.set("username",drupalchat.username);jQuery.drupalchatjStorage.set("uid",drupalchat.uid);jQuery.drupalchatjStorage.set("send_current_message",drupalchat.send_current_message);jQuery.drupalchatjStorage.set("last_timestamp",drupalchat.last_timestamp);jQuery.drupalchatjStorage.set("send_current_uid2",drupalchat.send_current_uid2);jQuery.drupalchatjStorage.set("attach_messages_in_queue",drupalchat.attach_messages_in_queue);jQuery.drupalchatjStorage.set("running",drupalchat.running);var a=jQuery("<div>"+jQuery("#drupalchat").html()+"</div>");
jQuery(".chatbox .subpanel_title",a).removeClass("newchatmsg");jQuery("#drupalchat-chat-options",a).hide();jQuery("#chatpanel .subpanel ul",a).empty();jQuery("#chatpanel .online-count",a).html(0);if(Drupal.settings.drupalchat.signInState==2){$("#chatpanel .subpanel .item-list",a).replaceWith(Drupal.settings.drupalchat.noUsers);}else{$("#chatpanel .subpanel .item-list",a).replaceWith(Drupal.settings.drupalchat.signedOut);}jQuery(".subpanel .chatboxcontent .jspPane",a).each(function(){var b=$(this).html();$(this).parent().parent().parent().html('<div class="chatboxcontent">'+b+"</div>");});jQuery.drupalchatjStorage.set("drupalchat",a.html());}function drupalchat_getCookie(b){var c,a,e,d=document.cookie.split(";");for(c=0;c<d.length;c++){a=d[c].substr(0,d[c].indexOf("="));e=d[c].substr(d[c].indexOf("=")+1);a=a.replace(/^\s+|\s+$/g,"");if(a==b){return unescape(e);}}}function drupalchat_setCookie(a,d,b){var e=new Date();e.setDate(e.getDate()+b);var c=escape(d)+((b==null)?"":"; expires="+e.toUTCString());
document.cookie=a+"="+c;}function drupalchat_htmlspecialchars_decode(b,f){var d=0,c=0,e=false;if(typeof f==="undefined"){f=2;}b=b.toString().replace(/&lt;/g,"<").replace(/&gt;/g,">");var a={ENT_NOQUOTES:0,ENT_HTML_QUOTE_SINGLE:1,ENT_HTML_QUOTE_DOUBLE:2,ENT_COMPAT:2,ENT_QUOTES:3,ENT_IGNORE:4};if(f===0){e=true;}if(typeof f!=="number"){f=[].concat(f);for(c=0;c<f.length;c++){if(a[f[c]]===0){e=true;}else{if(a[f[c]]){d=d|a[f[c]];}}}f=d;}if(f&a.ENT_HTML_QUOTE_SINGLE){b=b.replace(/&#0*39;/g,"'");}if(!e){b=b.replace(/&quot;/g,'"');}b=b.replace(/&amp;/g,"&");return b;}