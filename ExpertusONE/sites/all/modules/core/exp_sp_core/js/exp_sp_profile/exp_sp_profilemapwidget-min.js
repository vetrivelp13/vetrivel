registernamespace("EXPERTUS.SMARTPORTAL.ProfileMapManager");EXPERTUS.SMARTPORTAL.ProfileMapManager=function(){try{this.generateProfileSubTreeReq=function(f){try{var c=new Object();c.query=new SOAPObject("getProfileSubTree").attr("xsi:type","null");c.query.appendChild(new SOAPObject("type").attr("xsi:type","null").val(f.type));c.query.appendChild(new SOAPObject("id1").attr("xsi:type","null").val(f.id1));c.query.appendChild(new SOAPObject("parent_id").attr("xsi:type","null").val(f.parent_id));c.query.appendChild(new SOAPObject("map_attr").attr("xsi:type","null").val(f.mapAttribute));var b=new SOAPRequest("getProfileSubTree",c);b="<?xml version='1.0' encoding='UTF-8'?>"+b;b=b.toString();return b;}catch(d){}};this.generateSaveProfileMapReq=function(l,o,d){try{var f=new Object();f.query=new SOAPObject("saveProfileMapping").attr("xsi:type","null");f.query.appendChild(new SOAPObject("id1").attr("xsi:type","null").val(d.id1));f.query.appendChild(new SOAPObject("parent_id").attr("xsi:type","null").val(d.parent_id));
for(var h=0;h<l.length;h++){var c=f.query.appendChild(new SOAPObject("rowset").attr("xsi:type","null"));var p=c.appendChild(new SOAPObject("tags").attr("xsi:type","null"));for(var g=0;g<l[h].length;g++){p.appendChild(new SOAPObject("mapping").attr("xsi:type","null").val(l[h][g]));}var n=c.appendChild(new SOAPObject("attr").attr("xsi:type","null"));n.appendChild(new SOAPObject("type").attr("xsi:type","null").val(d.mapAttribute));n.appendChild(new SOAPObject("value").attr("xsi:type","null").val(o[h]));}var b=new SOAPRequest("saveProfileMapping",f);b="<?xml version='1.0' encoding='UTF-8'?>"+b;b=b.toString();return b;}catch(m){}};}catch(a){}};$.extend(EXPERTUS.SMARTPORTAL.ProfileMapManager.prototype,EXPERTUS.SMARTPORTAL.AbstractManager);registernamespace("EXPERTUS.SMARTPORTAL.ProfileMapWidget");EXPERTUS.SMARTPORTAL.ProfileMapWidget=function(){try{this.divId;this.mode;this.widgetGlobalName="EXPERTUS.SMARTPORTAL.ProfileMapWidget";this.mapAttribute;this.parentObj;this.op;this.delRow;this.treeData;
this.multirow;this.id1;this.parent_id;this.renderResults=function(){var b=this;switch(this.mode){case"showtree":this.renderTree();break;case"savemapping":break;}};this.renderTree=function(){var c="tbl_prof_tree";var b='<table class="tbl_prof_map" cellspacing="0" width="100%" id="'+c+'"><tr><th colspan="2" style="text-align:right;padding:10px 25px 0 0">';if(this.multirow=="true"){b+='<a href="#" onclick="EXPERTUS.SMARTPORTAL.ProfileMapWidget.renderTreeRow(\''+c+"');\">"+SMARTPORTAL.t("Add Row")+'</a> | <a href="#" onclick="'+this.widgetGlobalName+'.removeRow();">'+SMARTPORTAL.t("Remove")+"</a> |";}b+='<a href="#" onclick="EXPERTUS.SMARTPORTAL.ProfileMapWidget.saveMapping();">'+SMARTPORTAL.t("Save")+"</a></th></tr></table>";$("#"+this.divId).html(b);$("#"+this.divId).append("<div></div>");var d=this;this.treeData=this.responseText;if($(this.treeData).find("selNodes").length){$(this.treeData).find("row").each(function(){d.renderTreeRow(c,$(this));});}else{this.renderTreeRow(c,null);}};this.validateChecked=function(b){var c=$.tree.plugins.checkbox.get_checked(b);
if(c.length==0){return false;}else{return true;}};this.renderTreeRow=function(c,g){var e=this;var d;if($("#"+c).find("tr:last").attr("rowno")==undefined){d=1;}else{d=$("#"+c).find("tr:last").attr("rowno")+1;}if($(this.treeData).find("mapAttr").length){$("#"+c+" tr:last").after('<tr id="prRow'+d+'" class="profmap_row" rowno="'+d+'"><td id="prCell'+d+'"> </td><td width="140" id="attrCell'+d+'"></td></tr>').slideDown(300);}else{$("#"+c+" tr:last").after('<tr id="prRow'+d+'" class="profmap_row" rowno="'+d+'"><td id="prCell'+d+'"></tr>').slideDown(300);}$("#prRow"+d).click(function(){$("#"+e.oldRow).removeClass("profmap_row_clicked");$(this).addClass("profmap_row_clicked");e.oldRow=$(this).attr("id");e.delRow=$(this).attr("id");});var b=0;$(this.treeData).find("profile").each(function(){$("#prCell"+d).append("<div id='treeDiv"+d+b+"' style='float:left;width:auto;padding:10px;'></div>");var l=$(this).find("item:eq(0)").attr("qulfy");var h="";$(g).find("nodes").each(function(){if($(this).attr("qulfy")==l){h=$(this).text();
}});var j=new Array();if(h.length){j=h.split(",");}$("#treeDiv"+d+b).attr("qulfy",l);$("#treeDiv"+d+b).tree({callback:{check_move:function(p,m,o,n,q){return false;},beforeclose:function(n,m){return false;}},selected:j,data:{type:"xml_flat",opts:{"static":$(this).html()}},type:{"default":{draggable:false}},ui:{theme_name:"checkbox",animation:200},plugins:{checkbox:{}}});var i=$.tree.reference("#treeDiv"+d+b);i.open_all();$("#treeDiv"+d+b).find("a:eq(0)").css({"font-weight":"bold",color:"#4F4F7A"});b++;});if($(this.treeData).find("mapAttr").length){var f='<select id="selAttr'+d+'">';$(this.treeData).find("mapAttr").each(function(){f+='<option value="'+$(this).find("id").text()+'">'+$(this).find("name").text()+"</option>";});f+="</select>";$("#attrCell"+d).append(f);$("#selAttr"+d).val($(g).find("type").text());}return false;};this.removeRow=function(){if($("#"+this.delRow).length){$("#"+this.delRow).remove();}else{alert(SMARTPORTAL.t("Please select a row"));}};this.saveMapping=function(){var n="";
var g=1;var o=new Array();var c=new Array();var j=this;var p=0;var l=false;var q;$(".profmap_row").each(function(){var m=0;var b=new Array();var i=0;var r=$(this).attr("rowno");$(this).find(".tree-checkbox").each(function(){b[i]=new Array();var s=$.tree.reference("#treeDiv"+r+m);if(!j.validateChecked(s)){alert(SMARTPORTAL.t("Please check atleast a profile"));s.focus();l=true;return false;}var v=$("#treeDiv"+r+m).attr("qulfy");var t=$.tree.plugins.checkbox.get_checked(s);k=0;for(var u=0;u<t.length;u++){if(s.children(t[u]).length==0){b[i][k]=v+":"+t[u].id;k++;}}m++;i++;});if(l){return false;}o[g-1]=j.getProfileRows(b,0,new Array());c[g-1]=$("#selAttr"+r).val();g++;});var n;for(var h=0;h<o.length;h++){n="";for(var d=0;d<o[h].length;d++){n+=o[h][d]+"\n";}}var f=new EXPERTUS.SMARTPORTAL.ProfileMapManager();this.mode="savemapping";f.initialize(this);f.setLoaderObj(this.loaderObj);f.setActionKey("Profile");f.setEndPointURL(this.getEndPointURL());var e={mapAttribute:this.mapAttribute,parent_id:this.parent_id,id1:this.id1};
f.requestXml=f.generateSaveProfileMapReq(o,c,e);f.execute();};this.getProfileRows=function(c,f,h){var g=new Array();var b=0;for(var e=0;e<c[f].length;e++){for(var d=0;d<h.length;d++){g[b++]=c[f][e]+","+h[d];}if(h.length==0){g[b++]=c[f][e];}}if(c.length-1==f){return g;}else{return this.getProfileRows(c,f+1,g);}};this.render=function(c){this.renderBase(c,this);var b=new EXPERTUS.SMARTPORTAL.ProfileMapManager();this.mode="showtree";b.initialize(this);b.setLoaderObj(this.loaderObj);b.setActionKey("Profile");b.setEndPointURL(this.getEndPointURL());b.requestXml=b.generateProfileSubTreeReq({type:c.typeId,mapAttribute:c.mapAttribute,op:this.op,id1:this.id1,parent_id:this.parent_id});b.execute();};this.initializeProfile=function(b){this.loaderObj=b.divId;this.setWidgetObject(this);this.setWidgetTitle("Profile Master");this.parentObj=b.parentObj;this.id1=b.id1;this.parent_id=b.parent_id;this.divId=b.treeDiv;this.mapAttribute=b.mapAttribute;this.multirow=b.multirow;this.setUniqueWidgetId(b.parentObj.getUniqueWidgetId());
};}catch(a){}};$.extend(EXPERTUS.SMARTPORTAL.ProfileMapWidget.prototype,EXPERTUS.SMARTPORTAL.AbstractDetailsWidget);function getProfileMap(){try{var b=new EXPERTUS.SMARTPORTAL.ProfileMapWidget();return b;}catch(a){}}