(function(e){var a,d,c=0,b={control:e('<div class="colorPicker-picker">&nbsp;</div>'),palette:e('<div id="colorPicker_palette" class="colorPicker-palette" />'),swatch:e('<div class="colorPicker-swatch">&nbsp;</div>'),hexLabel:e('<label for="colorPicker_hex">Hex</label>'),hexField:e('<input type="text" id="colorPicker_hex" />')},g="transparent",f;e.fn.colorPicker=function(h){return this.each(function(){var l=e(this),i=e.extend({},e.fn.colorPicker.defaults,h),j=e.fn.colorPicker.toHex((l.val().length>0)?l.val():i.pickerDefault),p=b.control.clone(),k=b.palette.clone().attr("id","colorPicker_palette-"+c),o=b.hexLabel.clone(),m=b.hexField.clone(),n=k[0].id,q;e.each(i.colors,function(r){q=b.swatch.clone();if(i.colors[r]===g){q.addClass(g).text("X");e.fn.colorPicker.bindPalette(m,q,g);}else{q.css("background-color","#"+this);e.fn.colorPicker.bindPalette(m,q);}q.appendTo(k);});o.attr("for","colorPicker_hex-"+c);m.attr({id:"colorPicker_hex-"+c,value:j});m.bind("keydown",function(s){if(s.keyCode===13){var r=e.fn.colorPicker.toHex(e(this).val());
e.fn.colorPicker.changeColor(r?r:l.val());}if(s.keyCode===27){e.fn.colorPicker.hidePalette();}});m.bind("keyup",function(s){var r=e.fn.colorPicker.toHex(e(s.target).val());e.fn.colorPicker.previewColor(r?r:l.val());});e('<div class="colorPicker_hexWrap" />').append(o).appendTo(k);k.find(".colorPicker_hexWrap").append(m);e("body").append(k);k.hide();p.css("background-color",j);p.bind("click",function(){e.fn.colorPicker.togglePalette(e("#"+n),e(this));});if(h&&h.onColorChange){p.data("onColorChange",h.onColorChange);}else{p.data("onColorChange",function(){});}l.after(p);l.bind("change",function(){l.next(".colorPicker-picker").css("background-color",e.fn.colorPicker.toHex(e(this).val()));});l.val(j).hide();c++;});};e.extend(true,e.fn.colorPicker,{toHex:function(i){if(i.match(/[0-9A-F]{6}|[0-9A-F]{3}$/i)){return(i.charAt(0)==="#")?i:("#"+i);}else{if(i.match(/^rgb\(\s*(\d{1,3})\s*,\s*(\d{1,3})\s*,\s*(\d{1,3})\s*\)$/)){var m=([parseInt(RegExp.$1,10),parseInt(RegExp.$2,10),parseInt(RegExp.$3,10)]),l=function(p){if(p.length<2){for(var o=0,n=2-p.length;
o<n;o++){p="0"+p;}}return p;};if(m.length===3){var k=l(m[0].toString(16)),j=l(m[1].toString(16)),h=l(m[2].toString(16));return"#"+k+j+h;}}else{return false;}}},checkMouse:function(j,i){var h=d,k=e(j.target).parents("#"+h.attr("id")).length;if(j.target===e(h)[0]||j.target===a[0]||k>0){return;}e.fn.colorPicker.hidePalette();},hidePalette:function(){e(document).unbind("mousedown",e.fn.colorPicker.checkMouse);e(".colorPicker-palette").hide();},showPalette:function(h){var i=a.prev("input").val();h.css({top:a.offset().top+(a.outerHeight()),left:a.offset().left});e("#color_value").val(i);h.show();e(document).bind("mousedown",e.fn.colorPicker.checkMouse);},togglePalette:function(h,i){if(i){a=i;}d=h;if(d.is(":visible")){e.fn.colorPicker.hidePalette();}else{e.fn.colorPicker.showPalette(h);}},changeColor:function(h){a.css("background-color",h);a.prev("input").val(h).change();e.fn.colorPicker.hidePalette();a.data("onColorChange").call(a,e(a).prev("input").attr("id"),h);},previewColor:function(h){a.css("background-color",h);
},bindPalette:function(j,i,h){h=h?h:e.fn.colorPicker.toHex(i.css("background-color"));i.bind({click:function(k){f=h;e.fn.colorPicker.changeColor(h);},mouseover:function(k){f=j.val();e(this).css("border-color","#598FEF");j.val(h);e.fn.colorPicker.previewColor(h);},mouseout:function(k){e(this).css("border-color","#000");j.val(a.css("background-color"));j.val(f);e.fn.colorPicker.previewColor(f);}});}});e.fn.colorPicker.defaults={pickerDefault:"FFFFFF",colors:["000000","993300","333300","000080","333399","333333","800000","FF6600","808000","008000","008080","0000FF","666699","808080","FF0000","FF9900","99CC00","339966","33CCCC","3366FF","800080","999999","FF00FF","FFCC00","FFFF00","00FF00","00FFFF","00CCFF","993366","C0C0C0","FF99CC","FFCC99","FFFF99","CCFFFF","99CCFF","FFFFFF"],addColors:[]};})(jQuery);