<?php 
require_once('exp_sp_commerce.inc');
/**
 * Implementation of hook_block_info().
 */
function exp_sp_commerce_block_info() {
 try{	
  $blocks = array();
  $blocks['my_shopping_cart'] = array(
    'info' => t('My Shopping Cart'),
  	'cache' => DRUPAL_CACHE_PER_ROLE,
    'visibility' => BLOCK_VISIBILITY_LISTED,
    'pages' => 'learning/*'      
  );  
  return $blocks;
  }catch (Exception $ex) {
  	watchdog_exception('exp_sp_commerce_block_info', $ex);
  	expertusErrorThrow($ex);
  }
}
/**
 * Implementation of hook_block_view().
 */
function exp_sp_commerce_block_view($delta = ''){  
 try{	
 $css_theme_optional = array('type' => 'file', 'group' => CSS_THEME, 'weight' => 9998);   
  $block = array();
  switch ($delta) {
    case 'my_shopping_cart':      
      if(arg(0) == 'cart')	
      	drupal_add_css(drupal_get_path('module', 'exp_sp_commerce') .'/css/exp_sp_lnrshoppingcart.css', $css_theme_optional);
      $block['subject'] = t('My Shopping Cart');
      $block['content'] = " ";
      $block['results'] = getCartCount();
      break;    
  }
  return $block;
  }catch (Exception $ex) {
  	watchdog_exception('exp_sp_commerce_block_view', $ex);
  	expertusErrorThrow($ex);
  }
}
/**
 * Implements hook_disable()
 */
function exp_sp_commerce_disable() {
 try{	
  expDebug::dPrint("Commerce Disable Here:", 4);
  $views_status = variable_get('views_defaults', array());
  $views_status['uc_orders'] = TRUE; // True is disabled
  variable_set('views_defaults', $views_status);
  views_invalidate_cache();
  // Update the menu router information.
  menu_rebuild();
  }catch (Exception $ex) {
  	watchdog_exception('exp_sp_commerce_disable', $ex);
  	expertusErrorThrow($ex);
  }
}