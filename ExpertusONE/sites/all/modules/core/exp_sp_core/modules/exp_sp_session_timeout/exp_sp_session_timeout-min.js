function sleep(a){var c=new Date().getTime();for(var b=0;b<10000000;b++){if((new Date().getTime()-c)>a){break;}}}(function(a){Drupal.behaviors.exp_sp_session_timeout={attach:function(d,f){if(d!=document){return;}var g;var o;var c;var k;var e;var l;k=jQuery.extend(true,{},f.exp_sp_session_timeout);if(k.refresh_only){o=setTimeout(m,k.timeout);}else{e=false;a("body").bind("formUpdated",function(q){a(q.target).trigger("preventAutologout");});if(typeof CKEDITOR!=="undefined"){CKEDITOR.on("instanceCreated",function(q){q.editor.on("contentDom",function(){q.editor.document.on("keyup",function(r){a(q.editor.element.$).trigger("preventAutologout");});});});}a("body").bind("preventAutologout",function(q){e=true;clearTimeout(l);l=setTimeout(function(){e=false;},60000);});o=setTimeout(n,k.timeout);}function n(){var q=Drupal.settings.exp_sp_session_timeout.no_dialog;if(e){e=false;i();}else{g=setTimeout(h,k.timeout_padding);Drupal.ajax["exp_sp_session_timeout.getTimeLeft"].exp_sp_session_timeoutGetTimeLeft(function(r){if(r>0){clearTimeout(g);
o=setTimeout(n,r);}else{if(q){p();return;}c=j();}});}}function j(){var q={};q[Drupal.t("Yes")]=function(){a(this).dialog("destroy");clearTimeout(g);i();};q[Drupal.t("No")]=function(){a(this).dialog("destroy");p();};return a('<div id="exp_sp_session_timeout-confirm"> '+k.message+"</div>").dialog({position:[(getWindowWidth()-400)/2,200],bgiframe:true,width:300,resizable:false,modal:true,title:Drupal.t("LBL286"),buttons:q,dialogClass:"exp_sp_session_timeout-dialog",draggable:false,overlay:{opacity:0.9,background:"black"},close:function(r,s){p();}});}function h(){a(c).dialog("destroy");Drupal.ajax["exp_sp_session_timeout.getTimeLeft"].exp_sp_session_timeoutGetTimeLeft(function(q){if(q>0){o=setTimeout(n,q);}else{p();}});}function p(){if(k.use_alt_logout_method){window.location=Drupal.settings.basePath+"?q=exp_sp_session_timeout_ahah_logout/alt";}else{var r=k.redirect_url.indexOf("canvas");var q=k.redirect_url.indexOf("salesforce/widget");if((q!=-1)||(r!=-1)){clearTimeout(g);i();}else{a.ajax({url:Drupal.settings.basePath+"?q=exp_sp_session_timeout_ahah_logout",type:"POST",success:function(){window.location=k.redirect_url;
},error:function(s,t){if(s.status==403||s.status==404){window.location=k.redirect_url;}}});}}}Drupal.ajax.prototype.exp_sp_session_timeoutGetTimeLeft=function(s){var q=this;if(q.ajaxing){return false;}q.options.success=function(u,t){if(typeof u=="string"){u=a.parseJSON(u);}if(typeof u[1].command==="string"&&u[1].command=="alert"){window.location=k.redirect_url;}if(u[2].settings!=null){s(u[2].settings.time);}else{s(u[4].settings.time);}return q.success(u,t);};try{q.beforeSerialize(q.element,q.options);a.ajax(q.options);a("body.progress-disabled").removeClass("progress-disabled");}catch(r){q.ajaxing=false;}};Drupal.ajax["exp_sp_session_timeout.getTimeLeft"]=new Drupal.ajax(null,a(document.body),{url:Drupal.settings.basePath+"?q=exp_sp_session_timeout_ajax_get_time_left",event:"exp_sp_session_timeout.getTimeLeft",error:function(q,r){}});Drupal.ajax.prototype.exp_sp_session_timeoutRefresh=function(r){var q=this;if(q.ajaxing){return false;}q.options.success=function(u,t){if(typeof u=="string"){u=a.parseJSON(u);
}if(typeof u[1].command==="string"&&u[1].command=="alert"){window.location=k.redirect_url;}o=setTimeout(r,k.timeout);e=false;return q.success(u,t);};try{q.beforeSerialize(q.element,q.options);a.ajax(q.options);a("body.progress-disabled").removeClass("progress-disabled");}catch(s){q.ajaxing=false;}};Drupal.ajax["exp_sp_session_timeout.refresh"]=new Drupal.ajax(null,a(document.body),{url:Drupal.settings.basePath+"?q=exp_sp_session_timeout_ahah_set_last",event:"exp_sp_session_timeout.refresh",error:function(q,r){}});function m(){Drupal.ajax["exp_sp_session_timeout.refresh"].exp_sp_session_timeoutRefresh(m);}function i(){Drupal.ajax["exp_sp_session_timeout.refresh"].exp_sp_session_timeoutRefresh(n);}var b=a("#exp_sp_session_timeout-cache-check-bit");if(b.length!==0){if(b.val()=="1"&&a("#timer").size()>0){i();}b.val("1");}}};})(jQuery);