(function(a){a.widget("ui.lnrwhoisonline",{setIntervalId:null,_init:function(){try{this.renderOnlineUsersList();this.totalRecords=0;this.pageNo=0;}catch(b){}},paintOnlineUser:function(b,l,f){try{this.currTheme=Drupal.settings.ajaxPageState.theme;var c=f.id;var i=f.screen_name;var j=f.image_url;var k=f.job_title;if(k==null){k="";}var g=f.css;if(this.currTheme=="expertusoneV2"){var d="";d+='<div class="profile-item clearfix '+g+'">';d+='<a class="profile-image user-list-border-img">';d+='<img class="vtip" title="'+htmlEntities(i)+" "+SMARTPORTAL.t("picture")+'" width="27" height="27" src="'+j+'"/>';d+="</a>";d+='<div class="profile-desc">';d+='<span class="user-profile-link limit-title-row">';d+='<a id="'+c+'" class="user-name user-profile " href="javascript:void(0);">';d+='<span class="limit-title limit-title-whois-on  vtip" title="'+htmlEntities(f.screen_name)+'">'+i+"</span>";d+="</a>";d+='<span class="job-title limit-title limit-title-whois-jobtitle vtip" title="'+htmlEntities(k)+'" >'+htmlEntities(k)+"</span>";
d+="</span>";d+="</div>";d+="</div>";return d;}else{var d="";d+='<div class="profile-item clearfix '+g+'">';d+='<a class="profile-image">';d+='<img class="vtip" title="'+htmlEntities(i)+" "+SMARTPORTAL.t("picture")+'" width="27" height="27" src="'+j+'"/>';d+="</a>";d+='<div class="profile-desc">';d+='<span class="user-profile-link limit-title-row">';d+='<a id="'+c+'" class="user-name user-profile" href="javascript:void(0);">';d+='<span class="limit-title limit-title-whois-on  vtip" title="'+htmlEntities(f.screen_name)+'">'+i+"</span>";d+="</a>";d+='<span class="job-title limit-title limit-title-whois-jobtitle vtip" title="'+htmlEntities(k)+'" >'+htmlEntities(k)+"</span>";d+="</span>";d+="</div>";d+="</div>";return d;}}catch(h){}},renderOnlineUsersList:function(){try{this.currTheme=Drupal.settings.ajaxPageState.theme;if(this.currTheme=="expertusoneV2"){var c=220;}else{var c=269;}var f=this;var b={datatype:"json",mtype:"GET",colNames:[""],colModel:[{name:"id",index:"id",width:c,title:false,sortable:false,formatter:f.paintOnlineUser}],rowNum:a("#exp_sp_whoisonline_block_max_list_count").val(),viewrecords:true,loadui:false,height:"auto",pager:"#expertus-online-datatable-pager",pgtext:"{0} "+Drupal.t("LBL981")+" {1}",toppager:false,emptyrecords:"",loadtext:"",recordtext:"",beforeRequest:f.onlineBeforeRequest,gridComplete:f.onlineGridComplete,loadComplete:f.onlineLoadComplete,onPaging:f.onlinePaging,loadError:f.onlineLoadError,totalRecords:0,pageNo:0};
b.url=this.constructUrl("learning/fetch-online-users-list");b.rowNum=8;b.scroll=false;b.pager="";a("#expertus-online-users-jqgrid").jqGrid(b);a(".ui-jqgrid").css("margin","0px");}catch(d){}},onlineBeforeRequest:function(){try{if(a("#expertus-online-users").data("lnrwhoisonline").setIntervalId!=null){clearInterval(a("#expertus-online-users").data("lnrwhoisonline").setIntervalId);a("#expertus-online-users").data("lnrwhoisonline").setIntervalId=null;}}catch(b){}},onlineLoadComplete:function(d){try{var c=a("#exp_sp_whoisonline_block_max_list_count").val();var b=a("#expertus-online-users-jqgrid").jqGrid("getDataIDs");a("#expertus-online-users-jqgrid").setGridParam("totalRecords",d.records);a("#expertus-online-users").data("lnrwhoisonline").totalRecords=d.records;a("#expertus-online-users-jqgrid").setGridParam("pageNo",d.page);a("#expertus-online-users").data("lnrwhoisonline").pageNo=d.page;if(d.records<c){a("#expertus-online-datatable-pager").css("display","none");}if(b.length<=0){a("#expertus-no-online-users-msg").show();
a("#expertus-online-users-list").hide();}else{a("#expertus-no-online-users-msg").hide();a("#expertus-online-users-list").show();}a("#expertus-online-users").data("lnrwhoisonline").setIntervalId=setInterval(a("#expertus-online-users").data("lnrwhoisonline").reloadUsersGrid,1000*a("#exp_sp_whoisonline_block_refresh_interval").val());a("#expertus-online-users .limit-title-whois-on").trunk8(trunk8.whois_username_title);a("#expertus-online-users .limit-title-whois-jobtitle").trunk8(trunk8.whois_jobtitle);vtip();a("#expertus-online-users-jqgrid tr").removeClass("expertus_online_users_last");a("#expertus-online-users-jqgrid tr:last").addClass("expertus_online_users_last");a("#expertus-online-users").data("lnrwhoisonline").refreshGrid(d);}catch(f){}},onlineLoadError:function(f,b,c){try{a("#expertus-online-users").data("lnrwhoisonline").destroyLoader("expertus-online-users-loader");if(a("#expertus-online-users").data("lnrwhoisonline").setIntervalId!=null){clearInterval(a("#expertus-online-users").data("lnrwhoisonline").setIntervalId);
a("#expertus-online-users").data("lnrwhoisonline").setIntervalId=null;}}catch(d){}},reloadUsersGrid:function(){try{if(a("#expertus-online-users").data("lnrwhoisonline").setIntervalId!=null){clearInterval(a("#expertus-online-users").data("lnrwhoisonline").setIntervalId);a("#expertus-online-users").data("lnrwhoisonline").setIntervalId=null;}a("#expertus-online-users-jqgrid").setGridParam({page:1}).trigger("reloadGrid");}catch(b){}},onlinePaging:function(c){try{a("#expertus-online-users").data("lnrwhoisonline").createLoader("expertus-online-users-loader");if(a("#expertus-online-users").data("lnrwhoisonline").setIntervalId!=null){clearInterval(a("#expertus-online-users").data("lnrwhoisonline").setIntervalId);a("#expertus-online-users").data("lnrwhoisonline").setIntervalId=null;}}catch(b){}},refreshGrid:function(c){try{var b=0;var g=a("#expertus-online-users").data("lnrwhoisonline").totalRecords;var f=8;a("#expertus-online-users-jqgrid tr.ui-widget-content:not(.jqgfirstrow):lt("+f+")").each(function(e){b+=a(this).height();
});if(g>f){b-=5;a("#whoisonline-block_start").css({height:b+"px",overflow:"hidden"});if(a("#whoisonline-block_start").data("jsp")!==undefined){a("#whoisonline-block_start").data("jsp").reinitialise();}else{initializeJScrollPane("whoisonline");}}else{a("#whoisonline-block_start").css({height:b+"px",overflow:"hidden"});if(a("#whoisonline-block_start").data("jsp")!==undefined){a("#whoisonline-block_start").data("jsp").destroy();}}}catch(d){}}});a.extend(a.ui.lnrwhoisonline.prototype,EXPERTUS_SMARTPORTAL_AbstractManager,EXPERTUS_SMARTPORTAL_AbstractDetailsWidget);})(jQuery);$(function(){try{$("#expertus-online-users").lnrwhoisonline();}catch(a){}});